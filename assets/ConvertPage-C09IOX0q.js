import{K as $,L as B,r as d,a as c,W as b,M as R,v as V,y as a,x as u,J as v,O as i,u as O,N as j,S as I}from"./index-BBa5vNS3.js";import{Q as N}from"./QSpace-Cp1fCyYw.js";import{Q as U,a as E}from"./QHeader-BtVMv5uM.js";import{Q as F,a as C,b as M}from"./QCard-BvPHvfi8.js";import{b as D,Q as G}from"./QPage-CIrKFsQW.js";import{_ as z}from"./PeopleDropdown-5OAO2csb.js";import{_ as h}from"./CurrencyDropdown-C486mn_T.js";import{_ as A,a as H}from"./TransactionList-B3XKr7Xk.js";import"./QResizeObserver-bsTUt8fk.js";import"./QItemLabel-B1Yj03Ds.js";import"./selection-34b-kWMK.js";import"./focusout-B9Gq5kaP.js";import"./scroll-CHejQRYj.js";import"./PersonItem-CRcYwDvm.js";import"./index-CgCkCqT-.js";import"./CurrencyDisplay-ky-32W0p.js";import"./utils-bRICbQdu.js";import"./QSlideItem-CB4FUQfG.js";import"./use-render-cache-rinsAykk.js";const pe=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(J){const e=$(),Q=B(),S=D(),k=d(null),n=d(e.user.id),p=c(()=>e.personId2Idx(n.value)),f=c(()=>b.getSummary(e.currentSheetResults,p.value)),_=c(()=>new Set(Object.keys(f.value.totals))),m=Object.keys(f.value.totals),o=d(m.length>0?m[0]:"USD"),r=d(m.length>1?m[1]:m.length>0?m[0]:"USD"),g=d(e.convertCurrency(1,o.value,r.value)),w=()=>{Q.go(-1)},x=()=>{Object.keys(f.value.totals).includes(r.value)?[o.value,r.value]=[r.value,o.value]:S.notify({message:`Cannot swap: You don't have a balance in ${r.value}`,color:"negative"})},y=c(()=>{let s=`ðŸ¤– settle ${e.getName(n.value)}`;const t=e.makeEquivalentTransactionBatch(o.value,p.value,s);s=`ðŸ¤– convert ${e.getName(n.value)}`;const l=e.makeEquivalentTransactionBatch(o.value,p.value,s,-g.value,r.value);return{...t,...l}}),P=c(()=>{const s=e.getEditableCurrentSheetResults();return b.applyTransactions(s,y.value,e.currentSheetPeople.length||0),s}),T=c(()=>b.getSummary(P.value,p.value)),q=async()=>{try{await e.addTransactions(y.value),w()}catch(s){S.notify({message:s.message||s,color:"negative"});return}};return(s,t)=>(V(),R(I,null,[a(E,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[a(U,null,{default:u(()=>[a(v,{flat:"",icon:"arrow_back",onClick:w,"aria-label":"Go Back",class:"bg-white text-primary"}),a(N),a(v,{flat:"",icon:i(e).simplifiedTransactions?"toggle_on":"toggle_off",label:i(e).simplifiedTransactions?"Simplify: ON":"Simplify: OFF",onClick:t[0]||(t[0]=l=>i(e).simplifiedTransactions=!i(e).simplifiedTransactions),class:"q-ml-md bg-white text-primary","aria-label":"Simplify"},null,8,["icon","label"]),a(v,{flat:"",icon:"done",label:"Confirm",onClick:q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),a(G,null,{default:u(()=>[a(F,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[a(C,{class:"full-width"},{default:u(()=>[i(e).currentSheet?(V(),O(z,{key:0,class:"full-width",modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),people:i(e).currentSheet.people,"sorted-people":i(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):j("",!0)]),_:1}),a(C,{class:"full-width row justify-center"},{default:u(()=>[a(h,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value=l),usedCurrencies:_.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),a(v,{class:"q-mr-md",icon:"swap_horiz",onClick:x}),a(h,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=l=>r.value=l),usedCurrencies:_.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1}),a(C,{class:"full-width row justify-center"},{default:u(()=>[a(M,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=l=>g.value=l),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[5]||(t[5]=l=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),a(A,{summaries:T.value,selectedPerson:n.value},null,8,["summaries","selectedPerson"]),a(H,{transactions:y.value,selectedPerson:n.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{pe as default};
