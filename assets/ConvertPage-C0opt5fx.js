import{K as R,L as O,r as d,a as c,W as b,M as j,v as C,y as a,x as i,u as V,N as Q,J as v,O as n,S as I}from"./index-BN4oQykV.js";import{Q as N}from"./QSpace-Dm0rdalr.js";import{Q as U,a as E}from"./QHeader-CsjxPL6g.js";import{Q as F,a as S,b as M}from"./QCard-B7RGkhDh.js";import{b as D,Q as G}from"./QPage-DGqtd_iJ.js";import{_ as z}from"./PeopleDropdown-B1T49cPt.js";import{_ as x}from"./CurrencyDropdown-CmAAJkHu.js";import{_ as A,a as H}from"./TransactionList-CMVWEdZP.js";import"./QResizeObserver-BoJqacBm.js";import"./QItemLabel-CKcdkpKK.js";import"./selection-_pR76mky.js";import"./focusout-BgZVr1Hq.js";import"./scroll-D71Evjro.js";import"./PersonItem-bIoTSMyQ.js";import"./index-CMSkMIhu.js";import"./CurrencyDisplay-B4VyaTGU.js";import"./utils-bRICbQdu.js";import"./QSlideItem-Ro1TimLz.js";import"./use-render-cache-rinsAykk.js";const pe=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(J){const e=R(),P=O(),k=D(),_=d(null),o=d(e.user.id),p=c(()=>e.personId2Idx(o.value)),f=c(()=>b.getSummary(e.currentSheetResults,p.value)),w=c(()=>new Set(Object.keys(f.value.totals))),m=Object.keys(f.value.totals),u=d(m.length>0?m[0]:"USD"),r=d(m.length>1?m[1]:m.length>0?m[0]:"USD"),g=d(e.convertCurrency(1,r.value,u.value)),h=()=>{P.go(-1)},T=()=>{Object.keys(f.value.totals).includes(r.value)?[u.value,r.value]=[r.value,u.value]:k.notify({message:`Cannot swap: You don't have a balance in ${r.value}`,color:"negative"})},y=c(()=>{let s=`ðŸ¤– settle ${e.getName(o.value)}`;const t=e.makeEquivalentTransactionBatch(u.value,p.value,s);s=`ðŸ¤– convert ${e.getName(o.value)}`;const l=e.makeEquivalentTransactionBatch(u.value,p.value,s,-g.value,r.value);return{...t,...l}}),q=c(()=>{const s=e.getEditableCurrentSheetResults();return b.applyTransactions(s,y.value,e.currentSheetPeople.length||0),s}),$=c(()=>b.getSummary(q.value,p.value)),B=async()=>{try{await e.addTransactions(y.value),h()}catch(s){k.notify({message:s.message||s,color:"negative"});return}};return(s,t)=>(C(),j(I,null,[a(E,{elevated:"",class:"bg-primary text-white"},{default:i(()=>[a(U,null,{default:i(()=>[a(v,{flat:"",icon:"arrow_back",onClick:h,"aria-label":"Go Back",class:"bg-white text-primary"}),a(N),n(e).currentSheetPeople.length>2?(C(),V(v,{key:0,flat:"",icon:n(e).simplifiedTransactions?"toggle_on":"toggle_off",label:n(e).simplifiedTransactions?"Simplify: ON":"Simplify: OFF",onClick:t[0]||(t[0]=l=>n(e).simplifiedTransactions=!n(e).simplifiedTransactions),class:"q-ml-md bg-white text-primary","aria-label":"Simplify"},null,8,["icon","label"])):Q("",!0),a(v,{flat:"",icon:"done",label:"Confirm",onClick:B,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),a(G,null,{default:i(()=>[a(F,{class:"q-my-md q-mr-md q-ml-md"},{default:i(()=>[a(S,{class:"full-width"},{default:i(()=>[n(e).currentSheet?(C(),V(z,{key:0,class:"full-width",modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value=l),people:n(e).currentSheet.people,"sorted-people":n(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):Q("",!0)]),_:1}),a(S,{class:"full-width row justify-center"},{default:i(()=>[a(x,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l),usedCurrencies:w.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),a(v,{class:"q-mr-md",icon:"swap_horiz",onClick:T}),a(x,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=l=>r.value=l),usedCurrencies:w.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1}),a(S,{class:"full-width row justify-center"},{default:i(()=>[a(M,{ref_key:"conversionInputRef",ref:_,outlined:"",modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=l=>g.value=l),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[5]||(t[5]=l=>_.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),a(A,{summaries:$.value,selectedPerson:o.value},null,8,["summaries","selectedPerson"]),a(H,{transactions:y.value,selectedPerson:o.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{pe as default};
