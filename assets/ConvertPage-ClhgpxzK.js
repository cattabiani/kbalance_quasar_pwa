import{K as U,L as F,r as d,a as u,W as S,w as M,Z as x,M as z,v as $,y as s,x as i,J as y,u as E,N as G,O as g,H,Q as J,S as K}from"./index-DmmOCoWn.js";import{Q as L}from"./QSpace-BOzyrkmJ.js";import{Q as W,a as Z}from"./QHeader-CK1Yh_vd.js";import{Q as D,a as h,b as X}from"./QCard-VNZekkGP.js";import{b as Y,Q as ee}from"./QPage-DkbmkkoL.js";import{_ as ae}from"./PeopleDropdown-B0yHnawq.js";import{_ as P}from"./CurrencyDropdown-HwMBOg1t.js";import{_ as te,a as le}from"./TransactionList-CpZnxx-r.js";import"./QResizeObserver-DShN3eTf.js";import"./QItemLabel-DVEbkyKJ.js";import"./selection-sB4W6q3w.js";import"./focusout-Bosoh1HO.js";import"./scroll-LRJG3Fw4.js";import"./PersonItem-DRf6-sf5.js";import"./index-CWNK0DXs.js";import"./CurrencyDisplay-c1adv5r8.js";import"./QSlideItem-B1j_Ac3p.js";import"./use-render-cache-rinsAykk.js";const se={class:"column items-center q-mx-sm"},ke=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(re){const t=U(),q=F(),b=Y(),m=d(!1),k=d(null),o=d(t.user.id),C=u(()=>t.personId2Idx(o.value)),Q=u(()=>S.summary(t.currentSheetResults,C.value)),w=u(()=>new Set(Object.keys(Q.value)));M(m,l=>{const e=l?"Convert all the balance sheet":`Convert only ${t.getName(o.value)}'s part`;b.notify({message:e})});const B=(l,e)=>{const a=[...l];let c=null,p=null;return a.length===0?{from:p,to:c}:(a.length===1?(c=e&&e!==a[0]?e:a[0],p=a[0]):(c=a.includes(e)?e:a[0],p=a.find(f=>f!==c&&f!==e)||a.find(f=>f!==c)||a[0]),{from:p,to:c})},{from:R,to:N}=B(new Set(Object.keys(Q.value)),t.referenceCurrency),r=d(R),n=d(N),I=()=>{if(r!==n){if(!w.value.has(n.value)){b.notify({message:`Cannot swap currencies: no balance in ${r.value}.`});return}[r.value,n.value]=[n.value,r.value]}},v=u(()=>t.convertCurrency(1,r.value,n.value)),V=()=>{q.go(-1)},j=u(()=>{let l=[];return m.value?l=x.convertAll(t.currentSheetResults.perCurrencyBalance[r.value],v.value,n.value):l=x.convertPerson(t.currentSheetResults.perCurrencyBalance[r.value],C.value,t.currentSheetPeople,v.value,n.value),l.length>=2?(l[0].name=`ðŸ¤– settle ${t.getName(o.value)} (${r.value})`,l[1].name=`ðŸ¤– convert ${t.getName(o.value)} (${r.value} â†’ ${n.value})`,{[l[0].id]:l[0],[l[1].id]:l[1]}):{}}),_=u(()=>t.currentSheet?{...t.currentSheet.transactions,...j.value}:{}),T=u(()=>S.make(_.value,t.currentSheetPeople.length)),A=u(()=>S.summary(T.value,C.value)),O=async()=>{try{await t.addTransactions(_.value),V()}catch(l){b.notify({message:l.message||l,color:"negative"});return}};return(l,e)=>($(),z(K,null,[s(Z,{elevated:"",class:"bg-primary text-white"},{default:i(()=>[s(W,null,{default:i(()=>[s(y,{flat:"",icon:"arrow_back",onClick:V,"aria-label":"Go Back",class:"bg-white text-primary"}),s(L),s(y,{flat:"",icon:"done",label:"Confirm",onClick:O,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),s(ee,null,{default:i(()=>[s(D,{class:"q-my-md q-mr-md q-ml-md"},{default:i(()=>[s(h,{class:"full-width row no-wrap items-center"},{default:i(()=>[g(t).currentSheet?($(),E(ae,{key:0,class:"q-mr-md",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),people:g(t).currentSheet.people,"sorted-people":g(t).currentSheetPeople,style:{flex:"1 1 auto"}},null,8,["modelValue","people","sorted-people"])):G("",!0),s(y,{icon:m.value?"apps":"person",label:m.value?"All":g(t).getName(o.value),color:"primary",toggle:"",dense:"",onClick:e[1]||(e[1]=a=>m.value=!m.value)},null,8,["icon","label"])]),_:1}),s(h,{class:"full-width row items-center justify-center"},{default:i(()=>[s(P,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),usedCurrencies:w.value,dense:"",expandable:!1,class:"q-mr-sm"},null,8,["modelValue","usedCurrencies"]),H("div",se,[s(J,{name:"arrow_forward",size:"md",class:"q-mb-xs"}),s(y,{dense:"",round:"",icon:"swap_horiz",onClick:I})]),s(P,{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),usedCurrencies:w.value,dense:"",class:"q-ml-sm"},null,8,["modelValue","usedCurrencies"])]),_:1}),s(h,{class:"full-width row justify-center"},{default:i(()=>[s(X,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:e[5]||(e[5]=a=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),s(te,{summary:A.value,selectedPerson:o.value},null,8,["summary","selectedPerson"]),s(le,{transactions:_.value,selectedPerson:o.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ke as default};
