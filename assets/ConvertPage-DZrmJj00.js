import{K as $,L as R,r as m,a as i,W as g,M as T,v as h,y as e,x as u,J as y,u as j,N as I,O as b,S as U}from"./index-CvXSrUDU.js";import{Q as E}from"./QSpace-DqmEeBH0.js";import{Q as N,a as O}from"./QHeader-BFR1k8lX.js";import{Q as M,a as C,b as D}from"./QCard-CynKPfqT.js";import{b as F,Q as G}from"./QPage-DY5jqeqR.js";import{_ as z}from"./PeopleDropdown-3uYDwTGo.js";import{_ as V}from"./CurrencyDropdown-DeyxQwOG.js";import{_ as A,a as H}from"./TransactionList-nvPrqbhQ.js";import"./QResizeObserver-BTyHfe79.js";import"./QItemLabel-B7fUcMVq.js";import"./selection-BrPvnA7p.js";import"./focusout-DO_N1vMB.js";import"./scroll-BknRvc_l.js";import"./PersonItem-D_Fa0loi.js";import"./index-BFe8svLp.js";import"./CurrencyDisplay-2LEjPyqs.js";import"./utils-bRICbQdu.js";import"./QSlideItem-dBDkJs4W.js";import"./use-render-cache-rinsAykk.js";const ve=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(J){const a=$(),Q=R(),_=F(),k=m(null),o=m(a.user.id),d=i(()=>a.personId2Idx(o.value)),v=i(()=>g.getSummary(a.currentSheetResults,d.value)),S=i(()=>new Set(Object.keys(v.value.totals))),c=Object.keys(v.value.totals),n=m(c.length>0?c[0]:"USD"),r=m(c.length>1?c[1]:c.length>0?c[0]:"USD"),p=m(a.convertCurrency(1,n.value,r.value)),w=()=>{Q.go(-1)},x=()=>{Object.keys(v.value.totals).includes(r.value)?[n.value,r.value]=[r.value,n.value]:_.notify({message:`Cannot swap: You don't have a balance in ${r.value}`,color:"negative"})},f=i(()=>{let s=`ðŸ¤– settle ${a.getName(o.value)}`;const t=a.makeEquivalentTransactionBatch(n.value,d.value,s);s=`ðŸ¤– convert ${a.getName(o.value)}`;const l=a.makeEquivalentTransactionBatch(n.value,d.value,s,-p.value,r.value);return{...t,...l}}),P=i(()=>{const s=a.getEditableCurrentSheetResults();return g.applyTransactions(s,f.value,a.currentSheetPeople.length||0),s}),q=i(()=>g.getSummary(P.value,d.value)),B=async()=>{try{await a.addTransactions(f.value),w()}catch(s){_.notify({message:s.message||s,color:"negative"});return}};return(s,t)=>(h(),T(U,null,[e(O,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[e(N,null,{default:u(()=>[e(y,{flat:"",icon:"arrow_back",onClick:w,"aria-label":"Go Back",class:"bg-white text-primary"}),e(E),e(y,{flat:"",icon:"done",label:"Confirm",onClick:B,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),e(G,null,{default:u(()=>[e(M,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[e(C,{class:"full-width"},{default:u(()=>[b(a).currentSheet?(h(),j(z,{key:0,class:"full-width",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),people:b(a).currentSheet.people,"sorted-people":b(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):I("",!0)]),_:1}),e(C,{class:"full-width row justify-center"},{default:u(()=>[e(V,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),usedCurrencies:S.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),e(y,{class:"q-mr-md",icon:"swap_horiz",onClick:x}),e(V,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=l=>r.value=l),usedCurrencies:S.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1}),e(C,{class:"full-width row justify-center"},{default:u(()=>[e(D,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=l=>p.value=l),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[4]||(t[4]=l=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{summaries:q.value,selectedPerson:o.value},null,8,["summaries","selectedPerson"]),e(H,{transactions:f.value,selectedPerson:o.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ve as default};
