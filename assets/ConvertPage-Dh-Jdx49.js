import{L as U,M as z,r as d,a as u,X as h,w as F,_ as x,N as M,x as P,z as s,y as i,K as y,v as E,O as G,P as g,I as H,Q as K,T as L}from"./index-CCxTOJyV.js";import{Q as X}from"./QSpace-DE9XkagT.js";import{Q as D,a as J}from"./QHeader-BVgXgM1V.js";import{Q as W,a as S,b as Y}from"./QCard-CaOUDWmZ.js";import{b as Z,Q as ee}from"./QPage-E6N8TXrA.js";import{_ as ae}from"./PeopleDropdown-lECpsH5p.js";import{_ as $}from"./CurrencyDropdown-g2QQOMQR.js";import{_ as te,a as le}from"./TransactionList-BbODBPgj.js";import"./QResizeObserver--RQzJ84N.js";import"./QItemLabel-IxHZINt8.js";import"./selection-vJctmsM6.js";import"./focusout-Cp4VIzGU.js";import"./scroll-CKykQgin.js";import"./PersonItem-CW87FHBT.js";import"./ClosePopup-9vP-xLZu.js";import"./CurrencyDisplay-BIdLjEXx.js";import"./QSlideItem-R8m3rChH.js";import"./TouchPan-BRTLyM0P.js";import"./use-render-cache-rinsAykk.js";const se={class:"column items-center q-mx-sm"},Qe=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(re){const t=U(),q=z(),b=Z(),m=d(!1),k=d(null),o=d(t.user.id),C=u(()=>t.personId2Idx(o.value)),Q=u(()=>h.summary(t.currentSheetResults,C.value)),w=u(()=>new Set(Object.keys(Q.value)));F(m,l=>{const e=l?"Convert all the balance sheet":`Convert only ${t.getName(o.value)}'s part`;b.notify({message:e})});const B=(l,e)=>{const a=[...l];let c=null,p=null;return a.length===0?{from:p,to:c}:(a.length===1?(c=e&&e!==a[0]?e:a[0],p=a[0]):(c=a.includes(e)?e:a[0],p=a.find(f=>f!==c&&f!==e)||a.find(f=>f!==c)||a[0]),{from:p,to:c})},{from:R,to:I}=B(new Set(Object.keys(Q.value)),t.referenceCurrency),r=d(R),n=d(I),N=()=>{if(r!==n){if(!w.value.has(n.value)){b.notify({message:`Cannot swap currencies: no balance in ${r.value}.`});return}[r.value,n.value]=[n.value,r.value]}},v=u(()=>t.convertCurrency(1,r.value,n.value)),V=()=>{q.go(-1)},T=u(()=>{let l=[];return m.value?l=x.convertAll(t.currentSheetResults.perCurrencyBalance[r.value],v.value,n.value):l=x.convertPerson(t.currentSheetResults.perCurrencyBalance[r.value],C.value,t.currentSheetPeople,v.value,n.value),l.length>=2?(l[0].name=`ðŸ¤– settle ${t.getName(o.value)} (${r.value})`,l[1].name=`ðŸ¤– convert ${t.getName(o.value)} (${r.value} â†’ ${n.value})`,{[l[0].id]:l[0],[l[1].id]:l[1]}):{}}),_=u(()=>t.currentSheet?{...t.currentSheet.transactions,...T.value}:{}),j=u(()=>h.make(_.value,t.currentSheetPeople.length)),A=u(()=>h.summary(j.value,C.value)),O=async()=>{try{await t.addTransactions(_.value),V()}catch(l){b.notify({message:l.message||l,color:"negative"});return}};return(l,e)=>(P(),M(L,null,[s(J,{elevated:"",class:"bg-primary text-white"},{default:i(()=>[s(D,null,{default:i(()=>[s(y,{flat:"",icon:"arrow_back",onClick:V,"aria-label":"Go Back",class:"bg-white text-primary"}),s(X),s(y,{flat:"",icon:"done",label:"Confirm",onClick:O,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),s(ee,null,{default:i(()=>[s(W,{class:"q-my-md q-mr-md q-ml-md"},{default:i(()=>[s(S,{class:"full-width row no-wrap items-center"},{default:i(()=>[g(t).currentSheet?(P(),E(ae,{key:0,class:"q-mr-md",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),people:g(t).currentSheet.people,"sorted-people":g(t).currentSheetPeople,style:{flex:"1 1 auto"}},null,8,["modelValue","people","sorted-people"])):G("",!0),s(y,{icon:m.value?"apps":"person",label:m.value?"All":g(t).getName(o.value),color:"primary",toggle:"",dense:"",onClick:e[1]||(e[1]=a=>m.value=!m.value)},null,8,["icon","label"])]),_:1}),s(S,{class:"full-width row items-center justify-center"},{default:i(()=>[s($,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),usedCurrencies:w.value,dense:"",expandable:!1,class:"q-mr-sm"},null,8,["modelValue","usedCurrencies"]),H("div",se,[s(K,{name:"arrow_forward",size:"md",class:"q-mb-xs"}),s(y,{dense:"",round:"",icon:"swap_horiz",onClick:N})]),s($,{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),usedCurrencies:w.value,dense:"",class:"q-ml-sm"},null,8,["modelValue","usedCurrencies"])]),_:1}),s(S,{class:"full-width row justify-center"},{default:i(()=>[s(Y,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:e[5]||(e[5]=a=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),s(te,{summary:A.value,selectedPerson:o.value},null,8,["summary","selectedPerson"]),s(le,{transactions:_.value,selectedPerson:o.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{Qe as default};
