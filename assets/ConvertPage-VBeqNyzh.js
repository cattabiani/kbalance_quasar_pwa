import{K as N,L as O,r as p,a as o,W as b,M as U,v as S,y as a,x as u,u as Q,N as x,J as f,O as s,S as j}from"./index-RPHRYbe4.js";import{Q as E}from"./QSpace-BzC-8nu6.js";import{Q as F,a as M}from"./QHeader-DIuhQxYY.js";import{Q as D,a as k,b as G}from"./QCard-CaLyTEXD.js";import{b as A,Q as H}from"./QPage-CSfZ3llX.js";import{_ as J}from"./PeopleDropdown-kxXddB9Q.js";import{_ as P}from"./CurrencyDropdown-DAW-zOXn.js";import{_ as K,a as L}from"./TransactionList-D7PNLiip.js";import"./QResizeObserver-_X9rxPxX.js";import"./QItemLabel-BT2yxQYC.js";import"./selection-CH_E7EJ3.js";import"./focusout-NvOgR3at.js";import"./scroll-DB52AouT.js";import"./PersonItem-Dx_g_J8e.js";import"./index-BYyNv4KT.js";import"./CurrencyDisplay-D8Fdpw1L.js";import"./utils-bRICbQdu.js";import"./QSlideItem-CcVWCkOo.js";import"./use-render-cache-rinsAykk.js";const fe=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(W){const e=N(),h=O(),T=A(),C=p(null),n=p(e.user.id),v=o(()=>e.personId2Idx(n.value)),_=o(()=>b.getSummary(e.currentSheetResults,v.value)),w=o(()=>new Set(Object.keys(_.value.totals))),i=Object.keys(_.value.totals),m=p(i.length>0?i[0]:"USD"),c=p(i.length>1?i[1]:i.length>0?i[0]:"USD"),d=p(!0),g=o(()=>d.value?e.convertCurrency(1,m.value,c.value):e.convertCurrency(1,c.value,m.value)),V=()=>{h.go(-1)},y=o(()=>{let r=m.value,t=c.value;d.value||([r,t]=[t,r]);let l=`ðŸ¤– settle ${e.getName(n.value)}`;const R=e.makeEquivalentTransactionBatch(r,v.value,l);l=`ðŸ¤– convert ${e.getName(n.value)}`;const I=e.makeEquivalentTransactionBatch(r,v.value,l,-g.value,t);return{...R,...I}}),q=o(()=>{const r=e.getEditableCurrentSheetResults();return b.applyTransactions(r,y.value,e.currentSheetPeople.length||0),r}),$=o(()=>b.getSummary(q.value,v.value)),B=async()=>{try{await e.addTransactions(y.value),V()}catch(r){T.notify({message:r.message||r,color:"negative"});return}};return(r,t)=>(S(),U(j,null,[a(M,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[a(F,null,{default:u(()=>[a(f,{flat:"",icon:"arrow_back",onClick:V,"aria-label":"Go Back",class:"bg-white text-primary"}),a(E),s(e).currentSheetPeople.length>2?(S(),Q(f,{key:0,flat:"",icon:s(e).simplifiedTransactions?"toggle_on":"toggle_off",label:s(e).simplifiedTransactions?"Simplify: ON":"Simplify: OFF",onClick:t[0]||(t[0]=l=>s(e).simplifiedTransactions=!s(e).simplifiedTransactions),class:"q-ml-md bg-white text-primary","aria-label":"Simplify"},null,8,["icon","label"])):x("",!0),a(f,{flat:"",icon:"done",label:"Confirm",onClick:B,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),a(H,null,{default:u(()=>[a(D,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[a(k,{class:"full-width"},{default:u(()=>[s(e).currentSheet?(S(),Q(J,{key:0,class:"full-width",modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),people:s(e).currentSheet.people,"sorted-people":s(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):x("",!0)]),_:1}),a(k,{class:"full-width row justify-center"},{default:u(()=>[a(P,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=l=>m.value=l),usedCurrencies:w.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),a(f,{class:"q-mr-md",icon:d.value?"arrow_forward":"arrow_back",onClick:t[3]||(t[3]=l=>d.value=!d.value)},null,8,["icon"]),a(P,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value=l),usedCurrencies:w.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1}),a(k,{class:"full-width row justify-center"},{default:u(()=>[a(G,{ref_key:"conversionInputRef",ref:C,outlined:"",modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=l=>g.value=l),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[6]||(t[6]=l=>C.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{summaries:$.value,selectedPerson:n.value},null,8,["summaries","selectedPerson"]),a(L,{transactions:y.value,selectedPerson:n.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{fe as default};
