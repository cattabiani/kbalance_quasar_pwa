import{_ as E,r as d,a as _,u,$ as b,y as o,x as r,a0 as B,a1 as G,Z as F,a2 as s,v as w,a3 as x,X as n,a4 as v,a5 as H,aC as U,an as M}from"./index.a806d26d.js";import{Q as X,a as Y,U as O}from"./PersonItem.7fcf1ebd.js";import{e as Z,c as J,d as V,Q as $}from"./QPage.c0d6ab01.js";import{c as K,Q as D}from"./index.3c521992.js";import{_ as ee}from"./PeopleDropdown.1eb61a1f.js";import"./focusout.4c62d806.js";import"./scroll.6ce354fe.js";import"./QResizeObserver.2d174bfe.js";import"./QDialog.24e6bdaa.js";import"./rtl.276c3f1b.js";const le={class:"q-pa-md"},ae={key:0,style:{color:"green"}},te={key:1,style:{color:"red"}},se={class:"q-pa-md"},ye=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(oe){const t=E(),L=G(),R=J(),c=d(t.user.id),P=_(()=>t.personId2Idx(c.value)),S=K.data.map(l=>({label:`${l.code} - ${l.currency}`,value:l.code})),g=d(S),k=d(null),Q=_(()=>{const{ans:l,totals:e}=U.getSummary(t.currentSheetResults,P.value);return{detail:l.map((m,p)=>({...m,id:p})),totals:e}}),h=_(()=>{const{ans:l,totals:e}=U.getSummary(t.currentSheetResults,P.value);return{detail:l.map((m,p)=>({...m,id:p})),totals:e}}),j=_(()=>Object.entries(h.value.totals).filter(([l,e])=>e>0).map(([l,e])=>O.displayCurrency(l,e)).join(" + ")),I=_(()=>Object.entries(h.value.totals).filter(([l,e])=>e<0).map(([l,e])=>O.displayCurrency(l,-e)).join(" + ")),N=S.filter(l=>Object.keys(Q.value.totals).includes(l.value)),C=d(N),q=d(null),f=Object.keys(Q.value.totals),y=d(f.length>0?f[0]:"USD"),i=d(f.length>1?f[1]:f.length>0?f[0]:"USD");d(1);const T=()=>{L.go(-1)},z=()=>{Object.keys(Q.value.totals).includes(i.value)?[y.value,i.value]=[i.value,y.value]:R.notify({message:`Cannot swap: You don't have a balance in ${i.value}`,color:"negative"})},W=(l,e)=>{if(l===""){e(()=>{g.value=S});return}i.value="";const a=l.toLowerCase();e(()=>{const m=S.filter(p=>p.value.toLowerCase().includes(a));g.value=m,g.value.length===1&&(i.value=g.value[0].value,k.value&&(k.value.updateInputValue(""),setTimeout(()=>{k.value.hidePopup()},0)))})},A=(l,e)=>{if(l===""){e(()=>{C.value=N});return}y.value="";const a=l.toLowerCase();e(()=>{const m=N.filter(p=>p.value.toLowerCase().includes(a));C.value=m,C.value.length===1&&(y.value=C.value[0].value,q.value&&(q.value.updateInputValue(""),setTimeout(()=>{q.value.hidePopup()},0)))})};return(l,e)=>(u(),b(B,null,[o(X,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[o(Y,null,{default:r(()=>[o(F,{flat:"",icon:"arrow_back",onClick:T,"aria-label":"Go Back",class:"bg-white text-primary"})]),_:1})]),_:1}),o(Z,null,{default:r(()=>[o(V,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[o($,{class:"full-width"},{default:r(()=>[s(t).currentSheet?(u(),w(ee,{key:0,class:"full-width",modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),people:s(t).currentSheet.people,"sorted-people":s(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):x("",!0)]),_:1}),o($,{class:"full-width row justify-center"},{default:r(()=>[o(D,{class:"q-mr-md",ref_key:"fromCurrencySelect",ref:q,label:"From",filled:"",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),options:C.value,"option-label":"label","option-value":"value","option-slot":"","emit-value":"","use-input":"","input-debounce":"0",onFilter:A,style:{maxWidth:"130px"}},null,8,["modelValue","options"]),o(F,{class:"q-mr-md",icon:"swap_horiz",onClick:z}),o(D,{ref_key:"currencySelect",ref:k,label:"To",filled:"",modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),options:g.value,"option-label":"label","option-value":"value","option-slot":"","emit-value":"","use-input":"","input-debounce":"0",onFilter:W,style:{maxWidth:"130px"}},null,8,["modelValue","options"])]),_:1})]),_:1}),I.value||j.value?(u(),w(V,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[n("div",le,[I.value?(u(),b("div",ae,v(s(t).getName(c.value))+" is owed "+v(I.value),1)):x("",!0),j.value?(u(),b("div",te,v(s(t).getName(c.value))+" owes "+v(j.value),1)):x("",!0)])]),_:1})):(u(),w(V,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>e[3]||(e[3]=[n("div",{class:"q-pa-md"},[n("div",null,"All Settled!")],-1)])),_:1})),h.value.detail.length>0?(u(),w(V,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[n("div",se,[(u(!0),b(B,null,H(h.value.detail,a=>(u(),b("div",{key:a.id},[n("div",null,[n("span",null,v(a.amount>0?s(t).getName(c.value):s(t).getName(s(t).personIdx2Id(a.person))),1),e[4]||(e[4]=n("span",null," owes ",-1)),n("span",null,v(a.amount<0?s(t).getName(c.value):s(t).getName(s(t).personIdx2Id(a.person)))+" \xA0 ",1),n("span",{style:M({color:a.amount>0?"red":"green"})},v(s(O).displayCurrency(a.currency,Math.abs(a.amount))),5)])]))),128))])]),_:1})):x("",!0)]),_:1})],64))}});export{ye as default};
