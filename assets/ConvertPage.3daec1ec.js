import{O as $,r as v,a as i,u as h,P as T,y as e,x as o,S as U,T as j,N as b,U as p,v as E,V as I,aH as N,aC as y}from"./index.3fd8f0e6.js";import{Q as O}from"./QSpace.f5526d6a.js";import{Q as D,a as F}from"./QHeader.5a5b2524.js";import{a as V,Q as C,b as G}from"./QCard.ec05a8a9.js";import{Q as H,b as M}from"./QPage.058ae615.js";import{_ as z}from"./PeopleDropdown.3709102d.js";import{_ as Q}from"./CurrencyDropdown.bbc60b66.js";import{_ as A,a as Y}from"./TransactionList.836b1984.js";import{u as J}from"./useExchangeRates.6e3ee2cb.js";import"./QResizeObserver.5161a85c.js";import"./QMenu.63d5779a.js";import"./selection.bf28801d.js";import"./focusout.59205f5d.js";import"./scroll.898b39f1.js";import"./PersonItem.140e2933.js";import"./utils.ca14db4f.js";import"./QSlideItem.62714604.js";import"./use-render-cache.770e5fe8.js";const pe=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(K){const a=$(),x=j(),_=M(),k=v(null),n=v(a.user.id),m=i(()=>a.personId2Idx(n.value)),f=i(()=>y.getSummary(a.currentSheetResults,m.value)),S=i(()=>new Set(Object.keys(f.value.totals))),c=Object.keys(f.value.totals),u=v(c.length>0?c[0]:"USD"),r=v(c.length>1?c[1]:c.length>0?c[0]:"USD"),{conversionMulti:d}=J(u,r),w=()=>{x.go(-1)},P=()=>{Object.keys(f.value.totals).includes(r.value)?[u.value,r.value]=[r.value,u.value]:_.notify({message:`Cannot swap: You don't have a balance in ${r.value}`,color:"negative"})},g=i(()=>{let s=`\u{1F916} settle ${a.getName(n.value)}`;const t=a.makeEquivalentTransactionBatch(u.value,m.value,s);s=`\u{1F916} convert ${a.getName(n.value)}`;const l=a.makeEquivalentTransactionBatch(u.value,m.value,s,-d.value,r.value);return{...t,...l}}),R=i(()=>{const s=a.getEditableCurrentSheetResults();return y.applyTransactions(s,g.value,a.currentSheetPeople.length||0),s}),q=i(()=>y.getSummary(R.value,m.value)),B=async()=>{try{await a.addTransactions(g.value),w()}catch(s){_.notify({message:s.message||s,color:"negative"});return}};return(s,t)=>(h(),T(U,null,[e(D,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[e(F,null,{default:o(()=>[e(b,{flat:"",icon:"arrow_back",onClick:w,"aria-label":"Go Back",class:"bg-white text-primary"}),e(O),e(b,{flat:"",icon:"done",label:"Confirm",onClick:B,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),e(H,null,{default:o(()=>[e(V,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[e(C,{class:"full-width"},{default:o(()=>[p(a).currentSheet?(h(),E(z,{key:0,class:"full-width",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),people:p(a).currentSheet.people,"sorted-people":p(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):I("",!0)]),_:1}),e(C,{class:"full-width row justify-center"},{default:o(()=>[e(Q,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),usedCurrencies:S.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),e(b,{class:"q-mr-md",icon:"swap_horiz",onClick:P}),e(Q,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=l=>r.value=l),usedCurrencies:S.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),e(V,null,{default:o(()=>[e(C,{class:"full-width row justify-center"},{default:o(()=>[e(G,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:p(d),"onUpdate:modelValue":t[3]||(t[3]=l=>N(d)?d.value=l:null),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[4]||(t[4]=l=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{summaries:q.value,selectedPerson:n.value},null,8,["summaries","selectedPerson"]),e(Y,{transactions:g.value,selectedPerson:n.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{pe as default};
