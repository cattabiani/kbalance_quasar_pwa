import{O as B,r as p,a as m,u as h,P as $,y as e,x as u,S as T,T as U,N as b,U as v,v as j,V as E,aG as I,aC as y}from"./index.6c9dbb9d.js";import{Q as N}from"./QSpace.ec22de2b.js";import{Q as O,a as G}from"./QHeader.aa67bcc9.js";import{a as D,Q as C,b as F}from"./QCard.286ea9ca.js";import{Q as M,b as z}from"./QPage.356567f5.js";import{_ as A}from"./PeopleDropdown.5a2587c3.js";import{_ as V}from"./CurrencyDropdown.8b9e65e9.js";import{_ as H,a as Y}from"./TransactionList.a700bec2.js";import{u as J}from"./useExchangeRates.329e5dc5.js";import"./QResizeObserver.eaf11141.js";import"./QMenu.5bc3788b.js";import"./selection.4f31b2ee.js";import"./focusout.99986f41.js";import"./scroll.e304a2b9.js";import"./PersonItem.2b58404e.js";import"./index.1accded2.js";import"./CurrencyDisplay.42b4d706.js";import"./QSlideItem.06c41a57.js";import"./use-render-cache.770e5fe8.js";import"./utils.8924f51f.js";const ge=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(K){const a=B(),Q=U(),_=z(),k=p(null),o=p(a.user.id),c=m(()=>a.personId2Idx(o.value)),f=m(()=>y.getSummary(a.currentSheetResults,c.value)),S=m(()=>new Set(Object.keys(f.value.totals))),i=Object.keys(f.value.totals),n=p(i.length>0?i[0]:"USD"),r=p(i.length>1?i[1]:i.length>0?i[0]:"USD"),{conversionMulti:d}=J(n,r),w=()=>{Q.go(-1)},x=()=>{Object.keys(f.value.totals).includes(r.value)?[n.value,r.value]=[r.value,n.value]:_.notify({message:`Cannot swap: You don't have a balance in ${r.value}`,color:"negative"})},g=m(()=>{let s=`\u{1F916} settle ${a.getName(o.value)}`;const t=a.makeEquivalentTransactionBatch(n.value,c.value,s);s=`\u{1F916} convert ${a.getName(o.value)}`;const l=a.makeEquivalentTransactionBatch(n.value,c.value,s,-d.value,r.value);return{...t,...l}}),P=m(()=>{const s=a.getEditableCurrentSheetResults();return y.applyTransactions(s,g.value,a.currentSheetPeople.length||0),s}),R=m(()=>y.getSummary(P.value,c.value)),q=async()=>{try{await a.addTransactions(g.value),w()}catch(s){_.notify({message:s.message||s,color:"negative"});return}};return(s,t)=>(h(),$(T,null,[e(O,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[e(G,null,{default:u(()=>[e(b,{flat:"",icon:"arrow_back",onClick:w,"aria-label":"Go Back",class:"bg-white text-primary"}),e(N),e(b,{flat:"",icon:"done",label:"Confirm",onClick:q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),e(M,null,{default:u(()=>[e(D,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[e(C,{class:"full-width"},{default:u(()=>[v(a).currentSheet?(h(),j(A,{key:0,class:"full-width",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),people:v(a).currentSheet.people,"sorted-people":v(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):E("",!0)]),_:1}),e(C,{class:"full-width row justify-center"},{default:u(()=>[e(V,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),usedCurrencies:S.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),e(b,{class:"q-mr-md",icon:"swap_horiz",onClick:x}),e(V,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=l=>r.value=l),usedCurrencies:S.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1}),e(C,{class:"full-width row justify-center"},{default:u(()=>[e(F,{ref_key:"conversionInputRef",ref:k,outlined:"",modelValue:v(d),"onUpdate:modelValue":t[3]||(t[3]=l=>I(d)?d.value=l:null),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:t[4]||(t[4]=l=>k.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),e(H,{summaries:R.value,selectedPerson:o.value},null,8,["summaries","selectedPerson"]),e(Y,{transactions:g.value,selectedPerson:o.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ge as default};
