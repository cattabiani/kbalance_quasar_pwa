import{O as j,r as v,a as c,o as B,u as V,P as R,y as a,x as o,S as E,T as I,N as b,U as w,v as N,V as O,aC as C}from"./index.f3cf086f.js";import{Q as M}from"./QSpace.2f2a0906.js";import{Q as D,a as F}from"./QHeader.59d347c3.js";import{a as q,Q as k,b as G}from"./QCard.61a4b2a6.js";import{Q as H,b as z}from"./QPage.3a122c6e.js";import{_ as A}from"./PeopleDropdown.feded39d.js";import{_ as P}from"./CurrencyDropdown.ddad63fb.js";import{_ as Y,a as J}from"./TransactionList.9e78dfe4.js";import"./QResizeObserver.316d036e.js";import"./PersonItem.8fbbb191.js";import"./selection.c7c28661.js";import"./focusout.768a15cf.js";import"./scroll.34ebb5d6.js";import"./QSlideItem.e2e851a5.js";import"./use-render-cache.770e5fe8.js";const me=Object.assign({name:"ConvertPage"},{__name:"ConvertPage",setup(K){const t=j(),Q=I(),d=z(),i=v(null),_=v(null),u=v(t.user.id),p=c(()=>t.personId2Idx(u.value)),f=c(()=>C.getSummary(t.currentSheetResults,p.value)),h=c(()=>new Set(Object.keys(f.value.totals))),m=Object.keys(f.value.totals),n=v(m.length>0?m[0]:"USD"),l=v(m.length>1?m[1]:m.length>0?m[0]:"USD"),S=()=>{Q.go(-1)},$=()=>{Object.keys(f.value.totals).includes(l.value)?[n.value,l.value]=[l.value,n.value]:d.notify({message:`Cannot swap: You don't have a balance in ${l.value}`,color:"negative"})};B(async()=>{const s="https://cdn.jsdelivr.net/gh/ismartcoding/currency-api/latest/data.json";try{const e=await fetch(s);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);i.value=await e.json()}catch(e){d.notify({message:e.message||e,color:"negative"})}});const y=c(()=>i.value?i.value.quotes[n.value]?i.value.quotes[l.value]?i.value.quotes[l.value]/i.value.quotes[n.value]:(d.notify(`Unknown currency ${l.value}!`),1):(d.notify(`Unknown currency ${n.value}!`),1):1),g=c(()=>{let s=`\u{1F916} settle ${t.getName(u.value)}`;const e=t.makeEquivalentTransactionBatch(n.value,p.value,s);s=`\u{1F916} convert ${t.getName(u.value)}`;const r=t.makeEquivalentTransactionBatch(n.value,p.value,s,-y.value,l.value);return{...e,...r}}),x=c(()=>{const s=t.getEditableCurrentSheetResults();return C.applyTransactions(s,g.value,t.currentSheetPeople.length||0),s}),T=c(()=>C.getSummary(x.value,p.value)),U=async()=>{try{await t.addTransactions(g.value),S()}catch(s){d.notify({message:s.message||s,color:"negative"});return}};return(s,e)=>(V(),R(E,null,[a(D,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[a(F,null,{default:o(()=>[a(b,{flat:"",icon:"arrow_back",onClick:S,"aria-label":"Go Back",class:"bg-white text-primary"}),a(M),a(b,{flat:"",icon:"done",label:"Confirm",onClick:U,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),a(H,null,{default:o(()=>[a(q,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[a(k,{class:"full-width"},{default:o(()=>[w(t).currentSheet?(V(),N(A,{key:0,class:"full-width",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=r=>u.value=r),people:w(t).currentSheet.people,"sorted-people":w(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):O("",!0)]),_:1}),a(k,{class:"full-width row justify-center"},{default:o(()=>[a(P,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=r=>n.value=r),usedCurrencies:h.value,dense:"",expandable:!1,class:"q-mr-md"},null,8,["modelValue","usedCurrencies"]),a(b,{class:"q-mr-md",icon:"swap_horiz",onClick:$}),a(P,{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value=r),usedCurrencies:h.value,dense:""},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),a(q,null,{default:o(()=>[a(k,{class:"full-width row justify-center"},{default:o(()=>[a(G,{ref_key:"conversionInputRef",ref:_,outlined:"",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=r=>y.value=r),modelModifiers:{number:!0},type:"number",min:"0",label:"Conversion Rate","input-class":"text-center",onFocus:e[4]||(e[4]=r=>_.value.select())},null,8,["modelValue"])]),_:1})]),_:1}),a(Y,{summaries:T.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),a(J,{transactions:g.value,selectedPerson:u.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{me as default};
