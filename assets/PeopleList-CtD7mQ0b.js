import{L as $,M as j,r as d,al as w,a as h,W as f,w as D,N as C,x as m,z as n,I as z,y as u,T as I,U as E,v as P,V as T,O as U,P as c,K as L,Q}from"./index-C-3qNLdi.js";import{b as Y,c as A,a as K}from"./QItemLabel-Rb0KRFLf.js";import{Q as M}from"./QSlideItem-DRnR0kKO.js";import{b as W}from"./QPage-DZLj19ZR.js";import{_ as G}from"./ReceiveString-2n1czmKw.js";import{_ as q}from"./PeopleDropdown-BNNOB4vA.js";import{_ as H}from"./PersonItem-D8oCFOSK.js";const J={class:"q-mt-sm q-mb-sm q-gutter-sm flex justify-center"},te={__name:"PeopleList",props:{modelValue:{type:Object,required:!0},seeInactive:{type:Boolean,required:!0}},setup(x,{expose:F}){const a=$();j();const v=W(),g=x,s=d(w.cloneDeep(g.modelValue)),k=h(()=>Object.keys(s.value).filter(l=>g.seeInactive||s.value[l].active).sort((l,o)=>s.value[l].timestamp-s.value[o].timestamp));h(()=>Object.values(a.userLedger.friends).filter(e=>!(e.id in s.value)).sort((e,l)=>f.compare(e,l)).map(e=>e.id));const i=d(null),p=d(!1),r=d(null);F({getPeople:()=>s.value});const O=(e,l)=>{b(l,s.value[e].timestamp),delete s.value[e]},B=(e,l)=>{const o=f.make(null,s.value[l].name,"",s.value[l].timestamp);s.value[o.id]=o,delete s.value[l],y(e)},y=e=>{e.stopPropagation()},N=e=>{i.value=s.value[e].name,p.value=!0,r.value=e},R=()=>{i.value="",p.value=!0,r.value=null},b=(e,l=null)=>{s.value[e]=f.user2person(a.userLedger.friends[e]),l&&(s.value[e].timestamp=l)},V=({reset:e},l,o)=>{if(l===a.user.id){a.currentSheet?v.notify({message:"You cannot remove yourself from the sheet! Remove the sheet instead.",color:"negative"}):v.notify({message:"You cannot remove yourself from the sheet!",color:"negative"}),e();return}a.isPersonFullyRemovable(l)?(delete s.value[l],v.notify({message:"Person removed."})):(s.value[l].active=!1,v.notify({message:"Person marked as inactive."})),g.seeInactive&&o<k.value.length&&e()},S=({reset:e},l)=>{s.value[l].active=!0,e()};return D(i,e=>{if(e)if(r.value===null){const l=f.make(null,e);s.value[l.id]=l}else r.value===a.user.id?(a.setUsername(e),s.value[r.value].name=e):(a.isUserOrFriend(r.value)&&a.setFriendName(e,r.value),s.value[r.value].name=e)},{immediate:!0}),(e,l)=>(m(),C(I,null,[n(K,{bordered:"",class:"q-my-md"},{default:u(()=>[(m(!0),C(I,null,E(k.value,(o,_)=>(m(),P(M,{key:o,onLeft:t=>V(t,o,_),onClick:t=>N(o),onRight:t=>S(t,o),"left-color":"red","right-color":"green",class:T(_%2===0?"bg-grey-3":"bg-white")},{left:u(()=>[n(Q,{name:"delete"})]),right:u(()=>[n(Q,{name:"done"})]),default:u(()=>[n(Y,{clickable:""},{default:u(()=>[n(A,null,{default:u(()=>[n(H,{id:o,people:s.value},null,8,["id","people"])]),_:2},1024),c(a).isUserOrFriend(o)?U("",!0):(m(),P(q,{key:0,people:c(a).userLedger.friends,"ignored-people":s.value,onItemClick:t=>O(o,t),"is-upgrade":"",onClick:l[0]||(l[0]=t=>y(t)),"fixed-label":"Upgrade"},null,8,["people","ignored-people","onItemClick"])),c(a).isUserOrFriend(o)&&c(a).isPersonFullyRemovable(o)?(m(),P(L,{key:1,color:"grey",icon:"arrow_circle_down",label:"Downgrade",onClick:t=>B(t,o)},null,8,["onClick"])):U("",!0)]),_:2},1024)]),_:2},1032,["onLeft","onClick","onRight","class"]))),128))]),_:1}),z("div",J,[n(q,{people:c(a).userLedger.friends,"ignored-people":s.value,onItemClick:b,"fixed-label":"User"},null,8,["people","ignored-people"]),n(L,{color:"grey",icon:"person",label:"Add Person",onClick:R})]),n(G,{hideScan:!0,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value=o),isVisible:p.value,"onUpdate:isVisible":l[2]||(l[2]=o=>p.value=o)},null,8,["modelValue","isVisible"])],64))}};export{te as _};
