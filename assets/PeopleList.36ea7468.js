import{_ as w,a1 as z,r as m,az as D,a as b,ay as f,w as E,u as c,$ as C,y as n,x as u,a0 as h,a4 as T,v as P,a5 as Y,Q as I,a3 as v,a6 as L,Z as Q,X as A}from"./index.2ed0ead0.js";import{e as X,f as Z,d as G}from"./QList.8aa7f11a.js";import{Q as H}from"./QSlideItem.a87237ba.js";import{c as J}from"./QPage.eae4bdd2.js";import{_ as K}from"./ReceiveString.541320f3.js";import{_ as U}from"./PeopleDropdown.38019902.js";import{_ as M}from"./PersonItem.f4d2cba3.js";const W={class:"q-mt-sm q-mb-sm q-gutter-sm flex justify-center"},ne={__name:"PeopleList",props:{modelValue:{type:Object,required:!0},seeInactive:{type:Boolean,required:!0}},setup(q,{expose:F}){const a=w();z();const p=J(),g=q,l=m(D.cloneDeep(g.modelValue)),x=b(()=>Object.keys(l.value).filter(o=>g.seeInactive||l.value[o].active).sort((o,s)=>l.value[o].timestamp-l.value[s].timestamp));b(()=>Object.values(a.userLedger.friends).filter(e=>!(e.id in l.value)).sort((e,o)=>f.compare(e,o)).map(e=>e.id));const i=m(null),d=m(!1),r=m(null),B=m(null);F({getPeople:()=>l.value});const O=(e,o)=>{_(o,l.value[e].timestamp),delete l.value[e]},R=(e,o)=>{const s=f.make(null,l.value[o].name,"",l.value[o].timestamp);l.value[s.id]=s,delete l.value[o],k(e)},k=e=>{e.stopPropagation()},$=e=>{i.value=l.value[e].name,d.value=!0,r.value=e},N=()=>{i.value="",d.value=!0,r.value=null},_=(e,o=null)=>{l.value[e]=f.user2person(a.userLedger.friends[e]),o&&(l.value[e].timestamp=o)},y=e=>{B.value=setTimeout(()=>{e==null||e()},0)},S=({reset:e},o)=>{if(o===a.user.id){a.currentSheet?p.notify({message:"You cannot remove yourself from the sheet! Remove the sheet instead.",color:"negative"}):p.notify({message:"You cannot remove yourself from the sheet!",color:"negative"}),y(e);return}a.isPersonFullyRemovable(o)?(delete l.value[o],p.notify({message:"Person removed."})):(l.value[o].active=!1,p.notify({message:"Person marked as inactive."}),g.seeInactive&&y(e))},V=({reset:e},o)=>{l.value[o].active=!0,y(e)};return E(i,e=>{if(e)if(r.value===null){const o=f.make(null,e);l.value[o.id]=o}else r.value===a.user.id?(a.setUsername(e),l.value[r.value].name=e):(a.isUserOrFriend(r.value)&&a.setFriendName(e,r.value),l.value[r.value].name=e)},{immediate:!0}),(e,o)=>(c(),C(h,null,[n(G,{bordered:"",class:"q-my-md"},{default:u(()=>[(c(!0),C(h,null,T(x.value,(s,j)=>(c(),P(H,{key:s,onLeft:t=>S(t,s),onClick:t=>$(s),onRight:t=>V(t,s),"left-color":"red","right-color":"green",class:Y(j%2===0?"bg-grey-3":"bg-white")},{left:u(()=>[n(I,{name:"delete"})]),right:u(()=>[n(I,{name:"done"})]),default:u(()=>[n(X,{clickable:""},{default:u(()=>[n(Z,null,{default:u(()=>[n(M,{id:s,people:l.value},null,8,["id","people"])]),_:2},1024),v(a).isUserOrFriend(s)?L("",!0):(c(),P(U,{key:0,people:v(a).userLedger.friends,"ignored-people":l.value,onItemClick:t=>O(s,t),"is-upgrade":"",onClick:o[0]||(o[0]=t=>k(t))},null,8,["people","ignored-people","onItemClick"])),v(a).isUserOrFriend(s)&&v(a).isPersonFullyRemovable(s)?(c(),P(Q,{key:1,color:"grey",icon:"arrow_circle_down",label:"Downgrade",onClick:t=>R(t,s)},null,8,["onClick"])):L("",!0)]),_:2},1024)]),_:2},1032,["onLeft","onClick","onRight","class"]))),128))]),_:1}),A("div",W,[n(U,{people:v(a).userLedger.friends,"ignored-people":l.value,onItemClick:_},null,8,["people","ignored-people"]),n(Q,{color:"grey",icon:"person",label:"Add Person",onClick:N})]),n(K,{hideScan:!0,modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=s=>i.value=s),isVisible:d.value,"onUpdate:isVisible":o[2]||(o[2]=s=>d.value=s)},null,8,["modelValue","isVisible"])],64))}};export{ne as _};
