import{_ as w,a1 as D,r as m,aB as z,a as b,aA as f,w as A,u as c,$ as C,y as n,x as u,a0 as h,a5 as E,v as k,a6 as T,Q as I,a2 as v,a3 as U,Z as L,X as Y}from"./index.a806d26d.js";import{f as X,e as Z,_ as G,d as H}from"./PersonItem.7fcf1ebd.js";import{Q as J}from"./QSlideItem.581009df.js";import{c as K}from"./QPage.c0d6ab01.js";import{_ as M}from"./ReceiveString.85a91612.js";import{_ as Q}from"./PeopleDropdown.1eb61a1f.js";const W={class:"q-mt-sm q-mb-sm q-gutter-sm flex justify-center"},re={__name:"PeopleList",props:{modelValue:{type:Object,required:!0},seeInactive:{type:Boolean,required:!0}},setup(x,{expose:q}){const o=w();D();const d=K(),g=x,a=m(z.cloneDeep(g.modelValue)),B=b(()=>Object.keys(a.value).filter(l=>g.seeInactive||a.value[l].active).sort((l,s)=>a.value[l].timestamp-a.value[s].timestamp));b(()=>Object.values(o.userLedger.friends).filter(e=>!(e.id in a.value)).sort((e,l)=>f.compare(e,l)).map(e=>e.id));const i=m(null),p=m(!1),r=m(null),F=m(null);q({getPeople:()=>a.value});const O=(e,l)=>{_(l,a.value[e].timestamp),delete a.value[e]},R=(e,l)=>{const s=f.make(null,a.value[l].name,"",a.value[l].timestamp);a.value[s.id]=s,delete a.value[l],y(e)},y=e=>{e.stopPropagation()},$=e=>{i.value=a.value[e].name,p.value=!0,r.value=e},N=()=>{i.value="",p.value=!0,r.value=null},_=(e,l=null)=>{a.value[e]=f.user2person(o.userLedger.friends[e]),l&&(a.value[e].timestamp=l)},P=e=>{F.value=setTimeout(()=>{e==null||e()},0)},S=({reset:e},l)=>{if(l===o.user.id){o.currentSheet?d.notify({message:"You cannot remove yourself from the sheet! Remove the sheet instead.",color:"negative"}):d.notify({message:"You cannot remove yourself from the sheet!",color:"negative"}),P(e);return}o.isPersonFullyRemovable(l)?(delete a.value[l],d.notify({message:"Person removed."})):(a.value[l].active=!1,d.notify({message:"Person marked as inactive."}),g.seeInactive&&P(e))},V=({reset:e},l)=>{a.value[l].active=!0,P(e)};return A(i,e=>{if(e)if(r.value===null){const l=f.make(null,e);a.value[l.id]=l}else r.value===o.user.id?(o.setUsername(e),a.value[r.value].name=e):(o.isUserOrFriend(r.value)&&o.setFriendName(e,r.value),a.value[r.value].name=e)},{immediate:!0}),(e,l)=>(c(),C(h,null,[n(H,{bordered:"",class:"q-my-md"},{default:u(()=>[(c(!0),C(h,null,E(B.value,(s,j)=>(c(),k(J,{key:s,onLeft:t=>S(t,s),onClick:t=>$(s),onRight:t=>V(t,s),"left-color":"red","right-color":"green",class:T(j%2===0?"bg-grey-3":"bg-white")},{left:u(()=>[n(I,{name:"delete"})]),right:u(()=>[n(I,{name:"done"})]),default:u(()=>[n(X,{clickable:""},{default:u(()=>[n(Z,null,{default:u(()=>[n(G,{id:s,people:a.value},null,8,["id","people"])]),_:2},1024),v(o).isUserOrFriend(s)?U("",!0):(c(),k(Q,{key:0,people:v(o).userLedger.friends,"ignored-people":a.value,onItemClick:t=>O(s,t),"is-upgrade":"",onClick:l[0]||(l[0]=t=>y(t)),"fixed-label":"Upgrade"},null,8,["people","ignored-people","onItemClick"])),v(o).isUserOrFriend(s)&&v(o).isPersonFullyRemovable(s)?(c(),k(L,{key:1,color:"grey",icon:"arrow_circle_down",label:"Downgrade",onClick:t=>R(t,s)},null,8,["onClick"])):U("",!0)]),_:2},1024)]),_:2},1032,["onLeft","onClick","onRight","class"]))),128))]),_:1}),Y("div",W,[n(Q,{people:v(o).userLedger.friends,"ignored-people":a.value,onItemClick:_,"fixed-label":"User"},null,8,["people","ignored-people"]),n(L,{color:"grey",icon:"person",label:"Add Person",onClick:N})]),n(M,{hideScan:!0,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=s=>i.value=s),isVisible:p.value,"onUpdate:isVisible":l[2]||(l[2]=s=>p.value=s)},null,8,["modelValue","isVisible"])],64))}};export{re as _};
