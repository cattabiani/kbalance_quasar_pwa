import{_ as j,a1 as w,r as p,aC as D,a as b,aB as f,w as z,u as m,$ as C,y as n,x as u,a0 as h,a5 as E,v as k,a6 as T,Q as I,a2 as c,a3 as U,Z as L,X as Y}from"./index.a37d1ab0.js";import{f as A,e as X,_ as Z,d as G}from"./PersonItem.1bee8759.js";import{Q as H}from"./QSlideItem.05d97f2e.js";import{u as J}from"./use-quasar.d666003e.js";import{_ as K}from"./ReceiveString.69baf653.js";import{_ as Q}from"./PeopleDropdown.1b22bda8.js";const M={class:"q-mt-sm q-mb-sm q-gutter-sm flex justify-center"},te={__name:"PeopleList",props:{modelValue:{type:Object,required:!0},seeInactive:{type:Boolean,required:!0}},setup(x,{expose:q}){const o=j();w();const v=J(),g=x,l=p(D.cloneDeep(g.modelValue)),B=b(()=>Object.keys(l.value).filter(a=>g.seeInactive||l.value[a].active).sort((a,s)=>l.value[a].timestamp-l.value[s].timestamp));b(()=>Object.values(o.userLedger.friends).filter(e=>!(e.id in l.value)).sort((e,a)=>f.compare(e,a)).map(e=>e.id));const i=p(null),d=p(!1),r=p(null);q({getPeople:()=>l.value});const F=(e,a)=>{_(a,l.value[e].timestamp),delete l.value[e]},O=(e,a)=>{const s=f.make(null,l.value[a].name,"",l.value[a].timestamp);l.value[s.id]=s,delete l.value[a],y(e)},y=e=>{e.stopPropagation()},R=e=>{i.value=l.value[e].name,d.value=!0,r.value=e},$=()=>{i.value="",d.value=!0,r.value=null},_=(e,a=null)=>{l.value[e]=f.user2person(o.userLedger.friends[e]),a&&(l.value[e].timestamp=a)},P=e=>{setTimeout(()=>e==null?void 0:e(),0)},N=({reset:e},a)=>{if(a===o.user.id){o.currentSheet?v.notify({message:"You cannot remove yourself from the sheet! Remove the sheet instead.",color:"negative"}):v.notify({message:"You cannot remove yourself from the sheet!",color:"negative"}),P(e);return}o.isPersonFullyRemovable(a)?(delete l.value[a],v.notify({message:"Person removed."})):(l.value[a].active=!1,v.notify({message:"Person marked as inactive."}),g.seeInactive&&P(e))},S=({reset:e},a)=>{l.value[a].active=!0,P(e)};return z(i,e=>{if(e)if(r.value===null){const a=f.make(null,e);l.value[a.id]=a}else r.value===o.user.id?(o.setUsername(e),l.value[r.value].name=e):(o.isUserOrFriend(r.value)&&o.setFriendName(e,r.value),l.value[r.value].name=e)},{immediate:!0}),(e,a)=>(m(),C(h,null,[n(G,{bordered:"",class:"q-my-md"},{default:u(()=>[(m(!0),C(h,null,E(B.value,(s,V)=>(m(),k(H,{key:s,onLeft:t=>N(t,s),onClick:t=>R(s),onRight:t=>S(t,s),"left-color":"red","right-color":"green",class:T(V%2===0?"bg-grey-3":"bg-white")},{left:u(()=>[n(I,{name:"delete"})]),right:u(()=>[n(I,{name:"done"})]),default:u(()=>[n(A,{clickable:""},{default:u(()=>[n(X,null,{default:u(()=>[n(Z,{id:s,people:l.value},null,8,["id","people"])]),_:2},1024),c(o).isUserOrFriend(s)?U("",!0):(m(),k(Q,{key:0,people:c(o).userLedger.friends,"ignored-people":l.value,onItemClick:t=>F(s,t),"is-upgrade":"",onClick:a[0]||(a[0]=t=>y(t)),"fixed-label":"Upgrade"},null,8,["people","ignored-people","onItemClick"])),c(o).isUserOrFriend(s)&&c(o).isPersonFullyRemovable(s)?(m(),k(L,{key:1,color:"grey",icon:"arrow_circle_down",label:"Downgrade",onClick:t=>O(t,s)},null,8,["onClick"])):U("",!0)]),_:2},1024)]),_:2},1032,["onLeft","onClick","onRight","class"]))),128))]),_:1}),Y("div",M,[n(Q,{people:c(o).userLedger.friends,"ignored-people":l.value,onItemClick:_,"fixed-label":"User"},null,8,["people","ignored-people"]),n(L,{color:"grey",icon:"person",label:"Add Person",onClick:$})]),n(K,{hideScan:!0,modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=s=>i.value=s),isVisible:d.value,"onUpdate:isVisible":a[2]||(a[2]=s=>d.value=s)},null,8,["modelValue","isVisible"])],64))}};export{te as _};
