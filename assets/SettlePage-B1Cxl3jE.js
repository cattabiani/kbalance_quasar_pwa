import{K as T,L as B,r as S,a as o,W as d,M as V,v as p,y as t,x as n,u as _,N as y,J as f,O as s,S as q}from"./index-BN4oQykV.js";import{Q as $}from"./QSpace-Dm0rdalr.js";import{Q as O,a as N}from"./QHeader-CsjxPL6g.js";import{Q as R,a as h}from"./QCard-B7RGkhDh.js";import{b as E,Q as j}from"./QPage-DGqtd_iJ.js";import{_ as F}from"./PeopleDropdown-B1T49cPt.js";import{_ as I}from"./CurrencyDropdown-CmAAJkHu.js";import{_ as U,a as G}from"./TransactionList-CMVWEdZP.js";import"./QResizeObserver-BoJqacBm.js";import"./QItemLabel-CKcdkpKK.js";import"./selection-_pR76mky.js";import"./focusout-BgZVr1Hq.js";import"./scroll-D71Evjro.js";import"./PersonItem-bIoTSMyQ.js";import"./index-CMSkMIhu.js";import"./CurrencyDisplay-B4VyaTGU.js";import"./utils-bRICbQdu.js";import"./QSlideItem-Ro1TimLz.js";import"./use-render-cache-rinsAykk.js";const ie=Object.assign({name:"SettlePage"},{__name:"SettlePage",setup(A){const e=T(),k=B(),x=E(),r=S(e.user.id),u=o(()=>e.personId2Idx(r.value)),g=o(()=>d.getSummary(e.currentSheetResults,u.value)),C=o(()=>new Set(Object.keys(g.value.totals))),v=Object.keys(g.value.totals),m=S(v.length>0?v[0]:"USD"),b=()=>{k.go(-1)},c=o(()=>{let a=`ðŸ¤– settle ${e.getName(r.value)}`;return{...e.makeEquivalentTransactionBatch(m.value,u.value,a)}}),P=o(()=>{const a=e.getEditableCurrentSheetResults();return d.applyTransactions(a,c.value,e.currentSheetPeople.length||0),a}),Q=o(()=>d.getSummary(P.value,u.value)),w=async()=>{try{await e.addTransactions(c.value),b()}catch(a){x.notify({message:a.message||a,color:"negative"});return}};return(a,l)=>(p(),V(q,null,[t(N,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[t(O,null,{default:n(()=>[t(f,{flat:"",icon:"arrow_back",onClick:b,"aria-label":"Go Back",class:"bg-white text-primary"}),t($),s(e).currentSheetPeople.length>2?(p(),_(f,{key:0,flat:"",icon:s(e).simplifiedTransactions?"toggle_on":"toggle_off",label:s(e).simplifiedTransactions?"Simplify: ON":"Simplify: OFF",onClick:l[0]||(l[0]=i=>s(e).simplifiedTransactions=!s(e).simplifiedTransactions),class:"q-ml-md bg-white text-primary","aria-label":"Simplify"},null,8,["icon","label"])):y("",!0),t(f,{flat:"",icon:"done",label:"Confirm",onClick:w,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),t(j,null,{default:n(()=>[t(R,{class:"q-my-md q-mx-md row items-stretch q-gutter-x-md"},{default:n(()=>[t(h,{class:"col"},{default:n(()=>[s(e).currentSheet?(p(),_(F,{key:0,class:"full-width",modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=i=>r.value=i),people:s(e).currentSheet.people,"sorted-people":s(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):y("",!0)]),_:1}),t(h,{class:"row items-stretch"},{default:n(()=>[t(I,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=i=>m.value=i),usedCurrencies:C.value,expandable:!1,class:"text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),t(U,{summaries:Q.value,selectedPerson:r.value},null,8,["summaries","selectedPerson"]),t(G,{transactions:c.value,selectedPerson:r.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ie as default};
