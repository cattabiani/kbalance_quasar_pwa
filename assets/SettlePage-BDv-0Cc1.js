import{L as w,M as C,r as _,a as r,X as d,_ as B,N as V,x as y,z as t,y as l,K as S,v as $,O as q,P as p,T as R}from"./index-DWA36xbB.js";import{Q as T}from"./QSpace-FYs-qpeL.js";import{Q as N,a as I}from"./QHeader-mCgPjYfY.js";import{Q as O,a as g}from"./QCard-BifTFDg3.js";import{b as U,Q as j}from"./QPage-B3GX5a8E.js";import{_ as z}from"./PeopleDropdown-CYKt140E.js";import{_ as A}from"./CurrencyDropdown-tvbCOzpM.js";import{_ as E,a as G}from"./TransactionList-CTgh1HgM.js";import"./QResizeObserver-yeP03GHK.js";import"./QItemLabel-D1OoDGyt.js";import"./selection-BqZuD17c.js";import"./focusout-UsgZaGTF.js";import"./scroll-DY2jq601.js";import"./PersonItem-Vz_apFXz.js";import"./ClosePopup-DKzJlTYO.js";import"./CurrencyDisplay-B7sD6VSk.js";import"./QSlideItem-Jx_tFHW_.js";import"./TouchPan-DLm542e4.js";import"./use-render-cache-rinsAykk.js";const ce=Object.assign({name:"SettlePage"},{__name:"SettlePage",setup(D){const e=w(),h=C(),b=U(),s=_(e.user.id),u=r(()=>e.personId2Idx(s.value)),x=r(()=>d.summary(e.currentSheetResults,u.value)),c=r(()=>new Set(Object.keys(x.value))),o=_(c.value.size>0?Array.from(c.value)[0]:"USD"),f=r(()=>{const a=B.settle(e.currentSheetResults.perCurrencyBalance[o.value],u.value,e.currentSheetPeople);return a.name=`ðŸ¤– settle ${e.getName(s.value)} (${o.value})`,a}),m=r(()=>e.currentSheet?{...e.currentSheet.transactions,[f.value.id]:f.value}:{}),P=r(()=>d.make(m.value,e.currentSheetPeople.length)),k=r(()=>d.summary(P.value,u.value)),v=()=>{h.go(-1)},Q=async()=>{try{await e.addTransactions(m.value),v()}catch(a){b.notify({message:a.message||a,color:"negative"});return}};return(a,n)=>(y(),V(R,null,[t(I,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[t(N,null,{default:l(()=>[t(S,{flat:"",icon:"arrow_back",onClick:v,"aria-label":"Go Back",class:"bg-white text-primary"}),t(T),t(S,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),t(j,null,{default:l(()=>[t(O,{class:"q-my-md q-mx-md row items-stretch q-gutter-x-md"},{default:l(()=>[t(g,{class:"col"},{default:l(()=>[p(e).currentSheet?(y(),$(z,{key:0,class:"full-width",modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=i=>s.value=i),people:p(e).currentSheet.people,"sorted-people":p(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):q("",!0)]),_:1}),t(g,{class:"row items-stretch"},{default:l(()=>[t(A,{modelValue:o.value,"onUpdate:modelValue":n[1]||(n[1]=i=>o.value=i),usedCurrencies:c.value,expandable:!1,class:"text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),t(E,{summary:k.value,selectedPerson:s.value},null,8,["summary","selectedPerson"]),t(G,{transactions:m.value,selectedPerson:s.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ce as default};
