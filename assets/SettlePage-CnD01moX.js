import{K as w,L as P,r as b,a as o,W as d,M as T,v as _,y as t,x as n,J as p,O as l,u as B,N as V,S as q}from"./index-OHqjMywm.js";import{Q as $}from"./QSpace-Buv4YElw.js";import{Q as O,a as N}from"./QHeader-Ci3Mka8G.js";import{Q as R,a as S}from"./QCard-DiGAP1jW.js";import{b as E,Q as j}from"./QPage-BT8lmWDR.js";import{_ as F}from"./PeopleDropdown-CPGFolwZ.js";import{_ as I}from"./CurrencyDropdown-ouOZ1ex7.js";import{_ as U,a as G}from"./TransactionList-DwUvZtw6.js";import"./QResizeObserver-BRSM_QLU.js";import"./QItemLabel-CiWFurim.js";import"./selection-B2CjKgTv.js";import"./focusout-DDHkGkmr.js";import"./scroll-GtoaD4Ow.js";import"./PersonItem-C-XQqo0A.js";import"./index-B-LHsr-0.js";import"./CurrencyDisplay-BO9caMBd.js";import"./utils-bRICbQdu.js";import"./QSlideItem-C91gR_z2.js";import"./use-render-cache-rinsAykk.js";const ie=Object.assign({name:"SettlePage"},{__name:"SettlePage",setup(A){const e=w(),y=P(),h=E(),r=b(e.user.id),u=o(()=>e.personId2Idx(r.value)),f=o(()=>d.getSummary(e.currentSheetResults,u.value)),k=o(()=>new Set(Object.keys(f.value.totals))),v=Object.keys(f.value.totals),m=b(v.length>0?v[0]:"USD"),g=()=>{y.go(-1)},c=o(()=>{let a=`ðŸ¤– settle ${e.getName(r.value)}`;return{...e.makeEquivalentTransactionBatch(m.value,u.value,a)}}),x=o(()=>{const a=e.getEditableCurrentSheetResults();return d.applyTransactions(a,c.value,e.currentSheetPeople.length||0),a}),C=o(()=>d.getSummary(x.value,u.value)),Q=async()=>{try{await e.addTransactions(c.value),g()}catch(a){h.notify({message:a.message||a,color:"negative"});return}};return(a,s)=>(_(),T(q,null,[t(N,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[t(O,null,{default:n(()=>[t(p,{flat:"",icon:"arrow_back",onClick:g,"aria-label":"Go Back",class:"bg-white text-primary"}),t($),t(p,{flat:"",icon:l(e).simplifiedTransactions?"toggle_on":"toggle_off",label:l(e).simplifiedTransactions?"Simplify: ON":"Simplify: OFF",onClick:s[0]||(s[0]=i=>l(e).simplifiedTransactions=!l(e).simplifiedTransactions),class:"q-ml-md bg-white text-primary","aria-label":"Simplify"},null,8,["icon","label"]),t(p,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),t(j,null,{default:n(()=>[t(R,{class:"q-my-md q-mx-md row items-stretch q-gutter-x-md"},{default:n(()=>[t(S,{class:"col"},{default:n(()=>[l(e).currentSheet?(_(),B(F,{key:0,class:"full-width",modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=i=>r.value=i),people:l(e).currentSheet.people,"sorted-people":l(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):V("",!0)]),_:1}),t(S,{class:"row items-stretch"},{default:n(()=>[t(I,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=i=>m.value=i),usedCurrencies:k.value,expandable:!1,class:"text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),t(U,{summaries:C.value,selectedPerson:r.value},null,8,["summaries","selectedPerson"]),t(G,{transactions:c.value,selectedPerson:r.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ie as default};
