import{K as P,L as w,r as g,a as r,W as i,M as B,v as _,y as e,x as l,J as b,u as V,N as q,O as d,S as T}from"./index-W2ALfwlx.js";import{Q as $}from"./QSpace-DHCKSxgY.js";import{Q as R,a as E}from"./QHeader-BRcXRzvu.js";import{Q as N,a as S}from"./QCard-BCEvf-VB.js";import{b as O,Q as j}from"./use-quasar-Coi22Qef.js";import{_ as I}from"./PeopleDropdown-CsoyGOIE.js";import{_ as U}from"./CurrencyDropdown-Dj3769Oq.js";import{_ as G,a as A}from"./TransactionList-DS5UjU1t.js";import"./QResizeObserver-CHrHWW-i.js";import"./QItemLabel-BC6t_Py-.js";import"./selection-CDvpGUNZ.js";import"./focusout-S5ZPnDlY.js";import"./scroll-BqtLWLdj.js";import"./PersonItem-DfzKIQCL.js";import"./index-FUS9e5le.js";import"./CurrencyDisplay-IpPMWd32.js";import"./utils-bRICbQdu.js";import"./QSlideItem-DcoqaPRI.js";import"./use-render-cache-rinsAykk.js";const ue=Object.assign({name:"SettlePage"},{__name:"SettlePage",setup(D){const t=P(),h=w(),y=O(),s=g(t.user.id),n=r(()=>t.personId2Idx(s.value)),p=r(()=>i.getSummary(t.currentSheetResults,n.value)),k=r(()=>new Set(Object.keys(p.value.totals))),f=Object.keys(p.value.totals),u=g(f.length>0?f[0]:"USD"),v=()=>{h.go(-1)},c=r(()=>{let a=`ðŸ¤– settle ${t.getName(s.value)}`;return{...t.makeEquivalentTransactionBatch(u.value,n.value,a)}}),x=r(()=>{const a=t.getEditableCurrentSheetResults();return i.applyTransactions(a,c.value,t.currentSheetPeople.length||0),a}),Q=r(()=>i.getSummary(x.value,n.value)),C=async()=>{try{await t.addTransactions(c.value),v()}catch(a){y.notify({message:a.message||a,color:"negative"});return}};return(a,o)=>(_(),B(T,null,[e(E,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e(R,null,{default:l(()=>[e(b,{flat:"",icon:"arrow_back",onClick:v,"aria-label":"Go Back",class:"bg-white text-primary"}),e($),e(b,{flat:"",icon:"done",label:"Confirm",onClick:C,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),e(j,null,{default:l(()=>[e(N,{class:"q-my-md q-mx-md row items-stretch q-gutter-x-md"},{default:l(()=>[e(S,{class:"col"},{default:l(()=>[d(t).currentSheet?(_(),V(I,{key:0,class:"full-width",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=m=>s.value=m),people:d(t).currentSheet.people,"sorted-people":d(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):q("",!0)]),_:1}),e(S,{class:"row items-stretch"},{default:l(()=>[e(U,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=m=>u.value=m),usedCurrencies:k.value,expandable:!1,class:"text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),e(G,{summaries:Q.value,selectedPerson:s.value},null,8,["summaries","selectedPerson"]),e(A,{transactions:c.value,selectedPerson:s.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ue as default};
