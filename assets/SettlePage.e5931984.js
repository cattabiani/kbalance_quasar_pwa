import{O as Q,r as g,a as r,u as _,P as w,y as e,x as l,S as V,T as B,N as b,U as i,v as T,V as q,aC as d}from"./index.6c9dbb9d.js";import{Q as $}from"./QSpace.ec22de2b.js";import{Q as R,a as E}from"./QHeader.aa67bcc9.js";import{a as N,Q as S}from"./QCard.286ea9ca.js";import{Q as O,b as U}from"./QPage.356567f5.js";import{_ as j}from"./PeopleDropdown.5a2587c3.js";import{_ as I}from"./CurrencyDropdown.8b9e65e9.js";import{_ as G,a as A}from"./TransactionList.a700bec2.js";import"./QResizeObserver.eaf11141.js";import"./QMenu.5bc3788b.js";import"./selection.4f31b2ee.js";import"./focusout.99986f41.js";import"./scroll.e304a2b9.js";import"./PersonItem.2b58404e.js";import"./index.1accded2.js";import"./CurrencyDisplay.42b4d706.js";import"./QSlideItem.06c41a57.js";import"./use-render-cache.770e5fe8.js";import"./utils.8924f51f.js";const ue=Object.assign({name:"SettlePage"},{__name:"SettlePage",setup(D){const t=Q(),h=B(),y=U(),s=g(t.user.id),n=r(()=>t.personId2Idx(s.value)),p=r(()=>d.getSummary(t.currentSheetResults,n.value)),k=r(()=>new Set(Object.keys(p.value.totals))),f=Object.keys(p.value.totals),u=g(f.length>0?f[0]:"USD"),v=()=>{h.go(-1)},c=r(()=>{let a=`\u{1F916} settle ${t.getName(s.value)}`;return{...t.makeEquivalentTransactionBatch(u.value,n.value,a)}}),x=r(()=>{const a=t.getEditableCurrentSheetResults();return d.applyTransactions(a,c.value,t.currentSheetPeople.length||0),a}),C=r(()=>d.getSummary(x.value,n.value)),P=async()=>{try{await t.addTransactions(c.value),v()}catch(a){y.notify({message:a.message||a,color:"negative"});return}};return(a,o)=>(_(),w(V,null,[e(R,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e(E,null,{default:l(()=>[e(b,{flat:"",icon:"arrow_back",onClick:v,"aria-label":"Go Back",class:"bg-white text-primary"}),e($),e(b,{flat:"",icon:"done",label:"Confirm",onClick:P,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),e(O,null,{default:l(()=>[e(N,{class:"q-my-md q-mx-md row items-stretch q-gutter-x-md"},{default:l(()=>[e(S,{class:"col"},{default:l(()=>[i(t).currentSheet?(_(),T(j,{key:0,class:"full-width",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=m=>s.value=m),people:i(t).currentSheet.people,"sorted-people":i(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):q("",!0)]),_:1}),e(S,{class:"row items-stretch"},{default:l(()=>[e(I,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=m=>u.value=m),usedCurrencies:k.value,expandable:!1,class:"text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),e(G,{summaries:C.value,selectedPerson:s.value},null,8,["summaries","selectedPerson"]),e(A,{transactions:c.value,selectedPerson:s.value,disableEdit:!0,disableRemove:!0},null,8,["transactions","selectedPerson"])]),_:1})],64))}});export{ue as default};
