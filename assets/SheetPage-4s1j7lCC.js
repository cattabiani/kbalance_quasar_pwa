import{L as J,M as K,r as f,a as B,X,w as L,N as Y,x as i,z as e,y as a,B as m,K as k,O as N,v as d,Q as g,J as h,Y as Z,I as C,P as _,T as W,Z as ee}from"./index-DWA36xbB.js";import{Q as te}from"./QSpace-FYs-qpeL.js";import{a as ae,b as v,c as n}from"./QItemLabel-D1OoDGyt.js";import{Q as se,_ as oe}from"./PeopleDropdown-CYKt140E.js";import{Q as q,a as le}from"./QHeader-mCgPjYfY.js";import{b as R,Q as ne,a as re}from"./QCard-BifTFDg3.js";import{b as ce,Q as ie}from"./QPage-B3GX5a8E.js";import{C as y}from"./ClosePopup-DKzJlTYO.js";import{_ as ue,a as me}from"./TransactionList-CTgh1HgM.js";import"./selection-BqZuD17c.js";import"./focusout-UsgZaGTF.js";import"./scroll-DY2jq601.js";import"./PersonItem-Vz_apFXz.js";import"./QResizeObserver-yeP03GHK.js";import"./CurrencyDisplay-B7sD6VSk.js";import"./QSlideItem-Jx_tFHW_.js";import"./TouchPan-DLm542e4.js";import"./use-render-cache-rinsAykk.js";const de={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},pe={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},fe={class:"row justify-center items-center q-pb-md"},qe=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ge){var T,V,I;const o=J(),c=K(),u=ce(),S=f((I=(V=o.userLedger)==null?void 0:V.sheets[(T=o.currentSheet)==null?void 0:T.id])==null?void 0:I.name),p=f(o.user.id),U=B(()=>o.personId2Idx(p.value)),b=f(null),w=f(!1),P=f(null),Q=B(()=>X.summary(o.currentSheetResults,U.value)),j=async(t,s)=>{try{const l=`Are you sure you want to remove ${o.currentSheet.transactions[s]||"(New Transaction)"}?`;u.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>t()},{label:"Confirm",color:"red",handler:async()=>{o.removeTransaction(s),u.notify({message:"Transaction removed successfully!"})}}]})}catch(l){t(),u.notify({message:l.message||l,color:"negative"})}},O=t=>{o.transactionId=t,c.push({name:"TransactionPage"})},$=()=>{o.transactionId=null,c.push({name:"TransactionPage"})},A=async()=>{try{await o.setSheetName(S.value)}catch(t){u.notify({message:t.message||t,color:"negative"})}},E=()=>{c.push({name:"PeoplePage"})},D=()=>{c.push({name:"ConvertPage"})},M=()=>{c.push({name:"SettlePage"})},z=()=>{c.push({name:"StatisticsPage"})},x=()=>{try{o.clearCurrentSheet(),c.go(-1)}catch(t){u.notify({message:t.message||t,color:"negative"});return}};L(o.currentSheet,async t=>{t===null&&x()},{immediate:!0});const F=async()=>{try{await o.logout(),c.push({name:"LoginPage"})}catch(t){u.notify({message:t.message||t,color:"negative"});return}};L(o.userLedger,async t=>{t===null&&await F()},{immediate:!0});const G=()=>{w.value=!w.value,w.value?ee(()=>{var t;(t=P.value)==null||t.focus()}):b.value=""},H=()=>{const t=o.currentSheetToCsv(),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.setAttribute("download","sheet.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)};return(t,s)=>(i(),Y(W,null,[e(le,{elevated:"",class:"bg-primary text-white"},{default:a(()=>[e(q,null,{default:a(()=>[e(k,{flat:"",icon:"arrow_back",onClick:x,"aria-label":"Go Back",class:"bg-white text-primary"}),e(te),e(k,{flat:"",icon:"search",label:"Search",onClick:G,class:"bg-white text-primary q-mr-sm"}),e(se,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:a(()=>[e(ae,null,{default:a(()=>[m((i(),d(v,{clickable:"",onClick:E,class:"bg-grey-3"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"people"})]),_:1}),e(n,null,{default:a(()=>[...s[3]||(s[3]=[h("People",-1)])]),_:1})]),_:1})),[[y]]),m((i(),d(v,{clickable:"",onClick:D},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"currency_exchange"})]),_:1}),e(n,null,{default:a(()=>[...s[4]||(s[4]=[h("Convert",-1)])]),_:1})]),_:1})),[[y]]),Object.keys(Q.value).length>0?m((i(),d(v,{key:0,clickable:"",onClick:M},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"payments"})]),_:1}),e(n,null,{default:a(()=>[...s[5]||(s[5]=[h("Settle",-1)])]),_:1})]),_:1})),[[y]]):N("",!0),m((i(),d(v,{clickable:"",onClick:H},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"download"})]),_:1}),e(n,null,{default:a(()=>[...s[6]||(s[6]=[h("Download (csv)",-1)])]),_:1})]),_:1})),[[y]]),m((i(),d(v,{clickable:"",onClick:z},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"insights"})]),_:1}),e(n,null,{default:a(()=>[...s[7]||(s[7]=[h("Statistics",-1)])]),_:1})]),_:1})),[[y]])]),_:1})]),_:1})]),_:1}),m(e(q,{class:"bg-primary q-pa-sm"},{default:a(()=>[e(R,{ref_key:"searchInput",ref:P,dense:"",outlined:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=l=>b.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[Z,w.value]])]),_:1}),e(ie,null,{default:a(()=>{var l;return[e(ne,{class:"q-my-md q-mr-md q-ml-md"},{default:a(()=>[e(re,{class:"row no-wrap items-center"},{default:a(()=>[C("div",de,[_(o).currentSheet?(i(),d(oe,{key:0,modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=r=>p.value=r),people:_(o).currentSheet.people,"sorted-people":_(o).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):N("",!0)]),C("div",pe,[e(R,{modelValue:S.value,"onUpdate:modelValue":s[2]||(s[2]=r=>S.value=r),onBlur:A,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(ue,{summary:Q.value,selectedPerson:p.value},null,8,["summary","selectedPerson"]),C("div",fe,[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:$})]),e(me,{transactions:((l=_(o).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:p.value,"search-string":b.value,onRemove:j,onEdit:O},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{qe as default};
