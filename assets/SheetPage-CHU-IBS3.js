import{K as J,L as K,r as d,a as B,W,w as L,M as X,v as i,y as e,x as a,A as p,J as k,N,u as f,Q as g,I as y,X as Y,H as C,O as b,S as z,Y as Z}from"./index-CYG2IzWo.js";import{Q as ee}from"./QSpace-DOIFWXm_.js";import{a as te,b as w,c as n}from"./QItemLabel-DJ4175_z.js";import{Q as ae,_ as oe}from"./PeopleDropdown-b6ueENDk.js";import{Q as q,a as se}from"./QHeader-CZvIJgU3.js";import{b as R,Q as le,a as re}from"./QCard-DI5g04FU.js";import{b as ne,Q as ce}from"./QPage-y6rv__Ta.js";import{C as _}from"./index-BRoRvwsn.js";import{_ as ue,a as ie}from"./TransactionList-DfSXnw26.js";import"./selection-EuKqAGgH.js";import"./focusout-CObUXZst.js";import"./scroll-sHdrKqgP.js";import"./PersonItem-DUs9hOAU.js";import"./QResizeObserver-DH6Lyl8P.js";import"./CurrencyDisplay-CzpuhY6c.js";import"./QSlideItem-BPy0Kenu.js";import"./use-render-cache-rinsAykk.js";const me={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},de={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},pe={class:"row justify-center items-center q-pb-md"},Le=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(fe){var T,V,I;const o=J(),c=K(),u=ne(),S=d((I=(V=o.userLedger)==null?void 0:V.sheets[(T=o.currentSheet)==null?void 0:T.id])==null?void 0:I.name),m=d(o.user.id),U=B(()=>o.personId2Idx(m.value)),h=d(null),v=d(!1),P=d(null),Q=B(()=>W.summary(o.currentSheetResults,U.value)),j=async(t,s)=>{try{const l=`Are you sure you want to remove ${o.currentSheet.transactions[s]||"(New Transaction)"}?`;u.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>t()},{label:"Confirm",color:"red",handler:async()=>{o.removeTransaction(s),u.notify({message:"Transaction removed successfully!"})}}]})}catch(l){t(),u.notify({message:l.message||l,color:"negative"})}},A=t=>{o.transactionId=t,c.push({name:"TransactionPage"})},O=()=>{o.transactionId=null,c.push({name:"TransactionPage"})},$=async()=>{try{await o.setSheetName(S.value)}catch(t){u.notify({message:t.message||t,color:"negative"})}},E=()=>{c.push({name:"PeoplePage"})},D=()=>{c.push({name:"ConvertPage"})},H=()=>{c.push({name:"SettlePage"})},x=()=>{try{o.clearCurrentSheet(),c.go(-1)}catch(t){u.notify({message:t.message||t,color:"negative"});return}};L(o.currentSheet,async t=>{t===null&&x()},{immediate:!0});const M=async()=>{try{await o.logout(),c.push({name:"LoginPage"})}catch(t){u.notify({message:t.message||t,color:"negative"});return}};L(o.userLedger,async t=>{t===null&&await M()},{immediate:!0});const F=()=>{v.value=!v.value,v.value?Z(()=>{var t;(t=P.value)==null||t.focus()}):h.value=""},G=()=>{const t=o.currentSheetToCsv(),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.setAttribute("download","sheet.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)};return(t,s)=>(i(),X(z,null,[e(se,{elevated:"",class:"bg-primary text-white"},{default:a(()=>[e(q,null,{default:a(()=>[e(k,{flat:"",icon:"arrow_back",onClick:x,"aria-label":"Go Back",class:"bg-white text-primary"}),e(ee),e(k,{flat:"",icon:"search",label:"Search",onClick:F,class:"bg-white text-primary q-mr-sm"}),e(ae,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:a(()=>[e(te,null,{default:a(()=>[p((i(),f(w,{clickable:"",onClick:E,class:"bg-grey-3"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"people"})]),_:1}),e(n,null,{default:a(()=>[...s[3]||(s[3]=[y("People",-1)])]),_:1})]),_:1})),[[_]]),p((i(),f(w,{clickable:"",onClick:D},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"currency_exchange"})]),_:1}),e(n,null,{default:a(()=>[...s[4]||(s[4]=[y("Convert",-1)])]),_:1})]),_:1})),[[_]]),Object.keys(Q.value).length>0?p((i(),f(w,{key:0,clickable:"",onClick:H},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"payments"})]),_:1}),e(n,null,{default:a(()=>[...s[5]||(s[5]=[y("Settle",-1)])]),_:1})]),_:1})),[[_]]):N("",!0),p((i(),f(w,{clickable:"",onClick:G},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(g,{name:"download"})]),_:1}),e(n,null,{default:a(()=>[...s[6]||(s[6]=[y("Download (csv)",-1)])]),_:1})]),_:1})),[[_]])]),_:1})]),_:1})]),_:1}),p(e(q,{class:"bg-primary q-pa-sm"},{default:a(()=>[e(R,{ref_key:"searchInput",ref:P,dense:"",outlined:"",debounce:"300",modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=l=>h.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[Y,v.value]])]),_:1}),e(ce,null,{default:a(()=>{var l;return[e(le,{class:"q-my-md q-mr-md q-ml-md"},{default:a(()=>[e(re,{class:"row no-wrap items-center"},{default:a(()=>[C("div",me,[b(o).currentSheet?(i(),f(oe,{key:0,modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=r=>m.value=r),people:b(o).currentSheet.people,"sorted-people":b(o).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):N("",!0)]),C("div",de,[e(R,{modelValue:S.value,"onUpdate:modelValue":s[2]||(s[2]=r=>S.value=r),onBlur:$,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(ue,{summary:Q.value,selectedPerson:m.value},null,8,["summary","selectedPerson"]),C("div",pe,[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:O})]),e(ie,{transactions:((l=b(o).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:m.value,"search-string":h.value,onRemove:j,onEdit:A},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{Le as default};
