import{K as J,L as K,r as g,a as L,W,w as N,M as X,v as u,y as e,x as s,A as d,J as P,N as S,u as p,Q as v,I as h,O as c,P as Y,X as Z,H as Q,S as z,Y as ee,Z as te}from"./index-BN4oQykV.js";import{Q as ae}from"./QSpace-Dm0rdalr.js";import{a as se,b as y,c as n}from"./QItemLabel-CKcdkpKK.js";import{Q as oe,_ as le}from"./PeopleDropdown-B1T49cPt.js";import{Q as q,a as ne}from"./QHeader-CsjxPL6g.js";import{b as R,Q as re,a as ce}from"./QCard-B7RGkhDh.js";import{b as ie,Q as ue}from"./QPage-DGqtd_iJ.js";import{C as b}from"./index-CMSkMIhu.js";import{_ as me,a as de}from"./TransactionList-CMVWEdZP.js";import"./selection-_pR76mky.js";import"./focusout-BgZVr1Hq.js";import"./scroll-D71Evjro.js";import"./PersonItem-bIoTSMyQ.js";import"./QResizeObserver-BoJqacBm.js";import"./CurrencyDisplay-B4VyaTGU.js";import"./utils-bRICbQdu.js";import"./QSlideItem-Ro1TimLz.js";import"./use-render-cache-rinsAykk.js";const pe={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},fe={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},ge={class:"row justify-center items-center q-pb-md"},Re=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ve){var V,I,B;const t=J(),i=K(),m=ie(),k=g((B=(I=t.userLedger)==null?void 0:I.sheets[(V=t.currentSheet)==null?void 0:V.id])==null?void 0:B.name),f=g(t.user.id),O=L(()=>t.personId2Idx(f.value)),_=g(null),w=g(!1),T=g(null),C=L(()=>W.getSummary(t.currentSheetResults,O.value)),U=async(a,o)=>{try{const l=`Are you sure you want to remove ${te.name(t.currentSheet.transactions[o])}?`;m.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(o),m.notify({message:"Transaction removed successfully!"})}}]})}catch(l){a(),m.notify({message:l.message||l,color:"negative"})}},$=a=>{t.transactionId=a,i.push({name:"TransactionPage"})},j=()=>{t.transactionId=null,i.push({name:"TransactionPage"})},A=async()=>{try{await t.setSheetName(k.value)}catch(a){m.notify({message:a.message||a,color:"negative"})}},D=()=>{i.push({name:"PeoplePage"})},E=()=>{i.push({name:"ConvertPage"})},F=()=>{i.push({name:"SettlePage"})},x=()=>{try{t.clearCurrentSheet(),i.go(-1)}catch(a){m.notify({message:a.message||a,color:"negative"});return}};N(t.currentSheet,async a=>{a===null&&x()},{immediate:!0});const H=async()=>{try{await t.logout(),i.push({name:"LoginPage"})}catch(a){m.notify({message:a.message||a,color:"negative"});return}};N(t.userLedger,async a=>{a===null&&await H()},{immediate:!0});const M=()=>{w.value=!w.value,w.value?ee(()=>{var a;(a=T.value)==null||a.focus()}):_.value=""},G=()=>{const a=t.currentSheetToCsv(),o=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(o),r=document.createElement("a");r.href=l,r.setAttribute("download","sheet.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)};return(a,o)=>(u(),X(z,null,[e(ne,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[e(q,null,{default:s(()=>[e(P,{flat:"",icon:"arrow_back",onClick:x,"aria-label":"Go Back",class:"bg-white text-primary"}),e(ae),e(P,{flat:"",icon:"search",label:"Search",onClick:M,class:"bg-white text-primary q-mr-sm"}),e(oe,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:s(()=>[e(se,null,{default:s(()=>[d((u(),p(y,{clickable:"",onClick:D,class:"bg-grey-3"},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"people"})]),_:1}),e(n,null,{default:s(()=>[...o[4]||(o[4]=[h("People",-1)])]),_:1})]),_:1})),[[b]]),Object.keys(C.value.totals).length>1?d((u(),p(y,{key:0,clickable:"",onClick:E},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"currency_exchange"})]),_:1}),e(n,null,{default:s(()=>[...o[5]||(o[5]=[h("Convert",-1)])]),_:1})]),_:1})),[[b]]):S("",!0),C.value.ans.length?d((u(),p(y,{key:1,clickable:"",onClick:F},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"payments"})]),_:1}),e(n,null,{default:s(()=>[...o[6]||(o[6]=[h("Settle",-1)])]),_:1})]),_:1})),[[b]]):S("",!0),d((u(),p(y,{clickable:"",onClick:G},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"download"})]),_:1}),e(n,null,{default:s(()=>[...o[7]||(o[7]=[h("Download (csv)",-1)])]),_:1})]),_:1})),[[b]]),c(t).currentSheetPeople.length>2?d((u(),p(y,{key:2,clickable:"",onClick:o[0]||(o[0]=l=>c(t).simplifiedTransactions=!c(t).simplifiedTransactions)},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:c(t).simplifiedTransactions?"toggle_on":"toggle_off"},null,8,["name"])]),_:1}),e(n,null,{default:s(()=>[h(Y(c(t).simplifiedTransactions?"Simplify: ON":"Simplify: OFF"),1)]),_:1})]),_:1})),[[b]]):S("",!0)]),_:1})]),_:1})]),_:1}),d(e(q,{class:"bg-primary q-pa-sm"},{default:s(()=>[e(R,{ref_key:"searchInput",ref:T,dense:"",outlined:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=l=>_.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[Z,w.value]])]),_:1}),e(ue,null,{default:s(()=>{var l;return[e(re,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[e(ce,{class:"row no-wrap items-center"},{default:s(()=>[Q("div",pe,[c(t).currentSheet?(u(),p(le,{key:0,modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=r=>f.value=r),people:c(t).currentSheet.people,"sorted-people":c(t).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):S("",!0)]),Q("div",fe,[e(R,{modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=r=>k.value=r),onBlur:A,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(me,{summaries:C.value,selectedPerson:f.value},null,8,["summaries","selectedPerson"]),Q("div",ge,[e(P,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:j})]),e(de,{transactions:((l=c(t).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:f.value,"search-string":_.value,onRemove:U,onEdit:$},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{Re as default};
