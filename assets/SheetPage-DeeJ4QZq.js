import{K as W,L as X,r as g,a as k,W as R,w as q,M as Y,v as u,y as e,x as s,A as d,J as C,N as P,u as p,Q as v,I as h,O as i,P as Z,X as z,H as T,S as ee,Y as te,Z as ae}from"./index-D5luScLF.js";import{Q as se}from"./QSpace-DR9CgmsW.js";import{a as oe,b as y,c as n}from"./QItemLabel-qHPq7E9M.js";import{Q as le,_ as ne}from"./PeopleDropdown-BXuJS13G.js";import{Q as U,a as re}from"./QHeader-DV2W9MlG.js";import{b as O,Q as ie,a as ce}from"./QCard-DQFddnpL.js";import{b as ue,Q as me}from"./use-quasar-BnlHMNnk.js";import{C as b}from"./index-CdrjR-oO.js";import{_ as de,a as pe}from"./TransactionList-IOmCN6Qf.js";import"./selection-DhgIaGfX.js";import"./focusout-DwoWywsW.js";import"./scroll-CRy3dWyG.js";import"./PersonItem-Btb4iB6O.js";import"./QResizeObserver-CV7oLgMC.js";import"./CurrencyDisplay-9LvxQP4f.js";import"./utils-bRICbQdu.js";import"./QSlideItem-BDFsk19E.js";import"./use-render-cache-rinsAykk.js";const fe={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},ge={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},ve={class:"row justify-center items-center q-pb-md"},Ue=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(he){var B,L,N;const t=W(),c=X(),m=ue(),S=g((N=(L=t.userLedger)==null?void 0:L.sheets[(B=t.currentSheet)==null?void 0:B.id])==null?void 0:N.name),f=g(t.user.id),Q=k(()=>t.personId2Idx(f.value)),_=g(null),w=g(!1),x=g(null),V=k(()=>R.getSummary(t.currentSheetResults,Q.value)),$=k(()=>R.getSummary(t.currentSheetResults,Q.value,t.simplifiedTransactions)),A=async(a,o)=>{try{const l=`Are you sure you want to remove ${ae.name(t.currentSheet.transactions[o])}?`;m.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(o),m.notify({message:"Transaction removed successfully!"})}}]})}catch(l){a(),m.notify({message:l.message||l,color:"negative"})}},j=a=>{t.transactionId=a,c.push({name:"TransactionPage"})},D=()=>{t.transactionId=null,c.push({name:"TransactionPage"})},E=async()=>{try{await t.setSheetName(S.value)}catch(a){m.notify({message:a.message||a,color:"negative"})}},F=()=>{c.push({name:"PeoplePage"})},H=()=>{c.push({name:"ConvertPage"})},M=()=>{c.push({name:"SettlePage"})},I=()=>{try{t.clearCurrentSheet(),c.go(-1)}catch(a){m.notify({message:a.message||a,color:"negative"});return}};q(t.currentSheet,async a=>{a===null&&I()},{immediate:!0});const G=async()=>{try{await t.logout(),c.push({name:"LoginPage"})}catch(a){m.notify({message:a.message||a,color:"negative"});return}};q(t.userLedger,async a=>{a===null&&await G()},{immediate:!0});const J=()=>{w.value=!w.value,w.value?te(()=>{var a;(a=x.value)==null||a.focus()}):_.value=""},K=()=>{const a=t.currentSheetToCsv(),o=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(o),r=document.createElement("a");r.href=l,r.setAttribute("download","sheet.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)};return(a,o)=>(u(),Y(ee,null,[e(re,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[e(U,null,{default:s(()=>[e(C,{flat:"",icon:"arrow_back",onClick:I,"aria-label":"Go Back",class:"bg-white text-primary"}),e(se),e(C,{flat:"",icon:"search",label:"Search",onClick:J,class:"bg-white text-primary q-mr-sm"}),e(le,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:s(()=>[e(oe,null,{default:s(()=>[d((u(),p(y,{clickable:"",onClick:F,class:"bg-grey-3"},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"people"})]),_:1}),e(n,null,{default:s(()=>[...o[4]||(o[4]=[h("People",-1)])]),_:1})]),_:1})),[[b]]),V.value.ans.length?d((u(),p(y,{key:0,clickable:"",onClick:H},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"currency_exchange"})]),_:1}),e(n,null,{default:s(()=>[...o[5]||(o[5]=[h("Convert",-1)])]),_:1})]),_:1})),[[b]]):P("",!0),V.value.ans.length?d((u(),p(y,{key:1,clickable:"",onClick:M},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"payments"})]),_:1}),e(n,null,{default:s(()=>[...o[6]||(o[6]=[h("Settle",-1)])]),_:1})]),_:1})),[[b]]):P("",!0),d((u(),p(y,{clickable:"",onClick:K},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:"download"})]),_:1}),e(n,null,{default:s(()=>[...o[7]||(o[7]=[h("Download (csv)",-1)])]),_:1})]),_:1})),[[b]]),d((u(),p(y,{clickable:"",onClick:o[0]||(o[0]=l=>i(t).simplifiedTransactions=!i(t).simplifiedTransactions)},{default:s(()=>[e(n,{avatar:""},{default:s(()=>[e(v,{name:i(t).simplifiedTransactions?"toggle_on":"toggle_off"},null,8,["name"])]),_:1}),e(n,null,{default:s(()=>[h(Z(i(t).simplifiedTransactions?"Simplify: ON":"Simplify: OFF"),1)]),_:1})]),_:1})),[[b]])]),_:1})]),_:1})]),_:1}),d(e(U,{class:"bg-primary q-pa-sm"},{default:s(()=>[e(O,{ref_key:"searchInput",ref:x,dense:"",outlined:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=l=>_.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[z,w.value]])]),_:1}),e(me,null,{default:s(()=>{var l;return[e(ie,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[e(ce,{class:"row no-wrap items-center"},{default:s(()=>[T("div",fe,[i(t).currentSheet?(u(),p(ne,{key:0,modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=r=>f.value=r),people:i(t).currentSheet.people,"sorted-people":i(t).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):P("",!0)]),T("div",ge,[e(O,{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=r=>S.value=r),onBlur:E,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(de,{summaries:$.value,selectedPerson:f.value},null,8,["summaries","selectedPerson"]),T("div",ve,[e(C,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:D})]),e(pe,{transactions:((l=i(t).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:f.value,"search-string":_.value,onRemove:A,onEdit:j},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{Ue as default};
