import{F as M,r as _,a as b,w as R,u as c,C as v,y as l,x as s,I as Q,J as G,K as N,E as i,v as S,D as m,N as o,G as t,H as P,L as j,ap as H,U as d,aq as J,Q as K,M as W}from"./index.926519d6.js";import{Q as X,b as Y,c as Z,d as ee,e as te,f as k}from"./QDialog.e32d59db.js";import{Q as ae,u as re,b as ne,c as T,a as se}from"./use-quasar.5501894d.js";import{Q as f}from"./QSelect.c9d02533.js";import{Q as le}from"./QSlideItem.58f75e8f.js";import{_ as oe}from"./SelectPerson.dffe3b2d.js";import"./QResizeObserver.0e5554d1.js";const ue={class:"q-pa-md"},ce={key:0,style:{color:"green"}},me={key:1,style:{color:"red"}},ie={class:"q-pa-md"},_e=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(de){const x=re(),e=M(),w=G(),I=_(null),V=_(null),h=_(null),u=_(e.currentSheetPeople.indexOf(e.getCurrentUserId())),D=b(()=>(e.currentSheetPeople||[]).map((r,a)=>({label:e.username(r)||"New Person",isUser:e.isUser(r),value:a})));R(()=>e.currentSheetLedger,n=>{h.value=n==null?void 0:n.name},{immediate:!0});const $=async()=>{try{await e.setCurrentSheetName(h.value)}catch(n){x.notify({message:n.message||n});return}},g=b(()=>{const{ans:n,totals:r}=H.getSummary(e.currentSheetResults,u.value);return{detail:n.map((p,y)=>({...p,id:y})),totals:r}}),C=b(()=>Object.entries(g.value.totals).filter(([n,r])=>r>0).map(([n,r])=>d.displayCurrency(n,r)).join(" + ")),q=b(()=>Object.entries(g.value.totals).filter(([n,r])=>r<0).map(([n,r])=>d.displayCurrency(n,-r)).join(" + ")),B=(n=null)=>{e.transactionId=n,w.push({name:"TransactionPage"})},z=async()=>{await e.clearCurrentSheet(),w.go(-1)},A=()=>{w.push({name:"PeoplePage"})},E=n=>{V.value=setTimeout(()=>{n==null||n()},0)},F=async({reset:n},r)=>{E(n),await new Promise(a=>{setTimeout(async()=>{try{await e.removeTransaction(r),a()}catch(p){x.notify({message:p.message||p}),a()}},0)})};return(n,r)=>(c(),v(Q,null,[l(X,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[l(Y,null,{default:s(()=>[l(N,{flat:"",icon:"arrow_back",onClick:z,"aria-label":"Go Back",class:"bg-white text-primary"}),l(Z,{style:{"font-size":"28px"}},{default:s(()=>r[4]||(r[4]=[i(" Sheet ")])),_:1}),l(N,{flat:"",icon:"people",onClick:A,class:"q-ml-md bg-white text-primary","aria-label":"Edit people"}),l(N,{flat:"",icon:"add",onClick:r[0]||(r[0]=a=>B()),class:"q-ml-md bg-white text-primary","aria-label":"Add a new transaction"})]),_:1})]),_:1}),l(ae,null,{default:s(()=>[l(ne,{class:"q-my-md q-mr-md q-ml-md",ref_key:"nameInput",ref:I,modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=a=>h.value=a),label:"Sheet Name",autogrow:"",outlined:"",onFocus:r[2]||(r[2]=a=>I.value.select()),onBlur:$},null,8,["modelValue"]),l(oe,{modelValue:u.value,"onUpdate:modelValue":r[3]||(r[3]=a=>u.value=a),peopleOptions:D.value},null,8,["modelValue","peopleOptions"]),q.value||C.value?(c(),S(T,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[m("div",ue,[q.value?(c(),v("div",ce,o(t(e).username(t(e).currentSheetPeople[u.value]))+" is owed "+o(q.value),1)):P("",!0),C.value?(c(),v("div",me,o(t(e).username(t(e).currentSheetPeople[u.value]))+" owes "+o(C.value),1)):P("",!0)])]),_:1})):P("",!0),g.value.detail.length>0?(c(),S(T,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[m("div",ie,[(c(!0),v(Q,null,j(g.value.detail,a=>(c(),v("div",{key:a.id},[m("div",null,[m("span",null,o(a.amount>0?t(e).username(t(e).currentSheetPeople[u.value]):t(e).username(t(e).currentSheetPeople[a.person])),1),r[5]||(r[5]=m("span",null," owes ",-1)),m("span",null,o(a.amount<0?t(e).username(t(e).currentSheetPeople[u.value]):t(e).username(t(e).currentSheetPeople[a.person]))+" \xA0 ",1),m("span",{style:J({color:a.amount>0?"red":"green"})},o(t(d).displayCurrency(a.currency,Math.abs(a.amount))),5)])]))),128))])]),_:1})):P("",!0),l(ee,null,{default:s(()=>[(c(!0),v(Q,null,j(t(e).currentSheetTransactions,(a,p)=>(c(),S(le,{key:p,onLeft:y=>F(y,a),onClick:y=>B(a),"left-color":"red"},{left:s(()=>[l(K,{name:"delete"})]),default:s(()=>[l(te,{clickable:"",class:W(p%2===0?"bg-grey-3":"bg-white")},{default:s(()=>{var y,L;return[l(T,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:s(()=>[l(se,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:s(()=>[m("div",null,o(t(d).getMonth(t(e).currentSheet.transactions[a].timestamp)),1),m("div",null,o(t(d).getDay(t(e).currentSheet.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),l(k,null,{default:s(()=>[l(f,null,{default:s(()=>[i(o(t(e).currentSheet.transactions[a].name||"New Transaction"),1)]),_:2},1024),l(f,{caption:""},{default:s(()=>[i(o(t(e).username(t(e).currentSheetPeople[t(e).currentSheet.transactions[a].payer])||"Nobody")+" paid "+o(t(d).displayCurrency(t(e).currentSheet.transactions[a].currency,t(e).currentSheet.transactions[a].amount)),1)]),_:2},1024)]),_:2},1024),t(e).currentSheet.transactions[a].payer===u.value?(c(),S(k,{key:0,side:"",style:{color:"green"}},{default:s(()=>[l(f,{caption:"",style:{color:"green"}},{default:s(()=>[i(o(t(e).username(t(e).currentSheetPeople[u.value])||"Nobody")+" lent ",1)]),_:1}),l(f,null,{default:s(()=>[i(o(t(d).displayCurrency(t(e).currentSheet.transactions[a].currency,t(e).currentSheet.transactions[a].amount-t(e).currentSheet.transactions[a].debts[t(e).currentSheet.transactions[a].payer].owedAmount)),1)]),_:2},1024)]),_:2},1024)):((L=(y=t(e).currentSheet.transactions[a].debts[u.value])==null?void 0:y.owedAmount)!=null?L:0)>0?(c(),S(k,{key:1,side:"",style:{color:"red"}},{default:s(()=>[l(f,{caption:"",style:{color:"red"}},{default:s(()=>[i(o(t(e).username(t(e).currentSheetPeople[u.value])||"Nobody")+" borrowed ",1)]),_:1}),l(f,null,{default:s(()=>{var O,U;return[i(o(t(d).displayCurrency(t(e).currentSheet.transactions[a].currency,t(e).currentSheet.transactions[a].amount-((U=(O=t(e).currentSheet.transactions[a].debts[u.value])==null?void 0:O.owedAmount)!=null?U:0))),1)]}),_:2},1024)]),_:2},1024)):(c(),S(k,{key:2,side:""},{default:s(()=>[l(f,null,{default:s(()=>r[6]||(r[6]=[i(" not involved ")])),_:1})]),_:1}))]}),_:2},1032,["class"])]),_:2},1032,["onLeft","onClick"]))),128))]),_:1})]),_:1})],64))}});export{_e as default};
