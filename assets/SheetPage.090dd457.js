import{_ as G,r as L,a as b,w as D,u,$ as f,y as n,x as r,a0 as Q,a1 as H,Z as I,Y as d,X as c,a2 as o,a3 as t,v as m,a6 as p,a4 as O,aC as X,ap as U,a5 as Y,aD as _}from"./index.211f49b3.js";import{Q as Z,a as J,b as K,d as W,e as ee,f as $,g as v}from"./QList.3ba757f6.js";import{e as te,c as ae,d as k,Q as z,f as se}from"./QPage.fd4d8e08.js";import{_ as le}from"./PeopleDropdown.582ad48a.js";import{U as y}from"./PersonItem.562fb35a.js";import"./QResizeObserver.0581377b.js";import"./focusout.927575fa.js";import"./scroll.2dd6c84d.js";const re={class:"text-subtitle2"},ne={class:"q-pa-md"},oe={key:0,style:{color:"green"}},ue={key:1,style:{color:"red"}},ce={class:"q-pa-md"},_e=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ie){var T,V,B;const e=G(),h=H(),w=ae(),N=L((B=(V=e.userLedger)==null?void 0:V.sheets[(T=e.currentSheet)==null?void 0:T.id])==null?void 0:B.name),i=L(e.user.id),g=b(()=>e.currentSheetPeople.indexOf(i.value)),S=b(()=>{const{ans:s,totals:l}=X.getSummary(e.currentSheetResults,g.value);return{detail:s.map((C,j)=>({...C,id:j})),totals:l}}),q=b(()=>Object.entries(S.value.totals).filter(([s,l])=>l>0).map(([s,l])=>y.displayCurrency(s,l)).join(" + ")),x=b(()=>Object.entries(S.value.totals).filter(([s,l])=>l<0).map(([s,l])=>y.displayCurrency(s,-l)).join(" + ")),E=s=>{e.transactionId=s,h.push({name:"TransactionPage"})},M=()=>{e.transactionId=null,h.push({name:"TransactionPage"})},R=async()=>{try{await e.setSheetName(N.value)}catch(s){w.notify({message:s.message||s,color:"negative"})}},A=()=>{h.push({name:"PeoplePage"})},P=()=>{try{e.clearCurrentSheet(),h.go(-1)}catch(s){w.notify({message:s.message||s,color:"negative"});return}};D(e.currentSheet,async s=>{s===null&&P()},{immediate:!0});const F=async()=>{try{await e.logout(),h.push({name:"LoginPage"})}catch(s){w.notify({message:s.message||s,color:"negative"});return}};return D(e.userLedger,async s=>{s===null&&await F()},{immediate:!0}),(s,l)=>(u(),f(Q,null,[n(Z,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[n(J,null,{default:r(()=>[n(I,{flat:"",icon:"arrow_back",onClick:P,"aria-label":"Go Back",class:"bg-white text-primary"}),n(K,{style:{"font-size":"28px"}},{default:r(()=>[l[2]||(l[2]=d(" Sheet ")),c("div",re,o(t(e).user.email),1)]),_:1}),n(I,{flat:"",icon:"people",onClick:A,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"}),n(I,{class:"q-ml-md bg-white text-primary",icon:"note_add",label:"Add Entry",onClick:M})]),_:1})]),_:1}),n(te,null,{default:r(()=>[n(k,null,{default:r(()=>[n(z,{class:"row q-gutter-sm"},{default:r(()=>[t(e).currentSheet?(u(),m(le,{key:0,class:"col-auto",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=a=>i.value=a),people:t(e).currentSheet.people,"is-fixed-label":!1},null,8,["modelValue","people"])):p("",!0),n(se,{class:"col",modelValue:N.value,"onUpdate:modelValue":l[1]||(l[1]=a=>N.value=a),onBlur:R,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),x.value||q.value?(u(),m(k,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[c("div",ne,[x.value?(u(),f("div",oe,o(t(e).getName(i.value))+" is owed "+o(x.value),1)):p("",!0),q.value?(u(),f("div",ue,o(t(e).getName(i.value))+" owes "+o(q.value),1)):p("",!0)])]),_:1})):p("",!0),S.value.detail.length>0?(u(),m(k,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[c("div",ce,[(u(!0),f(Q,null,O(S.value.detail,a=>(u(),f("div",{key:a.id},[c("div",null,[c("span",null,o(a.amount>0?t(e).getName(i.value):t(e).getName(t(e).personIdx2Id(a.person))),1),l[3]||(l[3]=c("span",null," owes ",-1)),c("span",null,o(a.amount<0?t(e).getName(i.value):t(e).getName(t(e).personIdx2Id(a.person)))+" \xA0 ",1),c("span",{style:U({color:a.amount>0?"red":"green"})},o(t(y).displayCurrency(a.currency,Math.abs(a.amount))),5)])]))),128))])]),_:1})):p("",!0),n(W,null,{default:r(()=>[(u(!0),f(Q,null,O(t(e).currentSheetTransactions,(a,C)=>(u(),m(ee,{key:a,clickable:"",class:Y(C%2===0?"bg-grey-3":"bg-white"),onClick:j=>E(a)},{default:r(()=>[n(k,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:r(()=>[n(z,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:r(()=>[c("div",null,o(t(y).getMonth(t(e).currentSheet.transactions[a].timestamp)),1),c("div",null,o(t(y).getDay(t(e).currentSheet.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),n($,null,{default:r(()=>[n(v,null,{default:r(()=>[d(o(t(e).currentSheet.transactions[a].name||"New Transaction"),1)]),_:2},1024),n(v,{caption:""},{default:r(()=>[d(o(t(e).getName(t(e).payerId(a)))+" payed "+o(t(y).displayCurrency(t(e).currentSheet.transactions[a].currency,t(e).currentSheet.transactions[a].amount)),1)]),_:2},1024)]),_:2},1024),n($,{side:""},{default:r(()=>[t(_).position(t(e).currentSheet.transactions[a],g.value)>0?(u(),m(v,{key:0,caption:"",style:{color:"green"}},{default:r(()=>[d(o(t(e).getName(i.value))+" lent ",1)]),_:1})):p("",!0),t(_).position(t(e).currentSheet.transactions[a],g.value)<0?(u(),m(v,{key:1,caption:"",style:{color:"red"}},{default:r(()=>[d(o(t(e).getName(i.value))+" borrowed ",1)]),_:1})):p("",!0),t(_).position(t(e).currentSheet.transactions[a],g.value)===0?(u(),m(v,{key:2},{default:r(()=>l[4]||(l[4]=[d(" Not Involved ")])),_:1})):(u(),m(v,{key:3,style:U({color:t(_).position(t(e).currentSheet.transactions[a],g.value)>=0?"green":"red"})},{default:r(()=>[d(o(t(y).displayCurrency(t(e).currentSheet.transactions[a].currency,Math.abs(t(_).position(t(e).currentSheet.transactions[a],g.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})],64))}});export{_e as default};
