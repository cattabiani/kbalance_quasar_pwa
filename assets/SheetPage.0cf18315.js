import{O as R,r as P,a as y,w as k,u as m,P as Q,y as t,x as s,S as T,T as O,N as d,U as p,v as g,V as h,X as U,aC as A,aD as F,C as G,M as H,W as M}from"./index.8cf7674b.js";import{Q as W}from"./QSpace.767cf70b.js";import{Q as X,a as z}from"./QHeader.5e08a578.js";import{a as q,Q as v,b as J}from"./QCard.6e9d02f7.js";import{a as K,Q as Y,c as Z,b as ee}from"./PersonItem.5c432017.js";import{Q as ae,b as te}from"./QPage.cbf4265b.js";import{C as se}from"./ClosePopup.c3df1be6.js";import{_ as re}from"./PeopleDropdown.058969e4.js";import{_ as oe,a as ne}from"./TransactionList.a0939a9c.js";import{c as le}from"./index.56516dd5.js";import"./QResizeObserver.1b71c1f5.js";import"./selection.0a3d7e56.js";import"./focusout.0d50b4cd.js";import"./scroll.f2b0f5e2.js";import"./QSlideItem.d15db21c.js";import"./use-render-cache.770e5fe8.js";const Qe=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var C,S,w;const a=R(),c=O(),l=te(),f=P((w=(S=a.userLedger)==null?void 0:S.sheets[(C=a.currentSheet)==null?void 0:C.id])==null?void 0:w.name),u=P(a.user.id),b=y(()=>a.personId2Idx(u.value)),i=y(()=>A.getSummary(a.currentSheetResults,b.value)),x=le.data.map(e=>({label:`${e.code} - ${e.currency}`,value:e.code})),V=y(()=>x.filter(e=>Object.keys(i.value.totals).includes(e.value))),B=async e=>{let o=`\u{1F916} settle ${a.getName(u.value)}`;const n=a.makeEquivalentTransactionBatch(e,b.value,o);try{await a.addTransactions(n)}catch(r){l.notify({message:r.message||r,color:"negative"});return}},$=async(e,o)=>{try{const n=`Are you sure you want to remove ${F.name(a.currentSheet.transactions[o])}?`;l.notify({message:n,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(o),l.notify({message:"Transaction removed successfully!"})}}]})}catch(n){l.notify({message:n.message||n,color:"negative"})}},I=e=>{a.transactionId=e,c.push({name:"TransactionPage"})},N=()=>{a.transactionId=null,c.push({name:"TransactionPage"})},E=async()=>{try{await a.setSheetName(f.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},L=()=>{c.push({name:"PeoplePage"})},j=()=>{c.push({name:"ConvertPage"})},_=()=>{try{a.clearCurrentSheet(),c.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};k(a.currentSheet,async e=>{e===null&&_()},{immediate:!0});const D=async()=>{try{await a.logout(),c.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return k(a.userLedger,async e=>{e===null&&await D()},{immediate:!0}),(e,o)=>(m(),Q(T,null,[t(X,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[t(z,null,{default:s(()=>[t(d,{flat:"",icon:"arrow_back",onClick:_,"aria-label":"Go Back",class:"bg-white text-primary"}),t(W),t(d,{flat:"",icon:"people",onClick:L,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(ae,null,{default:s(()=>{var n;return[t(q,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(v,{class:"row q-gutter-sm"},{default:s(()=>[p(a).currentSheet?(m(),g(re,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=r=>u.value=r),people:p(a).currentSheet.people,"sorted-people":p(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):h("",!0),t(J,{class:"col",modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=r=>f.value=r),onBlur:E,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(oe,{summaries:i.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),t(q,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(v,{class:"row justify-center items-center q-pb-none"},{default:s(()=>[i.value.ans.length?(m(),g(Y,{key:0,label:"Settle",icon:"payments",flat:"",class:"q-mr-md bg-green text-white"},{default:s(()=>[t(K,null,{default:s(()=>[(m(!0),Q(T,null,U(V.value,r=>G((m(),g(Z,{key:r.value,clickable:"",onClick:ue=>B(r.value)},{default:s(()=>[t(ee,null,{default:s(()=>[H(M(r.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])),128))]),_:1})]),_:1})):h("",!0),i.value.ans.length?(m(),g(d,{key:1,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:j})):h("",!0)]),_:1}),t(v,{class:"row justify-center items-center q-bt-sm"},{default:s(()=>[t(d,{flat:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:N})]),_:1})]),_:1}),t(ne,{transactions:((n=p(a).currentSheet)==null?void 0:n.transactions)||{},selectedPerson:u.value,onRemove:$,onEdit:I},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{Qe as default};
