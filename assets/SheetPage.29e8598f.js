import{O as D,r as _,a as h,w as b,u as m,P as O,y as e,x as o,S as A,T as M,N as B,C,v as p,Q as S,M as P,U as i,V as I,Y as z,L as F,aD as G,aE as H}from"./index.75363be8.js";import{Q as Y}from"./QSpace.c7828046.js";import{a as l,b as f}from"./QMenu.fdbab486.js";import{Q as J}from"./PersonItem.7631c322.js";import{Q as K,_ as W}from"./PeopleDropdown.f1ab4eb7.js";import{Q as X,a as Z}from"./QHeader.d5c1f665.js";import{a as ee,Q as ae,b as te}from"./QCard.f1721a37.js";import{Q as se,b as oe}from"./QPage.f1663f84.js";import{_ as re,C as Q}from"./CurrencyDropdown.852bf054.js";import{_ as le,a as ne}from"./TransactionList.ce081c05.js";import"./selection.8d7b388c.js";import"./focusout.4fe735f3.js";import"./scroll.09374dc3.js";import"./QResizeObserver.d62032c6.js";import"./QSlideItem.b79d4382.js";import"./use-render-cache.770e5fe8.js";const ue={class:"row justify-center items-center q-pb-md"},ke=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var x,V,T;const a=D(),n=M(),u=oe(),g=_((T=(V=a.userLedger)==null?void 0:V.sheets[(x=a.currentSheet)==null?void 0:x.id])==null?void 0:T.name),c=_(a.user.id),w=h(()=>a.personId2Idx(c.value)),v=_(null),d=h(()=>G.getSummary(a.currentSheetResults,w.value)),N=h(()=>new Set(Object.keys(d.value.totals)));b(v,async t=>{if(t==null)return;const s=`\u{1F916} settle ${a.getName(c.value)}`;a.settleCurrencyPerson(t,w.value,s)});const $=async(t,s)=>{try{const r=`Are you sure you want to remove ${H.name(a.currentSheet.transactions[s])}?`;u.notify({message:r,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>t()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(s),u.notify({message:"Transaction removed successfully!"})}}]})}catch(r){t(),u.notify({message:r.message||r,color:"negative"})}},q=t=>{a.transactionId=t,n.push({name:"TransactionPage"})},E=()=>{a.transactionId=null,n.push({name:"TransactionPage"})},L=async()=>{try{await a.setSheetName(g.value)}catch(t){u.notify({message:t.message||t,color:"negative"})}},R=()=>{n.push({name:"PeoplePage"})},U=()=>{n.push({name:"ConvertPage"})},k=()=>{try{a.clearCurrentSheet(),n.go(-1)}catch(t){u.notify({message:t.message||t,color:"negative"});return}};b(a.currentSheet,async t=>{t===null&&k()},{immediate:!0});const j=async()=>{try{await a.logout(),n.push({name:"LoginPage"})}catch(t){u.notify({message:t.message||t,color:"negative"});return}};return b(a.userLedger,async t=>{t===null&&await j()},{immediate:!0}),(t,s)=>(m(),O(A,null,[e(X,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[e(Z,null,{default:o(()=>[e(B,{flat:"",icon:"arrow_back",onClick:k,"aria-label":"Go Back",class:"bg-white text-primary"}),e(Y),e(K,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:o(()=>[e(J,null,{default:o(()=>[C((m(),p(f,{clickable:"",onClick:R,class:"bg-grey-3"},{default:o(()=>[e(l,{avatar:""},{default:o(()=>[e(S,{name:"people"})]),_:1}),e(l,null,{default:o(()=>s[4]||(s[4]=[P("People")])),_:1})]),_:1})),[[Q]]),C((m(),p(f,{clickable:"",onClick:s[0]||(s[0]=r=>i(a).exportSheetToCSV())},{default:o(()=>[e(l,{avatar:""},{default:o(()=>[e(S,{name:"file_download"})]),_:1}),e(l,null,{default:o(()=>s[5]||(s[5]=[P("Export (.csv)")])),_:1})]),_:1})),[[Q]]),d.value.ans.length?C((m(),p(f,{key:0,clickable:"",onClick:U,class:"bg-grey-3"},{default:o(()=>[e(l,{avatar:""},{default:o(()=>[e(S,{name:"currency_exchange"})]),_:1}),e(l,null,{default:o(()=>s[6]||(s[6]=[P("Convert")])),_:1})]),_:1})),[[Q]]):I("",!0),e(f,{class:z(d.value.ans.length?"":"bg-grey-3")},{default:o(()=>[e(l,null,{default:o(()=>[e(re,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=r=>v.value=r),usedCurrencies:N.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:o(()=>{var r;return[e(ee,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[e(ae,{class:"row q-gutter-sm"},{default:o(()=>[i(a).currentSheet?(m(),p(W,{key:0,class:"col-auto",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=y=>c.value=y),people:i(a).currentSheet.people,"sorted-people":i(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):I("",!0),e(te,{class:"col",modelValue:g.value,"onUpdate:modelValue":s[3]||(s[3]=y=>g.value=y),onBlur:L,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),e(le,{summaries:d.value,selectedPerson:c.value},null,8,["summaries","selectedPerson"]),F("div",ue,[e(B,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:E})]),e(ne,{transactions:((r=i(a).currentSheet)==null?void 0:r.transactions)||{},selectedPerson:c.value,onRemove:$,onEdit:q},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{ke as default};
