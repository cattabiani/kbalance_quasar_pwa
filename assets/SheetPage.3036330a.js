import{O as Y,r as m,a as C,w as S,u as d,P as J,y as e,x as o,S as K,T as W,N as k,C as g,v as h,Q as P,M as Q,V as q,Y as X,am as Z,L as x,U as y,aC as ee,aD as ae,z as te}from"./index.27780982.js";import{Q as se}from"./QSpace.183cf6c5.js";import{a as r,b}from"./QMenu.18e9bacd.js";import{Q as oe}from"./PersonItem.5fa46a3a.js";import{Q as le,_ as ne}from"./PeopleDropdown.68d3e940.js";import{Q as re,a as R}from"./QHeader.e27c8871.js";import{b as $,a as ce,Q as ue}from"./QCard.94378d21.js";import{Q as ie,b as me}from"./QPage.422e7393.js";import{_ as de,C as V}from"./CurrencyDropdown.0261242d.js";import{_ as pe,a as fe}from"./TransactionList.eeedd1a0.js";import"./selection.36bd2252.js";import"./focusout.d5f692fd.js";import"./scroll.1bb15faa.js";import"./QResizeObserver.36a9da29.js";import"./utils.287e7c2a.js";import"./QSlideItem.25680c6f.js";import"./use-render-cache.770e5fe8.js";const ve={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},ge={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},he={class:"row justify-center items-center q-pb-md"},Re=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ye){var L,N,U;const t=Y(),c=W(),u=me(),w=m((U=(N=t.userLedger)==null?void 0:N.sheets[(L=t.currentSheet)==null?void 0:L.id])==null?void 0:U.name),i=m(t.user.id),T=C(()=>t.personId2Idx(i.value)),_=m(null),p=m(null),f=m(!1),I=m(null),v=C(()=>ee.getSummary(t.currentSheetResults,T.value)),j=C(()=>new Set(Object.keys(v.value.totals)));S(_,async a=>{if(a==null)return;const s=`\u{1F916} settle ${t.getName(i.value)}`;t.settleCurrencyPerson(a,T.value,s)});const O=async(a,s)=>{try{const l=`Are you sure you want to remove ${ae.name(t.currentSheet.transactions[s])}?`;u.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(s),u.notify({message:"Transaction removed successfully!"})}}]})}catch(l){a(),u.notify({message:l.message||l,color:"negative"})}},A=a=>{t.transactionId=a,c.push({name:"TransactionPage"})},D=()=>{t.transactionId=null,c.push({name:"TransactionPage"})},E=async()=>{try{await t.setSheetName(w.value)}catch(a){u.notify({message:a.message||a,color:"negative"})}},z=()=>{c.push({name:"PeoplePage"})},M=()=>{c.push({name:"ConvertPage"})},B=()=>{try{t.clearCurrentSheet(),c.go(-1)}catch(a){u.notify({message:a.message||a,color:"negative"});return}};S(t.currentSheet,async a=>{a===null&&B()},{immediate:!0});const F=async()=>{try{await t.logout(),c.push({name:"LoginPage"})}catch(a){u.notify({message:a.message||a,color:"negative"});return}};S(t.userLedger,async a=>{a===null&&await F()},{immediate:!0});const G=()=>{f.value=!f.value,f.value?te(()=>{var a;(a=I.value)==null||a.focus()}):p.value=""},H=()=>{const a=t.currentSheetToCsv(),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.setAttribute("download","sheet.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)};return(a,s)=>(d(),J(K,null,[e(re,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[e(R,null,{default:o(()=>[e(k,{flat:"",icon:"arrow_back",onClick:B,"aria-label":"Go Back",class:"bg-white text-primary"}),e(se),e(k,{flat:"",icon:"search",label:"Search",onClick:G,class:"bg-white text-primary q-mr-sm"}),e(le,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:o(()=>[e(oe,null,{default:o(()=>[g((d(),h(b,{clickable:"",onClick:z,class:"bg-grey-3"},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(P,{name:"people"})]),_:1}),e(r,null,{default:o(()=>s[4]||(s[4]=[Q("People")])),_:1})]),_:1})),[[V]]),v.value.ans.length?g((d(),h(b,{key:0,clickable:"",onClick:M},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(P,{name:"currency_exchange"})]),_:1}),e(r,null,{default:o(()=>s[5]||(s[5]=[Q("Convert")])),_:1})]),_:1})),[[V]]):q("",!0),e(b,{class:X(v.value.ans.length?"bg-grey-3":"")},{default:o(()=>[e(r,null,{default:o(()=>[e(de,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=l=>_.value=l),usedCurrencies:j.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"]),g((d(),h(b,{clickable:"",onClick:H},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(P,{name:"download"})]),_:1}),e(r,null,{default:o(()=>s[6]||(s[6]=[Q("Download (csv)")])),_:1})]),_:1})),[[V]])]),_:1})]),_:1})]),_:1}),g(e(R,{class:"bg-primary q-pa-sm"},{default:o(()=>[e($,{ref_key:"searchInput",ref:I,dense:"",outlined:"",debounce:"300",modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=l=>p.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[Z,f.value]])]),_:1}),e(ie,null,{default:o(()=>{var l;return[e(ce,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[e(ue,{class:"row no-wrap items-center"},{default:o(()=>[x("div",ve,[y(t).currentSheet?(d(),h(ne,{key:0,modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=n=>i.value=n),people:y(t).currentSheet.people,"sorted-people":y(t).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):q("",!0)]),x("div",ge,[e($,{modelValue:w.value,"onUpdate:modelValue":s[3]||(s[3]=n=>w.value=n),onBlur:E,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(pe,{summaries:v.value,selectedPerson:i.value},null,8,["summaries","selectedPerson"]),x("div",he,[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:D})]),e(fe,{transactions:((l=y(t).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:i.value,"search-string":p.value,onRemove:O,onEdit:A},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{Re as default};
