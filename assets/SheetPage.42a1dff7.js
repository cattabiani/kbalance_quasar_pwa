import{O as E,r as v,a as y,w as h,u as i,P as O,y as e,x as o,S as A,T as M,N as k,C as V,v as _,Q as x,M as T,V as B,Y as z,U as d,L as F,aC as G,aD as H}from"./index.d9c141ef.js";import{Q as Y}from"./QSpace.6f6607ed.js";import{a as c,b}from"./QMenu.d1ca8e67.js";import{Q as J}from"./PersonItem.4aae740b.js";import{Q as K,_ as W}from"./PeopleDropdown.8e4bb8b2.js";import{Q as X,a as Z}from"./QHeader.0844dfbe.js";import{a as ee,Q as ae,b as te}from"./QCard.25dabb2c.js";import{Q as se,b as oe}from"./QPage.e6ca0482.js";import{_ as re,C as I}from"./CurrencyDropdown.252787f9.js";import{_ as ne,a as le}from"./TransactionList.e9fd6f10.js";import"./selection.114a712b.js";import"./focusout.94021543.js";import"./scroll.b20872b4.js";import"./QResizeObserver.afe75237.js";import"./utils.ca14db4f.js";import"./QSlideItem.53a63d69.js";import"./use-render-cache.770e5fe8.js";const ue={class:"row justify-center items-center q-pb-md"},Ve=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var P,Q,w;const t=E(),n=M(),l=oe(),p=v((w=(Q=t.userLedger)==null?void 0:Q.sheets[(P=t.currentSheet)==null?void 0:P.id])==null?void 0:w.name),u=v(t.user.id),C=y(()=>t.personId2Idx(u.value)),f=v(null),m=y(()=>G.getSummary(t.currentSheetResults,C.value)),N=y(()=>new Set(Object.keys(m.value.totals)));h(f,async a=>{if(a==null)return;const s=`\u{1F916} settle ${t.getName(u.value)}`;t.settleCurrencyPerson(a,C.value,s)});const q=async(a,s)=>{try{const r=`Are you sure you want to remove ${H.name(t.currentSheet.transactions[s])}?`;l.notify({message:r,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(s),l.notify({message:"Transaction removed successfully!"})}}]})}catch(r){a(),l.notify({message:r.message||r,color:"negative"})}},$=a=>{t.transactionId=a,n.push({name:"TransactionPage"})},L=()=>{t.transactionId=null,n.push({name:"TransactionPage"})},R=async()=>{try{await t.setSheetName(p.value)}catch(a){l.notify({message:a.message||a,color:"negative"})}},U=()=>{n.push({name:"PeoplePage"})},j=()=>{n.push({name:"ConvertPage"})},S=()=>{try{t.clearCurrentSheet(),n.go(-1)}catch(a){l.notify({message:a.message||a,color:"negative"});return}};h(t.currentSheet,async a=>{a===null&&S()},{immediate:!0});const D=async()=>{try{await t.logout(),n.push({name:"LoginPage"})}catch(a){l.notify({message:a.message||a,color:"negative"});return}};return h(t.userLedger,async a=>{a===null&&await D()},{immediate:!0}),(a,s)=>(i(),O(A,null,[e(X,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[e(Z,null,{default:o(()=>[e(k,{flat:"",icon:"arrow_back",onClick:S,"aria-label":"Go Back",class:"bg-white text-primary"}),e(Y),e(K,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:o(()=>[e(J,null,{default:o(()=>[V((i(),_(b,{clickable:"",onClick:U,class:"bg-grey-3"},{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(x,{name:"people"})]),_:1}),e(c,null,{default:o(()=>s[3]||(s[3]=[T("People")])),_:1})]),_:1})),[[I]]),m.value.ans.length?V((i(),_(b,{key:0,clickable:"",onClick:j},{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(x,{name:"currency_exchange"})]),_:1}),e(c,null,{default:o(()=>s[4]||(s[4]=[T("Convert")])),_:1})]),_:1})),[[I]]):B("",!0),e(b,{class:z(m.value.ans.length?"bg-grey-3":"")},{default:o(()=>[e(c,null,{default:o(()=>[e(re,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=r=>f.value=r),usedCurrencies:N.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:o(()=>{var r;return[e(ee,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[e(ae,{class:"row q-gutter-sm"},{default:o(()=>[d(t).currentSheet?(i(),_(W,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=g=>u.value=g),people:d(t).currentSheet.people,"sorted-people":d(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):B("",!0),e(te,{class:"col",modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=g=>p.value=g),onBlur:R,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{summaries:m.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),F("div",ue,[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:L})]),e(le,{transactions:((r=d(t).currentSheet)==null?void 0:r.transactions)||{},selectedPerson:u.value,onRemove:q,onEdit:$},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{Ve as default};
