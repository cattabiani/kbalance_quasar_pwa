import{_ as H,r as j,a as b,w as D,u,$ as g,y as l,x as r,a0 as I,a1 as X,Z as P,a2 as a,v as m,a3 as p,X as i,a4 as o,a5 as O,aC as Y,ar as U,a6 as Z,Q as J,Y as f,aD as _}from"./index.e0d09fe2.js";import{Q as K}from"./QSpace.8fb3235b.js";import{Q as W,a as ee,d as ae,U as y,f as te,e as $,g as v}from"./PersonItem.9b9da3de.js";import{e as se,c as re,d as Q,Q as E,f as ne}from"./QPage.d1290936.js";import{Q as le}from"./QSlideItem.16652f6a.js";import{_ as oe}from"./PeopleDropdown.45a4393e.js";import"./focusout.2c9db795.js";import"./scroll.957d0dfc.js";import"./QResizeObserver.b27ea726.js";const ue={class:"q-pa-md"},ce={key:0,style:{color:"green"}},ie={key:1,style:{color:"red"}},me={class:"q-pa-md"},be=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(de){var T,V,B;const e=H(),h=X(),S=re(),w=j((B=(V=e.userLedger)==null?void 0:V.sheets[(T=e.currentSheet)==null?void 0:T.id])==null?void 0:B.name),c=j(e.user.id),d=b(()=>e.currentSheetPeople.indexOf(c.value)),k=b(()=>{const{ans:s,totals:n}=Y.getSummary(e.currentSheetResults,d.value);return{detail:s.map((C,L)=>({...C,id:L})),totals:n}}),N=b(()=>Object.entries(k.value.totals).filter(([s,n])=>n>0).map(([s,n])=>y.displayCurrency(s,n)).join(" + ")),q=b(()=>Object.entries(k.value.totals).filter(([s,n])=>n<0).map(([s,n])=>y.displayCurrency(s,-n)).join(" + ")),M=async s=>{try{e.removeTransaction(s)}catch(n){S.notify({message:n.message||n,color:"negative"});return}},R=s=>{e.transactionId=s,h.push({name:"TransactionPage"})},z=()=>{e.transactionId=null,h.push({name:"TransactionPage"})},A=async()=>{try{await e.setSheetName(w.value)}catch(s){S.notify({message:s.message||s,color:"negative"})}},F=()=>{h.push({name:"PeoplePage"})},x=()=>{try{e.clearCurrentSheet(),h.go(-1)}catch(s){S.notify({message:s.message||s,color:"negative"});return}};D(e.currentSheet,async s=>{s===null&&x()},{immediate:!0});const G=async()=>{try{await e.logout(),h.push({name:"LoginPage"})}catch(s){S.notify({message:s.message||s,color:"negative"});return}};return D(e.userLedger,async s=>{s===null&&await G()},{immediate:!0}),(s,n)=>(u(),g(I,null,[l(W,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[l(ee,null,{default:r(()=>[l(P,{flat:"",icon:"arrow_back",onClick:x,"aria-label":"Go Back",class:"bg-white text-primary"}),l(K),l(P,{flat:"",icon:"people",onClick:F,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"}),l(P,{flat:"",class:"q-ml-md bg-white text-primary",icon:"note_add",label:"Add Entry",onClick:z})]),_:1})]),_:1}),l(se,null,{default:r(()=>[l(Q,null,{default:r(()=>[l(E,{class:"row q-gutter-sm"},{default:r(()=>[a(e).currentSheet?(u(),m(oe,{key:0,class:"col-auto",modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=t=>c.value=t),people:a(e).currentSheet.people,"sorted-people":a(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):p("",!0),l(ne,{class:"col",modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=t=>w.value=t),onBlur:A,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),q.value||N.value?(u(),m(Q,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[i("div",ue,[q.value?(u(),g("div",ce,o(a(e).getName(c.value))+" is owed "+o(q.value),1)):p("",!0),N.value?(u(),g("div",ie,o(a(e).getName(c.value))+" owes "+o(N.value),1)):p("",!0)])]),_:1})):p("",!0),k.value.detail.length>0?(u(),m(Q,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[i("div",me,[(u(!0),g(I,null,O(k.value.detail,t=>(u(),g("div",{key:t.id},[i("div",null,[i("span",null,o(t.amount>0?a(e).getName(c.value):a(e).getName(a(e).personIdx2Id(t.person))),1),n[2]||(n[2]=i("span",null," owes ",-1)),i("span",null,o(t.amount<0?a(e).getName(c.value):a(e).getName(a(e).personIdx2Id(t.person)))+" \xA0 ",1),i("span",{style:U({color:t.amount>0?"red":"green"})},o(a(y).displayCurrency(t.currency,Math.abs(t.amount))),5)])]))),128))])]),_:1})):p("",!0),l(ae,null,{default:r(()=>[(u(!0),g(I,null,O(a(e).currentSheetTransactions,(t,C)=>(u(),m(le,{key:t,clickable:"",class:Z(C%2===0?"bg-grey-3":"bg-white"),onClick:L=>R(t),onLeft:()=>M(t),"left-color":"red"},{left:r(()=>[l(J,{name:"delete"})]),default:r(()=>[l(te,null,{default:r(()=>[l(Q,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:r(()=>[l(E,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:r(()=>[i("div",null,o(a(y).getMonth(a(e).currentSheet.transactions[t].timestamp)),1),i("div",null,o(a(y).getDay(a(e).currentSheet.transactions[t].timestamp)),1)]),_:2},1024)]),_:2},1024),l($,null,{default:r(()=>[l(v,null,{default:r(()=>[f(o(a(e).currentSheet.transactions[t].name||"New Transaction"),1)]),_:2},1024),l(v,{caption:""},{default:r(()=>[f(o(a(e).getName(a(e).payerId(t)))+" payed "+o(a(y).displayCurrency(a(e).currentSheet.transactions[t].currency,a(e).currentSheet.transactions[t].amount)),1)]),_:2},1024)]),_:2},1024),l($,{side:""},{default:r(()=>[a(_).position(a(e).currentSheet.transactions[t],d.value)>0?(u(),m(v,{key:0,caption:"",style:{color:"green"}},{default:r(()=>[f(o(a(e).getName(c.value))+" lent ",1)]),_:1})):p("",!0),a(_).position(a(e).currentSheet.transactions[t],d.value)<0?(u(),m(v,{key:1,caption:"",style:{color:"red"}},{default:r(()=>[f(o(a(e).getName(c.value))+" borrowed ",1)]),_:1})):p("",!0),a(_).position(a(e).currentSheet.transactions[t],d.value)===0?(u(),m(v,{key:2},{default:r(()=>[f(o(d.value!==a(e).currentSheet.transactions[t].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(u(),m(v,{key:3,style:U({color:a(_).position(a(e).currentSheet.transactions[t],d.value)>=0?"green":"red"})},{default:r(()=>[f(o(a(y).displayCurrency(a(e).currentSheet.transactions[t].currency,Math.abs(a(_).position(a(e).currentSheet.transactions[t],d.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick","onLeft"]))),128))]),_:1})]),_:1})],64))}});export{be as default};
