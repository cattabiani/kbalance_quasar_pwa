import{_ as R,r as k,a as y,w as P,u as i,$ as Q,y as t,x as s,a0 as q,a1 as A,Z as d,a2 as p,v as g,a3 as h,a5 as O,aC as U,aD as F,C as G,Y as H,a4 as Y}from"./index.fee16bfb.js";import{Q as Z}from"./QSpace.94128608.js";import{Q as z,a as J,d as K,b as M,f as W,e as X}from"./PersonItem.11b2d4c9.js";import{e as ee,c as ae,d as x,Q as v,f as te}from"./QPage.03865722.js";import{C as se}from"./ClosePopup.3d30b710.js";import{_ as re}from"./PeopleDropdown.fbd6ac9c.js";import{_ as oe,a as ne}from"./TransactionList.f614c060.js";import{c as le}from"./index.56516dd5.js";import"./focusout.5bd98c76.js";import"./scroll.a075a584.js";import"./QResizeObserver.ceab32d4.js";import"./QSlideItem.25896e39.js";const we=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var C,w,S;const a=R(),c=A(),l=ae(),f=k((S=(w=a.userLedger)==null?void 0:w.sheets[(C=a.currentSheet)==null?void 0:C.id])==null?void 0:S.name),u=k(a.user.id),_=y(()=>a.personId2Idx(u.value)),m=y(()=>U.getSummary(a.currentSheetResults,_.value)),T=le.data.map(e=>({label:`${e.code} - ${e.currency}`,value:e.code})),$=y(()=>T.filter(e=>Object.keys(m.value.totals).includes(e.value))),B=async e=>{let o=`\u{1F916} settle ${a.getName(u.value)}`;const n=a.makeEquivalentTransactionBatch(e,_.value,o);try{await a.addTransactions(n)}catch(r){l.notify({message:r.message||r,color:"negative"});return}},V=async(e,o)=>{try{const n=`Are you sure you want to remove ${F.name(a.currentSheet.transactions[o])}?`;l.notify({message:n,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(o),l.notify({message:"Transaction removed successfully!"})}}]})}catch(n){l.notify({message:n.message||n,color:"negative"})}},I=e=>{a.transactionId=e,c.push({name:"TransactionPage"})},N=()=>{a.transactionId=null,c.push({name:"TransactionPage"})},E=async()=>{try{await a.setSheetName(f.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},L=()=>{c.push({name:"PeoplePage"})},j=()=>{c.push({name:"ConvertPage"})},b=()=>{try{a.clearCurrentSheet(),c.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};P(a.currentSheet,async e=>{e===null&&b()},{immediate:!0});const D=async()=>{try{await a.logout(),c.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return P(a.userLedger,async e=>{e===null&&await D()},{immediate:!0}),(e,o)=>(i(),Q(q,null,[t(z,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[t(J,null,{default:s(()=>[t(d,{flat:"",icon:"arrow_back",onClick:b,"aria-label":"Go Back",class:"bg-white text-primary"}),t(Z),t(d,{flat:"",icon:"people",onClick:L,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(ee,null,{default:s(()=>{var n;return[t(x,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(v,{class:"row q-gutter-sm"},{default:s(()=>[p(a).currentSheet?(i(),g(re,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=r=>u.value=r),people:p(a).currentSheet.people,"sorted-people":p(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):h("",!0),t(te,{class:"col",modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=r=>f.value=r),onBlur:E,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(oe,{summaries:m.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),t(x,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(v,{class:"row justify-center items-center q-pb-none"},{default:s(()=>[m.value.ans.length?(i(),g(M,{key:0,label:"Settle",icon:"payments",flat:"",class:"q-mr-md bg-green text-white"},{default:s(()=>[t(K,null,{default:s(()=>[(i(!0),Q(q,null,O($.value,r=>G((i(),g(W,{key:r.value,clickable:"",onClick:ue=>B(r.value)},{default:s(()=>[t(X,null,{default:s(()=>[H(Y(r.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])),128))]),_:1})]),_:1})):h("",!0),m.value.ans.length?(i(),g(d,{key:1,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:j})):h("",!0)]),_:1}),t(v,{class:"row justify-center items-center q-bt-sm"},{default:s(()=>[t(d,{flat:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:N})]),_:1})]),_:1}),t(ne,{transactions:((n=p(a).currentSheet)==null?void 0:n.transactions)||{},selectedPerson:u.value,onRemove:V,onEdit:I},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{we as default};
