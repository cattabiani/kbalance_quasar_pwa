import{_ as H,r as L,a as b,w as D,u,$ as f,y as n,x as l,a0 as x,a1 as X,Z as I,Y as d,a3 as a,v as m,a6 as p,X as i,a2 as o,a4 as O,aC as Y,ap as U,a5 as Z,aD as _}from"./index.0948903c.js";import{Q as J}from"./QSpace.026e1197.js";import{Q as K,a as $,b as W,d as ee,e as ae,f as z,g as v}from"./QList.9d098648.js";import{e as te,c as se,d as k,Q as E,f as le}from"./QPage.81d7c495.js";import{_ as re}from"./PeopleDropdown.f5e8e994.js";import{U as y}from"./PersonItem.a573abf8.js";import"./QResizeObserver.79596f14.js";import"./focusout.ce478b0b.js";import"./scroll.9f5594e6.js";const ne={class:"q-pa-md"},oe={key:0,style:{color:"green"}},ue={key:1,style:{color:"red"}},ce={class:"q-pa-md"},Se=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ie){var T,V,B;const e=H(),h=X(),w=se(),N=L((B=(V=e.userLedger)==null?void 0:V.sheets[(T=e.currentSheet)==null?void 0:T.id])==null?void 0:B.name),c=L(e.user.id),g=b(()=>e.currentSheetPeople.indexOf(c.value)),S=b(()=>{const{ans:s,totals:r}=Y.getSummary(e.currentSheetResults,g.value);return{detail:s.map((Q,j)=>({...Q,id:j})),totals:r}}),q=b(()=>Object.entries(S.value.totals).filter(([s,r])=>r>0).map(([s,r])=>y.displayCurrency(s,r)).join(" + ")),C=b(()=>Object.entries(S.value.totals).filter(([s,r])=>r<0).map(([s,r])=>y.displayCurrency(s,-r)).join(" + ")),M=s=>{e.transactionId=s,h.push({name:"TransactionPage"})},R=()=>{e.transactionId=null,h.push({name:"TransactionPage"})},A=async()=>{try{await e.setSheetName(N.value)}catch(s){w.notify({message:s.message||s,color:"negative"})}},F=()=>{h.push({name:"PeoplePage"})},P=()=>{try{e.clearCurrentSheet(),h.go(-1)}catch(s){w.notify({message:s.message||s,color:"negative"});return}};D(e.currentSheet,async s=>{s===null&&P()},{immediate:!0});const G=async()=>{try{await e.logout(),h.push({name:"LoginPage"})}catch(s){w.notify({message:s.message||s,color:"negative"});return}};return D(e.userLedger,async s=>{s===null&&await G()},{immediate:!0}),(s,r)=>(u(),f(x,null,[n(K,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[n($,null,{default:l(()=>[n(I,{flat:"",icon:"arrow_back",onClick:P,"aria-label":"Go Back",class:"bg-white text-primary"}),n(J),n(I,{flat:"",dense:"",icon:"people",onClick:F,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"}),n(I,{class:"q-ml-md bg-white text-primary",dense:"",icon:"note_add",label:"Add Entry",onClick:R})]),_:1}),n($,null,{default:l(()=>[n(W,{style:{"font-size":"28px"}},{default:l(()=>r[2]||(r[2]=[d(" Sheet ")])),_:1})]),_:1})]),_:1}),n(te,null,{default:l(()=>[n(k,null,{default:l(()=>[n(E,{class:"row q-gutter-sm"},{default:l(()=>[a(e).currentSheet?(u(),m(re,{key:0,class:"col-auto",modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=t=>c.value=t),people:a(e).currentSheet.people,"is-fixed-label":!1},null,8,["modelValue","people"])):p("",!0),n(le,{class:"col",modelValue:N.value,"onUpdate:modelValue":r[1]||(r[1]=t=>N.value=t),onBlur:A,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),C.value||q.value?(u(),m(k,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:l(()=>[i("div",ne,[C.value?(u(),f("div",oe,o(a(e).getName(c.value))+" is owed "+o(C.value),1)):p("",!0),q.value?(u(),f("div",ue,o(a(e).getName(c.value))+" owes "+o(q.value),1)):p("",!0)])]),_:1})):p("",!0),S.value.detail.length>0?(u(),m(k,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:l(()=>[i("div",ce,[(u(!0),f(x,null,O(S.value.detail,t=>(u(),f("div",{key:t.id},[i("div",null,[i("span",null,o(t.amount>0?a(e).getName(c.value):a(e).getName(a(e).personIdx2Id(t.person))),1),r[3]||(r[3]=i("span",null," owes ",-1)),i("span",null,o(t.amount<0?a(e).getName(c.value):a(e).getName(a(e).personIdx2Id(t.person)))+" \xA0 ",1),i("span",{style:U({color:t.amount>0?"red":"green"})},o(a(y).displayCurrency(t.currency,Math.abs(t.amount))),5)])]))),128))])]),_:1})):p("",!0),n(ee,null,{default:l(()=>[(u(!0),f(x,null,O(a(e).currentSheetTransactions,(t,Q)=>(u(),m(ae,{key:t,clickable:"",class:Z(Q%2===0?"bg-grey-3":"bg-white"),onClick:j=>M(t)},{default:l(()=>[n(k,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:l(()=>[n(E,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>[i("div",null,o(a(y).getMonth(a(e).currentSheet.transactions[t].timestamp)),1),i("div",null,o(a(y).getDay(a(e).currentSheet.transactions[t].timestamp)),1)]),_:2},1024)]),_:2},1024),n(z,null,{default:l(()=>[n(v,null,{default:l(()=>[d(o(a(e).currentSheet.transactions[t].name||"New Transaction"),1)]),_:2},1024),n(v,{caption:""},{default:l(()=>[d(o(a(e).getName(a(e).payerId(t)))+" payed "+o(a(y).displayCurrency(a(e).currentSheet.transactions[t].currency,a(e).currentSheet.transactions[t].amount)),1)]),_:2},1024)]),_:2},1024),n(z,{side:""},{default:l(()=>[a(_).position(a(e).currentSheet.transactions[t],g.value)>0?(u(),m(v,{key:0,caption:"",style:{color:"green"}},{default:l(()=>[d(o(a(e).getName(c.value))+" lent ",1)]),_:1})):p("",!0),a(_).position(a(e).currentSheet.transactions[t],g.value)<0?(u(),m(v,{key:1,caption:"",style:{color:"red"}},{default:l(()=>[d(o(a(e).getName(c.value))+" borrowed ",1)]),_:1})):p("",!0),a(_).position(a(e).currentSheet.transactions[t],g.value)===0?(u(),m(v,{key:2},{default:l(()=>r[4]||(r[4]=[d(" Not Involved ")])),_:1})):(u(),m(v,{key:3,style:U({color:a(_).position(a(e).currentSheet.transactions[t],g.value)>=0?"green":"red"})},{default:l(()=>[d(o(a(y).displayCurrency(a(e).currentSheet.transactions[t].currency,Math.abs(a(_).position(a(e).currentSheet.transactions[t],g.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})],64))}});export{Se as default};
