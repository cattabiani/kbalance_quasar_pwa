import{O as A,r as y,a as v,w as h,u as i,P as M,y as e,x as s,S as z,T as F,N as k,C as x,v as _,Q as T,M as V,V as I,Y as G,U as d,aC as H,aD as Y}from"./index.5ecc8d93.js";import{Q as J}from"./QSpace.1b98c115.js";import{a as c,b}from"./QMenu.ea71b89b.js";import{Q as K}from"./PersonItem.ede9ae2f.js";import{Q as W,_ as X}from"./PeopleDropdown.9dcd4a4c.js";import{Q as Z,a as ee}from"./QHeader.77eb0d7e.js";import{a as q,Q as B,b as ae}from"./QCard.e2aaf4f9.js";import{Q as te,b as se}from"./QPage.d3ea7a22.js";import{_ as re,C as N}from"./CurrencyDropdown.82f0f045.js";import{_ as oe,a as ne}from"./TransactionList.a31090d1.js";import"./selection.d0e93c23.js";import"./focusout.e4691cd6.js";import"./scroll.373da545.js";import"./utils.ca14db4f.js";import"./QResizeObserver.c0488730.js";import"./QSlideItem.55c07129.js";import"./use-render-cache.770e5fe8.js";const we=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(le){var P,Q,w;const t=A(),n=F(),l=se(),p=y((w=(Q=t.userLedger)==null?void 0:Q.sheets[(P=t.currentSheet)==null?void 0:P.id])==null?void 0:w.name),u=y(t.user.id),C=v(()=>t.personId2Idx(u.value)),f=y(null),m=v(()=>H.getSummary(t.currentSheetResults,C.value)),$=v(()=>new Set(Object.keys(m.value.totals)));h(f,async a=>{if(a==null)return;const r=`\u{1F916} settle ${t.getName(u.value)}`;t.settleCurrencyPerson(a,C.value,r)});const L=async(a,r)=>{try{const o=`Are you sure you want to remove ${Y.name(t.currentSheet.transactions[r])}?`;l.notify({message:o,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(r),l.notify({message:"Transaction removed successfully!"})}}]})}catch(o){a(),l.notify({message:o.message||o,color:"negative"})}},R=a=>{t.transactionId=a,n.push({name:"TransactionPage"})},U=()=>{t.transactionId=null,n.push({name:"TransactionPage"})},j=async()=>{try{await t.setSheetName(p.value)}catch(a){l.notify({message:a.message||a,color:"negative"})}},D=()=>{n.push({name:"PeoplePage"})},E=()=>{n.push({name:"ConvertPage"})},S=()=>{try{t.clearCurrentSheet(),n.go(-1)}catch(a){l.notify({message:a.message||a,color:"negative"});return}};h(t.currentSheet,async a=>{a===null&&S()},{immediate:!0});const O=async()=>{try{await t.logout(),n.push({name:"LoginPage"})}catch(a){l.notify({message:a.message||a,color:"negative"});return}};return h(t.userLedger,async a=>{a===null&&await O()},{immediate:!0}),(a,r)=>(i(),M(z,null,[e(Z,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[e(ee,null,{default:s(()=>[e(k,{flat:"",icon:"arrow_back",onClick:S,"aria-label":"Go Back",class:"bg-white text-primary"}),e(J),e(W,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:s(()=>[e(K,null,{default:s(()=>[x((i(),_(b,{clickable:"",onClick:D,class:"bg-grey-3"},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(T,{name:"people"})]),_:1}),e(c,null,{default:s(()=>r[3]||(r[3]=[V("People")])),_:1})]),_:1})),[[N]]),m.value.ans.length?x((i(),_(b,{key:0,clickable:"",onClick:E},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(T,{name:"currency_exchange"})]),_:1}),e(c,null,{default:s(()=>r[4]||(r[4]=[V("Convert")])),_:1})]),_:1})),[[N]]):I("",!0),e(b,{class:G(m.value.ans.length?"bg-grey-3":"")},{default:s(()=>[e(c,null,{default:s(()=>[e(re,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=o=>f.value=o),usedCurrencies:$.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),e(te,null,{default:s(()=>{var o;return[e(q,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[e(B,{class:"row q-gutter-sm"},{default:s(()=>[d(t).currentSheet?(i(),_(X,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=g=>u.value=g),people:d(t).currentSheet.people,"sorted-people":d(t).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):I("",!0),e(ae,{class:"col",modelValue:p.value,"onUpdate:modelValue":r[2]||(r[2]=g=>p.value=g),onBlur:j,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),e(oe,{summaries:m.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),e(q,{class:"q-ma-md"},{default:s(()=>[e(B,{class:"row justify-center items-center q-pa-sm"},{default:s(()=>[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:U})]),_:1})]),_:1}),e(ne,{transactions:((o=d(t).currentSheet)==null?void 0:o.transactions)||{},selectedPerson:u.value,onRemove:L,onEdit:R},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{we as default};
