import{_ as R,r as S,a as f,w,u as i,$ as P,y as t,x as r,a0 as k,a1 as j,Z as m,a2 as d,v as h,a3 as Q,a5 as A,aC as O,aD as U,C as F,Y as G,a4 as H}from"./index.94197c7e.js";import{Q as Y}from"./QSpace.5528fce8.js";import{Q as Z,a as z,b as J,d as K,f as M,e as W}from"./PersonItem.34a8688e.js";import{e as X,c as ee,d as ae,Q as x,f as te}from"./QPage.96a0dfab.js";import{C as se}from"./ClosePopup.cf1d12b2.js";import{_ as re}from"./PeopleDropdown.12c4575e.js";import{_ as oe,a as ne}from"./TransactionList.ac7593b2.js";import{c as le}from"./index.56516dd5.js";import"./focusout.46bd4b74.js";import"./scroll.8474c8dd.js";import"./QResizeObserver.ad0286f1.js";import"./QSlideItem.8a521b86.js";const Se=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var _,b,C;const a=R(),c=j(),l=ee(),p=S((C=(b=a.userLedger)==null?void 0:b.sheets[(_=a.currentSheet)==null?void 0:_.id])==null?void 0:C.name),u=S(a.user.id),v=f(()=>a.personId2Idx(u.value)),g=f(()=>O.getSummary(a.currentSheetResults,v.value)),T=le.data.map(e=>({label:`${e.code} - ${e.currency}`,value:e.code})),$=f(()=>T.filter(e=>Object.keys(g.value.totals).includes(e.value))),q=async e=>{let o=`\u{1F916} settle ${a.getName(u.value)}`;const n=a.makeEquivalentTransactionBatch(e,v.value,o);try{await a.addTransactions(n)}catch(s){l.notify({message:s.message||s,color:"negative"});return}},B=async(e,o)=>{try{const n=`Are you sure you want to remove ${U.name(a.currentSheet.transactions[o])}?`;l.notify({message:n,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(o),l.notify({message:"Transaction removed successfully!"})}}]})}catch(n){l.notify({message:n.message||n,color:"negative"})}},V=e=>{a.transactionId=e,c.push({name:"TransactionPage"})},I=()=>{a.transactionId=null,c.push({name:"TransactionPage"})},N=async()=>{try{await a.setSheetName(p.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},E=()=>{c.push({name:"PeoplePage"})},L=()=>{c.push({name:"ConvertPage"})},y=()=>{try{a.clearCurrentSheet(),c.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};w(a.currentSheet,async e=>{e===null&&y()},{immediate:!0});const D=async()=>{try{await a.logout(),c.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return w(a.userLedger,async e=>{e===null&&await D()},{immediate:!0}),(e,o)=>(i(),P(k,null,[t(Z,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[t(z,null,{default:r(()=>[t(m,{flat:"",icon:"arrow_back",onClick:y,"aria-label":"Go Back",class:"bg-white text-primary"}),t(Y),t(m,{flat:"",icon:"people",onClick:E,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(X,null,{default:r(()=>{var n;return[t(ae,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[t(x,{class:"row q-gutter-sm"},{default:r(()=>[d(a).currentSheet?(i(),h(re,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),people:d(a).currentSheet.people,"sorted-people":d(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):Q("",!0),t(te,{class:"col",modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=s=>p.value=s),onBlur:N,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(oe,{summaries:g.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),t(x,{class:"row justify-center items-center"},{default:r(()=>[t(J,{label:"Settle",icon:"payments",flat:"",class:"q-mr-md bg-green text-white"},{default:r(()=>[t(K,null,{default:r(()=>[(i(!0),P(k,null,A($.value,s=>F((i(),h(M,{key:s.value,clickable:"",onClick:ue=>q(s.value)},{default:r(()=>[t(W,null,{default:r(()=>[G(H(s.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])),128))]),_:1})]),_:1}),g.value.ans.length?(i(),h(m,{key:0,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:L})):Q("",!0),t(m,{flat:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:I})]),_:1}),t(ne,{transactions:((n=d(a).currentSheet)==null?void 0:n.transactions)||{},selectedPerson:u.value,onRemove:B,onEdit:V},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{Se as default};
