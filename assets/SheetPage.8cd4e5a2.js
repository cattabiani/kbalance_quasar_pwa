import{_ as j,r as w,a as y,w as k,u as m,$ as P,y as t,x as s,a0 as Q,a1 as A,Z as d,a2 as p,v as g,a3 as h,a5 as O,aD as U,aE as F,C as G,Y as H,a4 as Y}from"./index.d805685e.js";import{Q as Z}from"./QSpace.7dfd2c4c.js";import{Q as z,a as J}from"./QHeader.a0e7a5bc.js";import{d as K,c as x,Q as T,e as M}from"./QPage.6bf9a4bb.js";import{a as W,Q as X,d as ee,b as ae}from"./PersonItem.5988aac3.js";import{C as te}from"./ClosePopup.ca87e6ea.js";import{u as se}from"./use-quasar.e78684d1.js";import{_ as re}from"./PeopleDropdown.8195a617.js";import{_ as oe,a as ne}from"./TransactionList.15d0d343.js";import{c as le}from"./index.56516dd5.js";import"./QResizeObserver.94202ed4.js";import"./focusout.e19f3ab2.js";import"./scroll.68547dd0.js";import"./QSlideItem.fcbdd056.js";const ke=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var b,C,S;const a=j(),c=A(),l=se(),f=w((S=(C=a.userLedger)==null?void 0:C.sheets[(b=a.currentSheet)==null?void 0:b.id])==null?void 0:S.name),u=w(a.user.id),v=y(()=>a.personId2Idx(u.value)),i=y(()=>U.getSummary(a.currentSheetResults,v.value)),q=le.data.map(e=>({label:`${e.code} - ${e.currency}`,value:e.code})),$=y(()=>q.filter(e=>Object.keys(i.value.totals).includes(e.value))),B=async e=>{let o=`\u{1F916} settle ${a.getName(u.value)}`;const n=a.makeEquivalentTransactionBatch(e,v.value,o);try{await a.addTransactions(n)}catch(r){l.notify({message:r.message||r,color:"negative"});return}},V=async(e,o)=>{try{const n=`Are you sure you want to remove ${F.name(a.currentSheet.transactions[o])}?`;l.notify({message:n,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(o),l.notify({message:"Transaction removed successfully!"})}}]})}catch(n){l.notify({message:n.message||n,color:"negative"})}},I=e=>{a.transactionId=e,c.push({name:"TransactionPage"})},N=()=>{a.transactionId=null,c.push({name:"TransactionPage"})},E=async()=>{try{await a.setSheetName(f.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},L=()=>{c.push({name:"PeoplePage"})},D=()=>{c.push({name:"ConvertPage"})},_=()=>{try{a.clearCurrentSheet(),c.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};k(a.currentSheet,async e=>{e===null&&_()},{immediate:!0});const R=async()=>{try{await a.logout(),c.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return k(a.userLedger,async e=>{e===null&&await R()},{immediate:!0}),(e,o)=>(m(),P(Q,null,[t(z,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[t(J,null,{default:s(()=>[t(d,{flat:"",icon:"arrow_back",onClick:_,"aria-label":"Go Back",class:"bg-white text-primary"}),t(Z),t(d,{flat:"",icon:"people",onClick:L,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(K,null,{default:s(()=>{var n;return[t(x,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(T,{class:"row q-gutter-sm"},{default:s(()=>[p(a).currentSheet?(m(),g(re,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=r=>u.value=r),people:p(a).currentSheet.people,"sorted-people":p(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):h("",!0),t(M,{class:"col",modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=r=>f.value=r),onBlur:E,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(oe,{summaries:i.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),t(x,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t(T,{class:"row justify-center items-center"},{default:s(()=>[i.value.ans.length?(m(),g(X,{key:0,label:"Settle",icon:"payments",flat:"",class:"q-mr-md bg-green text-white"},{default:s(()=>[t(W,null,{default:s(()=>[(m(!0),P(Q,null,O($.value,r=>G((m(),g(ee,{key:r.value,clickable:"",onClick:ue=>B(r.value)},{default:s(()=>[t(ae,null,{default:s(()=>[H(Y(r.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[te]])),128))]),_:1})]),_:1})):h("",!0),i.value.ans.length?(m(),g(d,{key:1,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:D})):h("",!0),t(d,{flat:"",class:"q-mt-sm bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:N})]),_:1})]),_:1}),t(ne,{transactions:((n=p(a).currentSheet)==null?void 0:n.transactions)||{},selectedPerson:u.value,onRemove:V,onEdit:I},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{ke as default};
