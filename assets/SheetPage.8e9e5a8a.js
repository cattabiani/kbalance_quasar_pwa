import{O,r as v,a as y,w as h,u as m,P as A,y as e,x as o,S as M,T as z,N as k,C as V,v as _,Q as T,M as B,V as I,Y as F,L as w,U as d,aC as G,aD as H}from"./index.3fd8f0e6.js";import{Q as Y}from"./QSpace.f5526d6a.js";import{a as c,b}from"./QMenu.63d5779a.js";import{Q as J}from"./PersonItem.140e2933.js";import{Q as K,_ as W}from"./PeopleDropdown.3709102d.js";import{Q as X,a as Z}from"./QHeader.5a5b2524.js";import{a as ee,Q as ae,b as te}from"./QCard.ec05a8a9.js";import{Q as se,b as oe}from"./QPage.058ae615.js";import{_ as re,C as N}from"./CurrencyDropdown.bbc60b66.js";import{_ as ne,a as le}from"./TransactionList.836b1984.js";import"./selection.bf28801d.js";import"./focusout.59205f5d.js";import"./scroll.898b39f1.js";import"./QResizeObserver.5161a85c.js";import"./utils.ca14db4f.js";import"./QSlideItem.62714604.js";import"./use-render-cache.770e5fe8.js";const ue={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},ce={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},ie={class:"row justify-center items-center q-pb-md"},Te=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(me){var P,Q,x;const t=O(),n=z(),l=oe(),p=v((x=(Q=t.userLedger)==null?void 0:Q.sheets[(P=t.currentSheet)==null?void 0:P.id])==null?void 0:x.name),u=v(t.user.id),C=y(()=>t.personId2Idx(u.value)),f=v(null),i=y(()=>G.getSummary(t.currentSheetResults,C.value)),$=y(()=>new Set(Object.keys(i.value.totals)));h(f,async a=>{if(a==null)return;const s=`\u{1F916} settle ${t.getName(u.value)}`;t.settleCurrencyPerson(a,C.value,s)});const q=async(a,s)=>{try{const r=`Are you sure you want to remove ${H.name(t.currentSheet.transactions[s])}?`;l.notify({message:r,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(s),l.notify({message:"Transaction removed successfully!"})}}]})}catch(r){a(),l.notify({message:r.message||r,color:"negative"})}},L=a=>{t.transactionId=a,n.push({name:"TransactionPage"})},R=()=>{t.transactionId=null,n.push({name:"TransactionPage"})},U=async()=>{try{await t.setSheetName(p.value)}catch(a){l.notify({message:a.message||a,color:"negative"})}},j=()=>{n.push({name:"PeoplePage"})},D=()=>{n.push({name:"ConvertPage"})},S=()=>{try{t.clearCurrentSheet(),n.go(-1)}catch(a){l.notify({message:a.message||a,color:"negative"});return}};h(t.currentSheet,async a=>{a===null&&S()},{immediate:!0});const E=async()=>{try{await t.logout(),n.push({name:"LoginPage"})}catch(a){l.notify({message:a.message||a,color:"negative"});return}};return h(t.userLedger,async a=>{a===null&&await E()},{immediate:!0}),(a,s)=>(m(),A(M,null,[e(X,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[e(Z,null,{default:o(()=>[e(k,{flat:"",icon:"arrow_back",onClick:S,"aria-label":"Go Back",class:"bg-white text-primary"}),e(Y),e(K,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:o(()=>[e(J,null,{default:o(()=>[V((m(),_(b,{clickable:"",onClick:j,class:"bg-grey-3"},{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(T,{name:"people"})]),_:1}),e(c,null,{default:o(()=>s[3]||(s[3]=[B("People")])),_:1})]),_:1})),[[N]]),i.value.ans.length?V((m(),_(b,{key:0,clickable:"",onClick:D},{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(T,{name:"currency_exchange"})]),_:1}),e(c,null,{default:o(()=>s[4]||(s[4]=[B("Convert")])),_:1})]),_:1})),[[N]]):I("",!0),e(b,{class:F(i.value.ans.length?"bg-grey-3":"")},{default:o(()=>[e(c,null,{default:o(()=>[e(re,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=r=>f.value=r),usedCurrencies:$.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:o(()=>{var r;return[e(ee,{class:"q-my-md q-mr-md q-ml-md"},{default:o(()=>[e(ae,{class:"row no-wrap items-center"},{default:o(()=>[w("div",ue,[d(t).currentSheet?(m(),_(W,{key:0,modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=g=>u.value=g),people:d(t).currentSheet.people,"sorted-people":d(t).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):I("",!0)]),w("div",ce,[e(te,{modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=g=>p.value=g),onBlur:U,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(ne,{summaries:i.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),w("div",ie,[e(k,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:R})]),e(le,{transactions:((r=d(t).currentSheet)==null?void 0:r.transactions)||{},selectedPerson:u.value,onRemove:q,onEdit:L},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{Te as default};
