import{_ as z,r as A,a as b,w as R,u as c,$ as f,y as l,x as n,a0 as x,a1 as H,Z as q,Y as p,X as i,a2 as o,a3 as t,v as m,a6 as y,a4 as F,aC as K,ap as L,a5 as J,aD as S}from"./index.4750bf8b.js";import{Q as X,a as Z,b as W,d as ee,e as te,f as O,g as v}from"./QList.569696fd.js";import{e as ae,c as se,d as E,Q as j,f as re}from"./QPage.88ea25c0.js";import{_ as ne}from"./PeopleDropdown.f9b46f41.js";import"./QResizeObserver.89513726.js";import"./PersonItem.18940137.js";import"./focusout.e554befa.js";import"./scroll.51770927.js";const g={getDay(u){return new Date(u).getDate().toString().padStart(2,"0")},getMonth(u){const e=new Date(u);return new Intl.DateTimeFormat("en-GB",{month:"short"}).format(e)},getYear(u){return new Date(u).getFullYear()},displayCurrency(u,e){return`${u} ${parseFloat(e/100)}`},truncate(u){if(!u)return u;const e=40;return u.length>e?u.substring(0,e-3)+"...":u},isDev(){return!!{}.VITE_FIREBASE_API_KEY&&!!{}.VITE_FIREBASE_AUTH_DOMAIN&&!!{}.VITE_FIREBASE_PROJECT_ID&&!!{}.VITE_FIREBASE_STORAGE_BUCKET&&!!{}.VITE_FIREBASE_MESSAGING_SENDER_ID&&!!{}.VITE_FIREBASE_APP_ID}},le={class:"text-subtitle2"},oe={class:"q-pa-md"},ue={key:0,style:{color:"green"}},ce={key:1,style:{color:"red"}},ie={class:"q-pa-md"},he=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(u){var P,B,V;const e=z(),h=H(),T=se(),k=A((V=(B=e.userLedger)==null?void 0:B.sheets[(P=e.currentSheet)==null?void 0:P.id])==null?void 0:V.name),d=A(e.user.id),_=b(()=>e.currentSheetPeople.indexOf(d.value)),I=b(()=>{const{ans:s,totals:r}=K.getSummary(e.currentSheetResults,_.value);return{detail:s.map((C,Q)=>({...C,id:Q})),totals:r}}),w=b(()=>Object.entries(I.value.totals).filter(([s,r])=>r>0).map(([s,r])=>g.displayCurrency(s,r)).join(" + ")),N=b(()=>Object.entries(I.value.totals).filter(([s,r])=>r<0).map(([s,r])=>g.displayCurrency(s,-r)).join(" + ")),M=s=>{e.transactionId=s,h.push({name:"TransactionPage"})},$=()=>{e.transactionId=null,h.push({name:"TransactionPage"})},G=async()=>{try{await e.setSheetName(k.value)}catch(s){T.notify({message:s.message||s,color:"negative"})}},U=()=>{h.push({name:"PeoplePage"})},D=()=>{try{e.clearCurrentSheet(),h.go(-1)}catch(s){T.notify({message:s.message||s,color:"negative"});return}};R(e.currentSheet,async s=>{s===null&&D()},{immediate:!0});const Y=async()=>{try{await e.logout(),h.push({name:"LoginPage"})}catch(s){T.notify({message:s.message||s,color:"negative"});return}};return R(e.userLedger,async s=>{s===null&&await Y()},{immediate:!0}),(s,r)=>(c(),f(x,null,[l(X,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[l(Z,null,{default:n(()=>[l(q,{flat:"",icon:"arrow_back",onClick:D,"aria-label":"Go Back",class:"bg-white text-primary"}),l(W,{style:{"font-size":"28px"}},{default:n(()=>[r[2]||(r[2]=p(" Sheet ")),i("div",le,o(t(e).user.email),1)]),_:1}),l(q,{flat:"",icon:"people",onClick:U,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"}),l(q,{class:"q-ml-md bg-white text-primary",icon:"note_add",label:"Add Transaction",onClick:$})]),_:1})]),_:1}),l(ae,null,{default:n(()=>[l(E,null,{default:n(()=>[l(j,{class:"row q-gutter-sm"},{default:n(()=>[t(e).currentSheet?(c(),m(ne,{key:0,class:"col-auto",modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=a=>d.value=a),people:t(e).currentSheet.people,"is-fixed-label":!1},null,8,["modelValue","people"])):y("",!0),l(re,{class:"col",modelValue:k.value,"onUpdate:modelValue":r[1]||(r[1]=a=>k.value=a),onBlur:G,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),N.value||w.value?(c(),m(E,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:n(()=>[i("div",oe,[N.value?(c(),f("div",ue,o(t(e).getName(d.value))+" is owed "+o(N.value),1)):y("",!0),w.value?(c(),f("div",ce,o(t(e).getName(d.value))+" owes "+o(w.value),1)):y("",!0)])]),_:1})):y("",!0),I.value.detail.length>0?(c(),m(E,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:n(()=>[i("div",ie,[(c(!0),f(x,null,F(I.value.detail,a=>(c(),f("div",{key:a.id},[i("div",null,[i("span",null,o(a.amount>0?t(e).getName(d.value):t(e).getName(t(e).personIdx2Id(a.person))),1),r[3]||(r[3]=i("span",null," owes ",-1)),i("span",null,o(a.amount<0?t(e).getName(d.value):t(e).getName(t(e).personIdx2Id(a.person)))+" \xA0 ",1),i("span",{style:L({color:a.amount>0?"red":"green"})},o(t(g).displayCurrency(a.currency,Math.abs(a.amount))),5)])]))),128))])]),_:1})):y("",!0),l(ee,null,{default:n(()=>[(c(!0),f(x,null,F(t(e).currentSheetTransactions,(a,C)=>(c(),m(te,{key:a,clickable:"",class:J(C%2===0?"bg-grey-3":"bg-white"),onClick:Q=>M(a)},{default:n(()=>[l(E,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:n(()=>[l(j,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:n(()=>[i("div",null,o(t(g).getMonth(t(e).currentSheet.transactions[a].timestamp)),1),i("div",null,o(t(g).getDay(t(e).currentSheet.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),l(O,null,{default:n(()=>[l(v,null,{default:n(()=>[p(o(t(e).currentSheet.transactions[a].name||"New Transaction"),1)]),_:2},1024),l(v,{caption:""},{default:n(()=>[p(o(t(e).getName(t(e).payerId(a)))+" payed "+o(t(g).displayCurrency(t(e).currentSheet.transactions[a].currency,t(e).currentSheet.transactions[a].amount)),1)]),_:2},1024)]),_:2},1024),l(O,{side:""},{default:n(()=>[t(S).position(t(e).currentSheet.transactions[a],_.value)>0?(c(),m(v,{key:0,caption:"",style:{color:"green"}},{default:n(()=>[p(o(t(e).getName(d.value))+" lent ",1)]),_:1})):y("",!0),t(S).position(t(e).currentSheet.transactions[a],_.value)<0?(c(),m(v,{key:1,caption:"",style:{color:"red"}},{default:n(()=>[p(o(t(e).getName(d.value))+" borrowed ",1)]),_:1})):y("",!0),t(S).position(t(e).currentSheet.transactions[a],_.value)===0?(c(),m(v,{key:2},{default:n(()=>r[4]||(r[4]=[p(" Not Involved ")])),_:1})):(c(),m(v,{key:3,style:L({color:t(S).position(t(e).currentSheet.transactions[a],_.value)>=0?"green":"red"})},{default:n(()=>[p(o(t(g).displayCurrency(t(e).currentSheet.transactions[a].currency,Math.abs(t(S).position(t(e).currentSheet.transactions[a],_.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})],64))}});export{he as default};
