import{_ as Z,r as P,a as Q,w as $,u as o,$ as v,y as l,x as r,a0 as T,a1 as J,Z as I,a2 as a,v as i,a3 as y,X as c,a4 as u,a5 as U,aC as K,an as z,a6 as W,Q as ee,Y as h,aD as g}from"./index.a806d26d.js";import{Q as ae}from"./QSpace.7ffd943e.js";import{Q as te,a as se,d as re,U as f,f as ne,e as A,g as _}from"./PersonItem.7fcf1ebd.js";import{Q as le}from"./QInput.8061a07f.js";import{e as oe,c as ue,d as b,Q as V}from"./QPage.c0d6ab01.js";import{Q as ce}from"./QSlideItem.581009df.js";import{_ as ie}from"./PeopleDropdown.1eb61a1f.js";import"./focusout.4c62d806.js";import"./scroll.6ce354fe.js";import"./QResizeObserver.2d174bfe.js";const me={class:"q-pa-md"},de={key:0,style:{color:"green"}},pe={key:1,style:{color:"red"}},ye={class:"q-pa-md"},Qe=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ge){var L,j,D;const e=Z(),S=J(),d=ue(),E=P(null),N=P((D=(j=e.userLedger)==null?void 0:j.sheets[(L=e.currentSheet)==null?void 0:L.id])==null?void 0:D.name),m=P(e.user.id),p=Q(()=>e.personId2Idx(m.value)),k=Q(()=>{const{ans:s,totals:n}=K.getSummary(e.currentSheetResults,p.value);return{detail:s.map((x,w)=>({...x,id:w})),totals:n}}),q=Q(()=>Object.entries(k.value.totals).filter(([s,n])=>n>0).map(([s,n])=>f.displayCurrency(s,n)).join(" + ")),C=Q(()=>Object.entries(k.value.totals).filter(([s,n])=>n<0).map(([s,n])=>f.displayCurrency(s,-n)).join(" + ")),M=s=>{E.value=setTimeout(()=>{s==null||s()},0)},O=async({reset:s},n)=>{try{const t=`Are you sure you want to remove ${g.name(e.currentSheet.transactions[n])}?`;d.notify({message:t,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>M(s)},{label:"Confirm",color:"red",handler:async()=>{e.removeTransaction(n),d.notify({message:"Transaction removed successfully!"})}}]})}catch(t){d.notify({message:t.message||t,color:"negative"})}},R=s=>{e.transactionId=s,S.push({name:"TransactionPage"})},F=()=>{e.transactionId=null,S.push({name:"TransactionPage"})},G=async()=>{try{await e.setSheetName(N.value)}catch(s){d.notify({message:s.message||s,color:"negative"})}},H=()=>{S.push({name:"PeoplePage"})},X=()=>{d.notify({message:"Coming soon!"})},B=()=>{try{e.clearCurrentSheet(),S.go(-1)}catch(s){d.notify({message:s.message||s,color:"negative"});return}};$(e.currentSheet,async s=>{s===null&&B()},{immediate:!0});const Y=async()=>{try{await e.logout(),S.push({name:"LoginPage"})}catch(s){d.notify({message:s.message||s,color:"negative"});return}};return $(e.userLedger,async s=>{s===null&&await Y()},{immediate:!0}),(s,n)=>(o(),v(T,null,[l(te,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[l(se,null,{default:r(()=>[l(I,{flat:"",icon:"arrow_back",onClick:B,"aria-label":"Go Back",class:"bg-white text-primary"}),l(ae),l(I,{flat:"",icon:"people",onClick:H,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),l(oe,null,{default:r(()=>[l(b,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[l(V,{class:"row q-gutter-sm"},{default:r(()=>[a(e).currentSheet?(o(),i(ie,{key:0,class:"col-auto",modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=t=>m.value=t),people:a(e).currentSheet.people,"sorted-people":a(e).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):y("",!0),l(le,{class:"col",modelValue:N.value,"onUpdate:modelValue":n[1]||(n[1]=t=>N.value=t),onBlur:G,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),C.value||q.value?(o(),i(b,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[c("div",me,[C.value?(o(),v("div",de,u(a(e).getName(m.value))+" is owed "+u(C.value),1)):y("",!0),q.value?(o(),v("div",pe,u(a(e).getName(m.value))+" owes "+u(q.value),1)):y("",!0)])]),_:1})):(o(),i(b,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>n[2]||(n[2]=[c("div",{class:"q-pa-md"},[c("div",null,"All Settled!")],-1)])),_:1})),k.value.detail.length>0?(o(),i(b,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[c("div",ye,[(o(!0),v(T,null,U(k.value.detail,t=>(o(),v("div",{key:t.id},[c("div",null,[c("span",null,u(t.amount>0?a(e).getName(m.value):a(e).getName(a(e).personIdx2Id(t.person))),1),n[3]||(n[3]=c("span",null," owes ",-1)),c("span",null,u(t.amount<0?a(e).getName(m.value):a(e).getName(a(e).personIdx2Id(t.person)))+" \xA0 ",1),c("span",{style:z({color:t.amount>0?"red":"green"})},u(a(f).displayCurrency(t.currency,Math.abs(t.amount))),5)])]))),128))])]),_:1})):y("",!0),l(V,{class:"row justify-center items-center"},{default:r(()=>[C.value||q.value?(o(),i(I,{key:0,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:X})):y("",!0),l(I,{flat:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:F})]),_:1}),l(re,null,{default:r(()=>[(o(!0),v(T,null,U(a(e).currentSheetTransactions,(t,x)=>(o(),i(ce,{key:t,clickable:"",class:W(x%2===0?"bg-grey-3":"bg-white"),onClick:w=>R(t),onLeft:w=>O(w,t),"left-color":"red"},{left:r(()=>[l(ee,{name:"delete"})]),default:r(()=>[l(ne,null,{default:r(()=>[l(b,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:r(()=>[l(V,{class:"column q-pa-none",style:{display:"flex","justify-content":"center","align-items":"center"}},{default:r(()=>[c("div",null,u(a(f).getMonth(a(e).currentSheet.transactions[t].timestamp)),1),c("div",null,u(a(f).getDay(a(e).currentSheet.transactions[t].timestamp)),1)]),_:2},1024)]),_:2},1024),l(A,null,{default:r(()=>[l(_,null,{default:r(()=>[h(u(a(g).name(a(e).currentSheet.transactions[t])),1)]),_:2},1024),l(_,{caption:""},{default:r(()=>[h(u(a(e).getName(a(e).payerId(t)))+" payed "+u(a(f).displayCurrency(a(e).currentSheet.transactions[t].currency,a(e).currentSheet.transactions[t].amount)),1)]),_:2},1024)]),_:2},1024),l(A,{side:""},{default:r(()=>[a(g).position(a(e).currentSheet.transactions[t],p.value)>0?(o(),i(_,{key:0,caption:"",style:{color:"green"}},{default:r(()=>[h(u(a(e).getName(m.value))+" lent ",1)]),_:1})):y("",!0),a(g).position(a(e).currentSheet.transactions[t],p.value)<0?(o(),i(_,{key:1,caption:"",style:{color:"red"}},{default:r(()=>[h(u(a(e).getName(m.value))+" borrowed ",1)]),_:1})):y("",!0),a(g).position(a(e).currentSheet.transactions[t],p.value)===0?(o(),i(_,{key:2},{default:r(()=>[h(u(p.value!==a(e).currentSheet.transactions[t].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(o(),i(_,{key:3,style:z({color:a(g).position(a(e).currentSheet.transactions[t],p.value)>=0?"green":"red"})},{default:r(()=>[h(u(a(f).displayCurrency(a(e).currentSheet.transactions[t].currency,Math.abs(a(g).position(a(e).currentSheet.transactions[t],p.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick","onLeft"]))),128))]),_:1})]),_:1})],64))}});export{Qe as default};
