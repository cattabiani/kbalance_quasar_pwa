import{O as E,r as f,a as y,w as h,u as v,P as R,y as t,x as r,S as U,T as L,N as m,U as i,v as x,V as k,aC as O,aD as A}from"./index.0eb7440f.js";import{Q as D}from"./QSpace.fe11e780.js";import{Q as F,a as G}from"./QHeader.d821138a.js";import{a as Q,Q as b,b as H}from"./QCard.2d65752c.js";import{Q as z,b as J}from"./QPage.121ea0a3.js";import{_ as K}from"./PeopleDropdown.5063388e.js";import{_ as M,a as W}from"./TransactionList.cd093a18.js";import{_ as X}from"./CurrencyDropdown.d8d95497.js";import"./QResizeObserver.99864713.js";import"./PersonItem.875107dc.js";import"./selection.a9ae5d48.js";import"./focusout.a1bf1d3c.js";import"./scroll.744ebd87.js";import"./QSlideItem.f6a01303.js";import"./use-render-cache.770e5fe8.js";const ge=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(Y){var C,P,w;const a=E(),n=L(),l=J(),d=f((w=(P=a.userLedger)==null?void 0:P.sheets[(C=a.currentSheet)==null?void 0:C.id])==null?void 0:w.name),c=f(a.user.id),_=y(()=>a.personId2Idx(c.value)),p=f(null),g=y(()=>O.getSummary(a.currentSheetResults,_.value)),q=y(()=>new Set(Object.keys(g.value.totals)));h(p,async e=>{if(e==null)return;const s=`\u{1F916} settle ${a.getName(c.value)}`;a.settleCurrencyPerson(e,_.value,s)});const T=async(e,s)=>{try{const o=`Are you sure you want to remove ${A.name(a.currentSheet.transactions[s])}?`;l.notify({message:o,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(s),l.notify({message:"Transaction removed successfully!"})}}]})}catch(o){e(),l.notify({message:o.message||o,color:"negative"})}},V=e=>{a.transactionId=e,n.push({name:"TransactionPage"})},B=()=>{a.transactionId=null,n.push({name:"TransactionPage"})},N=async()=>{try{await a.setSheetName(d.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},$=()=>{n.push({name:"PeoplePage"})},I=()=>{n.push({name:"ConvertPage"})},S=()=>{try{a.clearCurrentSheet(),n.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};h(a.currentSheet,async e=>{e===null&&S()},{immediate:!0});const j=async()=>{try{await a.logout(),n.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return h(a.userLedger,async e=>{e===null&&await j()},{immediate:!0}),(e,s)=>(v(),R(U,null,[t(F,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[t(G,null,{default:r(()=>[t(m,{flat:"",icon:"arrow_back",onClick:S,"aria-label":"Go Back",class:"bg-white text-primary"}),t(D),t(m,{flat:"",icon:"people",onClick:$,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(z,null,{default:r(()=>{var o;return[t(Q,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[t(b,{class:"row q-gutter-sm"},{default:r(()=>[i(a).currentSheet?(v(),x(K,{key:0,class:"col-auto",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=u=>c.value=u),people:i(a).currentSheet.people,"sorted-people":i(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):k("",!0),t(H,{class:"col",modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=u=>d.value=u),onBlur:N,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,{summaries:g.value,selectedPerson:c.value},null,8,["summaries","selectedPerson"]),t(Q,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[t(b,{class:"row justify-center items-center q-pb-none"},{default:r(()=>[t(m,{flat:"",dense:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:B}),g.value.ans.length?(v(),x(m,{key:0,flat:"",dense:"",class:"q-ml-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:I})):k("",!0)]),_:1}),t(b,{class:"row justify-center items-center q-bt-sm"},{default:r(()=>[t(X,{modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=u=>p.value=u),usedCurrencies:q.value,label:"Settle",icon:"payments",flat:"",dense:"",clear:"",class:"bg-green text-white",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1}),t(W,{transactions:((o=i(a).currentSheet)==null?void 0:o.transactions)||{},selectedPerson:c.value,onRemove:T,onEdit:V},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{ge as default};
