import{O as H,r as d,a as L,w as q,u as i,P as J,y as e,x as a,S as K,T as W,N as C,C as p,v as f,Q as v,M as y,V as P,am as X,L as Q,U as b,aC as Y,aD as Z,z as ee}from"./index.e9f7faa0.js";import{Q as te}from"./QSpace.2c55484e.js";import{a as n,b as w}from"./QMenu.57a49691.js";import{Q as ae}from"./PersonItem.cfc78cc6.js";import{Q as oe,_ as se}from"./PeopleDropdown.f169fbbc.js";import{Q as le,a as N}from"./QHeader.ab6c8a39.js";import{b as R,a as re,Q as ne}from"./QCard.2750a515.js";import{Q as ce,b as ue}from"./QPage.ba1d7726.js";import{C as _}from"./index.3853611b.js";import{_ as ie,a as me}from"./TransactionList.1cc51e70.js";import"./selection.12c5595f.js";import"./focusout.b58f90b3.js";import"./scroll.0c10a292.js";import"./QResizeObserver.8caadd1d.js";import"./utils.287e7c2a.js";import"./QSlideItem.7ce05f6d.js";import"./use-render-cache.770e5fe8.js";const de={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},pe={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},fe={class:"row justify-center items-center q-pb-md"},qe=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(he){var V,I,B;const o=H(),c=W(),u=ue(),S=d((B=(I=o.userLedger)==null?void 0:I.sheets[(V=o.currentSheet)==null?void 0:V.id])==null?void 0:B.name),m=d(o.user.id),U=L(()=>o.personId2Idx(m.value)),h=d(null),g=d(!1),x=d(null),k=L(()=>Y.getSummary(o.currentSheetResults,U.value)),$=async(t,s)=>{try{const l=`Are you sure you want to remove ${Z.name(o.currentSheet.transactions[s])}?`;u.notify({message:l,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>t()},{label:"Confirm",color:"red",handler:async()=>{o.removeTransaction(s),u.notify({message:"Transaction removed successfully!"})}}]})}catch(l){t(),u.notify({message:l.message||l,color:"negative"})}},j=t=>{o.transactionId=t,c.push({name:"TransactionPage"})},A=()=>{o.transactionId=null,c.push({name:"TransactionPage"})},D=async()=>{try{await o.setSheetName(S.value)}catch(t){u.notify({message:t.message||t,color:"negative"})}},E=()=>{c.push({name:"PeoplePage"})},O=()=>{c.push({name:"ConvertPage"})},M=()=>{c.push({name:"SettlePage"})},T=()=>{try{o.clearCurrentSheet(),c.go(-1)}catch(t){u.notify({message:t.message||t,color:"negative"});return}};q(o.currentSheet,async t=>{t===null&&T()},{immediate:!0});const z=async()=>{try{await o.logout(),c.push({name:"LoginPage"})}catch(t){u.notify({message:t.message||t,color:"negative"});return}};q(o.userLedger,async t=>{t===null&&await z()},{immediate:!0});const F=()=>{g.value=!g.value,g.value?ee(()=>{var t;(t=x.value)==null||t.focus()}):h.value=""},G=()=>{const t=o.currentSheetToCsv(),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.setAttribute("download","sheet.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)};return(t,s)=>(i(),J(K,null,[e(le,{elevated:"",class:"bg-primary text-white"},{default:a(()=>[e(N,null,{default:a(()=>[e(C,{flat:"",icon:"arrow_back",onClick:T,"aria-label":"Go Back",class:"bg-white text-primary"}),e(te),e(C,{flat:"",icon:"search",label:"Search",onClick:F,class:"bg-white text-primary q-mr-sm"}),e(oe,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:a(()=>[e(ae,null,{default:a(()=>[p((i(),f(w,{clickable:"",onClick:E,class:"bg-grey-3"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(v,{name:"people"})]),_:1}),e(n,null,{default:a(()=>s[3]||(s[3]=[y("People")])),_:1})]),_:1})),[[_]]),k.value.ans.length?p((i(),f(w,{key:0,clickable:"",onClick:O},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(v,{name:"currency_exchange"})]),_:1}),e(n,null,{default:a(()=>s[4]||(s[4]=[y("Convert")])),_:1})]),_:1})),[[_]]):P("",!0),k.value.ans.length?p((i(),f(w,{key:1,clickable:"",onClick:M},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(v,{name:"payments"})]),_:1}),e(n,null,{default:a(()=>s[5]||(s[5]=[y("Settle")])),_:1})]),_:1})),[[_]]):P("",!0),p((i(),f(w,{clickable:"",onClick:G},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(v,{name:"download"})]),_:1}),e(n,null,{default:a(()=>s[6]||(s[6]=[y("Download (csv)")])),_:1})]),_:1})),[[_]])]),_:1})]),_:1})]),_:1}),p(e(N,{class:"bg-primary q-pa-sm"},{default:a(()=>[e(R,{ref_key:"searchInput",ref:x,dense:"",outlined:"",debounce:"300",modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=l=>h.value=l),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[X,g.value]])]),_:1}),e(ce,null,{default:a(()=>{var l;return[e(re,{class:"q-my-md q-mr-md q-ml-md"},{default:a(()=>[e(ne,{class:"row no-wrap items-center"},{default:a(()=>[Q("div",de,[b(o).currentSheet?(i(),f(se,{key:0,modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=r=>m.value=r),people:b(o).currentSheet.people,"sorted-people":b(o).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):P("",!0)]),Q("div",pe,[e(R,{modelValue:S.value,"onUpdate:modelValue":s[2]||(s[2]=r=>S.value=r),onBlur:D,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(ie,{summaries:k.value,selectedPerson:m.value},null,8,["summaries","selectedPerson"]),Q("div",fe,[e(C,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:A})]),e(me,{transactions:((l=b(o).currentSheet)==null?void 0:l.transactions)||{},selectedPerson:m.value,"search-string":h.value,onRemove:$,onEdit:j},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{qe as default};
