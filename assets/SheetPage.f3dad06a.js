import{O as H,r as c,a as _,w as b,u as f,P as Y,y as e,x as l,S as J,T as K,N as w,C as S,v as C,Q as N,M as q,V as $,Y as W,am as X,L as P,U as g,aC as Z,aD as ee,z as ae}from"./index.81992853.js";import{Q as te}from"./QSpace.96411fb1.js";import{a as i,b as Q}from"./QMenu.30afa9fe.js";import{Q as se}from"./PersonItem.24d38592.js";import{Q as le,_ as oe}from"./PeopleDropdown.75ee3476.js";import{Q as re,a as L}from"./QHeader.0c2b66b3.js";import{b as U,a as ne,Q as ue}from"./QCard.3f3a1dae.js";import{Q as ce,b as ie}from"./QPage.0b79a990.js";import{_ as me,C as R}from"./CurrencyDropdown.b2034660.js";import{_ as de,a as pe}from"./TransactionList.7f9fdd67.js";import"./selection.b797f005.js";import"./focusout.8805421f.js";import"./scroll.b02d0dda.js";import"./QResizeObserver.eb9c6de9.js";import"./utils.ca14db4f.js";import"./QSlideItem.d14ef100.js";import"./use-render-cache.770e5fe8.js";const fe={class:"col-6",style:{"text-overflow":"ellipsis","white-space":"nowrap"}},ge={class:"col-6",style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","padding-left":"8px"}},ve={class:"row justify-center items-center q-pb-md"},Le=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(he){var T,I,B;const t=H(),r=K(),n=ie(),v=c((B=(I=t.userLedger)==null?void 0:I.sheets[(T=t.currentSheet)==null?void 0:T.id])==null?void 0:B.name),u=c(t.user.id),k=_(()=>t.personId2Idx(u.value)),h=c(null),m=c(null),d=c(!1),x=c(null),p=_(()=>Z.getSummary(t.currentSheetResults,k.value)),j=_(()=>new Set(Object.keys(p.value.totals)));b(h,async a=>{if(a==null)return;const s=`\u{1F916} settle ${t.getName(u.value)}`;t.settleCurrencyPerson(a,k.value,s)});const A=async(a,s)=>{try{const o=`Are you sure you want to remove ${ee.name(t.currentSheet.transactions[s])}?`;n.notify({message:o,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>a()},{label:"Confirm",color:"red",handler:async()=>{t.removeTransaction(s),n.notify({message:"Transaction removed successfully!"})}}]})}catch(o){a(),n.notify({message:o.message||o,color:"negative"})}},D=a=>{t.transactionId=a,r.push({name:"TransactionPage"})},E=()=>{t.transactionId=null,r.push({name:"TransactionPage"})},O=async()=>{try{await t.setSheetName(v.value)}catch(a){n.notify({message:a.message||a,color:"negative"})}},z=()=>{r.push({name:"PeoplePage"})},M=()=>{r.push({name:"ConvertPage"})},V=()=>{try{t.clearCurrentSheet(),r.go(-1)}catch(a){n.notify({message:a.message||a,color:"negative"});return}};b(t.currentSheet,async a=>{a===null&&V()},{immediate:!0});const F=async()=>{try{await t.logout(),r.push({name:"LoginPage"})}catch(a){n.notify({message:a.message||a,color:"negative"});return}};b(t.userLedger,async a=>{a===null&&await F()},{immediate:!0});const G=()=>{d.value=!d.value,d.value?ae(()=>{var a;(a=x.value)==null||a.focus()}):m.value=""};return(a,s)=>(f(),Y(J,null,[e(re,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e(L,null,{default:l(()=>[e(w,{flat:"",icon:"arrow_back",onClick:V,"aria-label":"Go Back",class:"bg-white text-primary"}),e(te),e(w,{flat:"",icon:"search",label:"Search",onClick:G,class:"bg-white text-primary q-mr-sm"}),e(le,{flat:"",class:"q-ma-none bg-white text-primary",label:"More",icon:"more_vert","menu-anchor":"bottom right","menu-self":"top right"},{default:l(()=>[e(se,null,{default:l(()=>[S((f(),C(Q,{clickable:"",onClick:z,class:"bg-grey-3"},{default:l(()=>[e(i,{avatar:""},{default:l(()=>[e(N,{name:"people"})]),_:1}),e(i,null,{default:l(()=>s[4]||(s[4]=[q("People")])),_:1})]),_:1})),[[R]]),p.value.ans.length?S((f(),C(Q,{key:0,clickable:"",onClick:M},{default:l(()=>[e(i,{avatar:""},{default:l(()=>[e(N,{name:"currency_exchange"})]),_:1}),e(i,null,{default:l(()=>s[5]||(s[5]=[q("Convert")])),_:1})]),_:1})),[[R]]):$("",!0),e(Q,{class:W(p.value.ans.length?"bg-grey-3":"")},{default:l(()=>[e(i,null,{default:l(()=>[e(me,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=o=>h.value=o),usedCurrencies:j.value,label:"Settle",icon:"payments",clear:"",flat:"",expandable:!1},null,8,["modelValue","usedCurrencies"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),S(e(L,{class:"bg-primary q-pa-sm"},{default:l(()=>[e(U,{ref_key:"searchInput",ref:x,dense:"",outlined:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=o=>m.value=o),placeholder:"Type to search...",clearable:"",class:"col bg-white"},null,8,["modelValue"])]),_:1},512),[[X,d.value]])]),_:1}),e(ce,null,{default:l(()=>{var o;return[e(ne,{class:"q-my-md q-mr-md q-ml-md"},{default:l(()=>[e(ue,{class:"row no-wrap items-center"},{default:l(()=>[P("div",fe,[g(t).currentSheet?(f(),C(oe,{key:0,modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=y=>u.value=y),people:g(t).currentSheet.people,"sorted-people":g(t).currentSheetPeople,style:{width:"100%"}},null,8,["modelValue","people","sorted-people"])):$("",!0)]),P("div",ge,[e(U,{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=y=>v.value=y),onBlur:O,outlined:"",label:"Sheet Name",dense:"",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),e(de,{summaries:p.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),P("div",ve,[e(w,{class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:E})]),e(pe,{transactions:((o=g(t).currentSheet)==null?void 0:o.transactions)||{},selectedPerson:u.value,"search-string":m.value,onRemove:A,onEdit:D},null,8,["transactions","selectedPerson","search-string"])]}),_:1})],64))}});export{Le as default};
