import{_ as R,r as w,a as h,w as k,u as i,$ as P,y as t,x as r,a0 as Q,a1 as j,Z as d,a2 as p,v as g,a3 as v,a5 as A,aC as O,aD as U,C as F,Y as G,a4 as H}from"./index.fb29ecd7.js";import{Q as Y}from"./QSpace.4c350c9e.js";import{Q as Z,a as z,d as J,b as K,f as M,e as W}from"./PersonItem.7c1ea054.js";import{e as X,c as ee,d as ae,Q as x,f as te}from"./QPage.f70bba20.js";import{C as se}from"./ClosePopup.87d69782.js";import{_ as re}from"./PeopleDropdown.f81fc927.js";import{_ as oe,a as ne}from"./TransactionList.d24363e5.js";import{c as le}from"./index.56516dd5.js";import"./focusout.9427c8bd.js";import"./scroll.bdfe1a26.js";import"./QResizeObserver.421852ae.js";import"./QSlideItem.80a299ed.js";const Se=Object.assign({name:"SheetPage"},{__name:"SheetPage",setup(ce){var b,C,S;const a=R(),c=j(),l=ee(),f=w((S=(C=a.userLedger)==null?void 0:C.sheets[(b=a.currentSheet)==null?void 0:b.id])==null?void 0:S.name),u=w(a.user.id),y=h(()=>a.personId2Idx(u.value)),m=h(()=>O.getSummary(a.currentSheetResults,y.value)),T=le.data.map(e=>({label:`${e.code} - ${e.currency}`,value:e.code})),$=h(()=>T.filter(e=>Object.keys(m.value.totals).includes(e.value))),q=async e=>{let o=`\u{1F916} settle ${a.getName(u.value)}`;const n=a.makeEquivalentTransactionBatch(e,y.value,o);try{await a.addTransactions(n)}catch(s){l.notify({message:s.message||s,color:"negative"});return}},B=async(e,o)=>{try{const n=`Are you sure you want to remove ${U.name(a.currentSheet.transactions[o])}?`;l.notify({message:n,timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>e()},{label:"Confirm",color:"red",handler:async()=>{a.removeTransaction(o),l.notify({message:"Transaction removed successfully!"})}}]})}catch(n){l.notify({message:n.message||n,color:"negative"})}},V=e=>{a.transactionId=e,c.push({name:"TransactionPage"})},I=()=>{a.transactionId=null,c.push({name:"TransactionPage"})},N=async()=>{try{await a.setSheetName(f.value)}catch(e){l.notify({message:e.message||e,color:"negative"})}},E=()=>{c.push({name:"PeoplePage"})},L=()=>{c.push({name:"ConvertPage"})},_=()=>{try{a.clearCurrentSheet(),c.go(-1)}catch(e){l.notify({message:e.message||e,color:"negative"});return}};k(a.currentSheet,async e=>{e===null&&_()},{immediate:!0});const D=async()=>{try{await a.logout(),c.push({name:"LoginPage"})}catch(e){l.notify({message:e.message||e,color:"negative"});return}};return k(a.userLedger,async e=>{e===null&&await D()},{immediate:!0}),(e,o)=>(i(),P(Q,null,[t(Z,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[t(z,null,{default:r(()=>[t(d,{flat:"",icon:"arrow_back",onClick:_,"aria-label":"Go Back",class:"bg-white text-primary"}),t(Y),t(d,{flat:"",icon:"people",onClick:E,label:"People",class:"q-ml-md bg-white text-primary","aria-label":"Edit people"})]),_:1})]),_:1}),t(X,null,{default:r(()=>{var n;return[t(ae,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[t(x,{class:"row q-gutter-sm"},{default:r(()=>[p(a).currentSheet?(i(),g(re,{key:0,class:"col-auto",modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),people:p(a).currentSheet.people,"sorted-people":p(a).currentSheetPeople},null,8,["modelValue","people","sorted-people"])):v("",!0),t(te,{class:"col",modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=s=>f.value=s),onBlur:N,outlined:"",label:"Sheet Name"},null,8,["modelValue"])]),_:1})]),_:1}),t(oe,{summaries:m.value,selectedPerson:u.value},null,8,["summaries","selectedPerson"]),t(x,{class:"row justify-center items-center"},{default:r(()=>[m.value.ans.length?(i(),g(K,{key:0,label:"Settle",icon:"payments",flat:"",class:"q-mr-md bg-green text-white"},{default:r(()=>[t(J,null,{default:r(()=>[(i(!0),P(Q,null,A($.value,s=>F((i(),g(M,{key:s.value,clickable:"",onClick:ue=>q(s.value)},{default:r(()=>[t(W,null,{default:r(()=>[G(H(s.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])),128))]),_:1})]),_:1})):v("",!0),m.value.ans.length?(i(),g(d,{key:1,flat:"",class:"q-mr-md bg-purple text-white",icon:"currency_exchange",label:"Convert",onClick:L})):v("",!0),t(d,{flat:"",class:"bg-primary text-white",icon:"note_add",label:"Add Entry",onClick:I})]),_:1}),t(ne,{transactions:((n=p(a).currentSheet)==null?void 0:n.transactions)||{},selectedPerson:u.value,onRemove:B,onEdit:V},null,8,["transactions","selectedPerson"])]}),_:1})],64))}});export{Se as default};
