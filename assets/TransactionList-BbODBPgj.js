import{Q as U,a as le}from"./QCard-CaOUDWmZ.js";import{L as re,a as T,N as I,x as c,v as w,O as N,P as r,y as m,I as L,J as p,S as P,T as E,U as z,z as h,c as oe,r as $,w as A,G as ce,F as ue,k as ie,j as de,o as fe,g as me,$ as ve,h as W,d as ye,a0 as Z,Z as K,a1 as ge,_ as k,V as X,a2 as he,a3 as j,Q as be}from"./index-CCxTOJyV.js";import{_}from"./CurrencyDisplay-BIdLjEXx.js";import{b as ee,c as te,d as O}from"./QItemLabel-IxHZINt8.js";import{Q as Ie}from"./QSlideItem-R8m3rChH.js";import{s as xe,d as R,a as G,e as J,g as Ce}from"./scroll-CKykQgin.js";const Se={class:"q-pa-md"},ke={key:0},Pe={key:0},qe={key:1},Ne={key:0},Le={class:"q-pa-md"},Ee={__name:"SummaryCard",props:{summary:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(n){const o=re(),s=n,d=T(()=>o.personId2Idx(s.selectedPerson)),u=T(()=>s.summary?Object.entries(s.summary).flatMap(([t,e])=>{const x=e.transactions;return Array.isArray(x)?x.map((g,M)=>({id:`${t}-${M}`,currency:t,amount:g.amount,creditorIdx:g.creditorIdx,debtorIdx:g.debtorIdx})):[]}):[]),y=T(()=>Object.entries(s.summary).filter(([f,t])=>t.total>0).map(([f,t])=>[f,t.total])),q=T(()=>Object.entries(s.summary).filter(([f,t])=>t.total<0).map(([f,t])=>[f,t.total]));return(f,t)=>(c(),I("div",null,[(y.value.length||q.value.length)&&r(o).currentSheetPeople.length>2?(c(),w(U,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[L("div",Se,[q.value.length?(c(),I("div",ke,[p(P(r(o).getName(s.selectedPerson))+" owes ",1),(c(!0),I(E,null,z(q.value,([e,x],g)=>(c(),I(E,{key:e},[h(_,{currency:e,amount:-x,color:"red","converted-amount":r(o).convertCurrency(-x,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<q.value.length-1?(c(),I("span",Pe," + ")):N("",!0)],64))),128))])):N("",!0),y.value.length?(c(),I("div",qe,[p(P(r(o).getName(s.selectedPerson))+" is owed ",1),(c(!0),I(E,null,z(y.value,([e,x],g)=>(c(),I(E,{key:e},[h(_,{currency:e,amount:x,color:"green","converted-amount":r(o).convertCurrency(x,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<y.value.length-1?(c(),I("span",Ne," + ")):N("",!0)],64))),128))])):N("",!0)])]),_:1})):N("",!0),!s.summary||Object.keys(s.summary).length===0?(c(),w(U,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[...t[0]||(t[0]=[L("div",{class:"q-pa-md"},[L("div",null,"All Settled!")],-1)])]),_:1})):N("",!0),u.value.length?(c(),w(U,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[L("div",Le,[(c(!0),I(E,null,z(u.value,e=>(c(),I("div",{key:e.id},[L("span",null,P(r(o).getName(r(o).personIdx2Id(e.debtorIdx))),1),t[1]||(t[1]=L("span",null," owes ",-1)),L("span",null,P(r(o).getName(r(o).personIdx2Id(e.creditorIdx)))+" Â  ",1),h(_,{currency:e.currency,amount:e.amount,color:e.creditorIdx===d.value?"green":"red","converted-amount":r(o).convertCurrency(Math.abs(e.amount),e.currency,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","color","converted-amount","reference-currency"])]))),128))])]),_:1})):N("",!0)]))}},{passive:B}=de,Te=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:xe,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(n,{slots:o,emit:s}){const d=$(!1),u=$(!0),y=$(null),q=$(null);let f=n.initialIndex,t,e;const x=T(()=>"q-infinite-scroll__loading"+(d.value===!0?"":" invisible"));function g(){if(n.disable===!0||d.value===!0||u.value===!1)return;const l=R(t),S=G(t),Q=Z(t);n.reverse===!1?Math.round(S+Q+n.offset)>=Math.round(l)&&M():Math.round(S)<=n.offset&&M()}function M(){if(n.disable===!0||d.value===!0||u.value===!1)return;f++,d.value=!0;const l=R(t);s("load",f,S=>{u.value===!0&&(d.value=!1,K(()=>{if(n.reverse===!0){const Q=R(t),ae=G(t),se=Q-l;J(t,ae+se)}S===!0?D():y.value&&y.value.closest("body")&&e()}))})}function F(){f=0}function H(){u.value===!1&&(u.value=!0,t.addEventListener("scroll",e,B)),g()}function D(){var l;u.value===!0&&(u.value=!1,d.value=!1,t.removeEventListener("scroll",e,B),(l=e==null?void 0:e.cancel)==null||l.call(e))}function v(){if(t&&u.value===!0&&t.removeEventListener("scroll",e,B),t=Ce(y.value,n.scrollTarget),u.value===!0){if(t.addEventListener("scroll",e,B),n.reverse===!0){const l=R(t),S=Z(t);J(t,l-S)}g()}}function i(l){f=l}function a(l){l=parseInt(l,10);const S=e;e=l<=0?g:ge(g,isNaN(l)===!0?100:l),t&&u.value===!0&&(S!==void 0&&t.removeEventListener("scroll",S,B),t.addEventListener("scroll",e,B))}function C(l){if(b.value===!0){if(q.value===null){l!==!0&&K(()=>{C(!0)});return}const S=`${d.value===!0?"un":""}pauseAnimations`;Array.from(q.value.getElementsByTagName("svg")).forEach(Q=>{Q[S]()})}}const b=T(()=>n.disable!==!0&&u.value===!0);A([d,b],()=>{C()}),A(()=>n.disable,l=>{l===!0?D():H()}),A(()=>n.reverse,()=>{d.value===!1&&u.value===!0&&g()}),A(()=>n.scrollTarget,v),A(()=>n.debounce,a);let V=!1;ce(()=>{V!==!1&&t&&J(t,V)}),ue(()=>{V=t?G(t):!1}),ie(()=>{u.value===!0&&t.removeEventListener("scroll",e,B)}),fe(()=>{a(n.debounce),v(),d.value===!1&&C()});const Y=me();return Object.assign(Y.proxy,{poll:()=>{e==null||e()},trigger:M,stop:D,reset:F,resume:H,setIndex:i,updateScrollTarget:v}),()=>{const l=ve(o.default,[]);return b.value===!0&&l[n.reverse===!1?"push":"unshift"](W("div",{ref:q,class:x.value},ye(o.loading))),W("div",{class:"q-infinite-scroll",ref:y},l)}}}),ne=20,$e={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(n,{emit:o}){const s=re(),d=n,u=$([]),y=$(0),q=$(0),f=T(()=>{const v=(d.searchString||"").toLowerCase(),i=!isNaN(parseFloat(v));return k.getTransactionList(d.transactions).filter(C=>{const b=d.transactions[C];return i?k.searchString(b).includes(v):b.name.toLowerCase().includes(v)})}),t=v=>{const i=q.value+v;if(i<0||i>=f.value.length)return"";const a=f.value[i],C=d.transactions[a].timestamp;let b;if(i===0)b=Date.now();else{const Q=f.value[i-1];b=d.transactions[Q].timestamp}const V=j.getYear(b),Y=j.getMonth(b),l=j.getYear(C),S=j.getMonth(C);return V===l&&Y===S?"":j.getMonth(C,!1)+" "+l},e=T(()=>s.personId2Idx(d.selectedPerson)),x=o,g=v=>{x("edit",v)},M=({reset:v},i)=>{x("remove",()=>v(),i)},F=(v,i)=>{const a=f.value.slice(y.value,y.value+ne);u.value.length===0&&(q.value=y.value),u.value.push(...a),y.value+=ne,i()},H=T(()=>y.value>=f.value.length);A(f,()=>{u.value=[],y.value=0,F(0,()=>{})});const D=v=>{const i=k.payerIdxs(v,s.currentSheetPeople.length);return i.length===0?"":i.length===1?`${s.getName(s.personIdx2Id(i[0]))} paid`:`${s.getName(s.personIdx2Id(i[0]))} + ${i.length-1} paid`};return(v,i)=>(c(),I("div",null,[h(Te,{onLoad:F,offset:300,disable:H.value},{default:m(()=>[(c(!0),I(E,null,z(u.value,(a,C)=>(c(),I(E,{key:a},[t(C)?(c(),w(ee,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:m(()=>[p(P(t(C)),1)]),_:2},1024)):N("",!0),h(Ie,{clickable:"",class:X(C%2===0?"bg-grey-3":"bg-white"),onClick:b=>g(a),onLeft:b=>M(b,a),"left-color":"red","read-only":""},he({default:m(()=>[h(ee,null,{default:m(()=>[h(U,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:m(()=>[h(le,{class:"column q-pa-none flex justify-center items-center"},{default:m(()=>[L("div",null,P(r(j).getMonth(n.transactions[a].timestamp)),1),L("div",null,P(r(j).getDay(n.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),h(te,null,{default:m(()=>[h(O,{class:X({"text-grey":r(s).pendingTransactionIds.has(a)})},{default:m(()=>[p(P(n.transactions[a].name||"New Transaction"),1)]),_:2},1032,["class"]),h(O,{caption:""},{default:m(()=>[p(P(D(n.transactions[a]))+" ",1),h(_,{currency:n.transactions[a].currency,amount:r(k).credit(n.transactions[a]),"reference-currency":r(s).referenceCurrency,"converted-amount":r(s).convertCurrency(r(k).credit(n.transactions[a]),n.transactions[a].currency,r(s).referenceCurrency),"inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])]),_:2},1024)]),_:2},1024),h(te,{side:""},{default:m(()=>[r(k).position(n.transactions[a],e.value)>0?(c(),w(O,{key:0,caption:"",style:{color:"green"}},{default:m(()=>[p(P(r(s).getName(n.selectedPerson))+" lent ",1)]),_:1})):N("",!0),r(k).position(n.transactions[a],e.value)<0?(c(),w(O,{key:1,caption:"",style:{color:"red"}},{default:m(()=>[p(P(r(s).getName(n.selectedPerson))+" borrowed ",1)]),_:1})):N("",!0),r(k).position(n.transactions[a],e.value)===0?(c(),w(O,{key:2},{default:m(()=>[p(P(e.value!==r(k).payerIdx(n.transactions[a])?"Not Involved":"Personal"),1)]),_:2},1024)):(c(),w(O,{key:3},{default:m(()=>[h(_,{currency:n.transactions[a].currency,amount:Math.abs(r(k).position(n.transactions[a],e.value)),color:r(k).position(n.transactions[a],e.value)>=0?"green":"red","reference-currency":r(s).referenceCurrency,"converted-amount":r(s).convertCurrency(Math.abs(r(k).position(n.transactions[a],e.value)),n.transactions[a].currency,r(s).referenceCurrency)},null,8,["currency","amount","color","reference-currency","converted-amount"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[n.disableRemove?void 0:{name:"left",fn:m(()=>[h(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Ee as _,$e as a};
