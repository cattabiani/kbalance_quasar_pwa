import{Q as z,a as le}from"./QCard-CJVgVv7j.js";import{L as ae,a as p,N as x,x as c,v as M,O as L,P as r,y as m,I as T,J as w,S as P,T as E,U as Y,z as h,c as oe,r as $,w as D,G as ce,F as ue,k as ie,j as de,o as fe,g as me,$ as ve,h as Z,d as ye,a0 as K,Z as X,a1 as ge,_ as k,V as ee,a2 as he,a3 as j,Q as be}from"./index-C-3qNLdi.js";import{_}from"./CurrencyDisplay-DQ97cAYl.js";import{b as te,c as ne,d as A}from"./QItemLabel-Rb0KRFLf.js";import{Q as Ie}from"./QSlideItem-DRnR0kKO.js";import{s as xe,d as U,a as J,e as W,g as Ce}from"./scroll-BCWtTLsJ.js";const Se={class:"q-pa-md"},ke={key:0},Pe={key:0},qe={key:1},Ne={key:0},Le={class:"q-pa-md"},Ee={__name:"SummaryCard",props:{summary:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(n){const o=ae(),l=n,d=p(()=>o.personId2Idx(l.selectedPerson)),u=p(()=>l.summary?Object.entries(l.summary).flatMap(([t,e])=>{const C=e.transactions;return Array.isArray(C)?C.map((g,Q)=>({id:`${t}-${Q}`,currency:t,amount:g.amount,creditorIdx:g.creditorIdx,debtorIdx:g.debtorIdx})):[]}):[]),y=p(()=>Object.entries(l.summary).filter(([f,t])=>t.total>0).map(([f,t])=>[f,t.total])),q=p(()=>Object.entries(l.summary).filter(([f,t])=>t.total<0).map(([f,t])=>[f,t.total]));return(f,t)=>(c(),x("div",null,[(y.value.length||q.value.length)&&r(o).currentSheetPeople.length>2?(c(),M(z,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[T("div",Se,[q.value.length?(c(),x("div",ke,[w(P(r(o).getName(l.selectedPerson))+" owes ",1),(c(!0),x(E,null,Y(q.value,([e,C],g)=>(c(),x(E,{key:e},[h(_,{currency:e,amount:-C,color:"red","converted-amount":r(o).convertCurrency(-C,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<q.value.length-1?(c(),x("span",Pe," + ")):L("",!0)],64))),128))])):L("",!0),y.value.length?(c(),x("div",qe,[w(P(r(o).getName(l.selectedPerson))+" is owed ",1),(c(!0),x(E,null,Y(y.value,([e,C],g)=>(c(),x(E,{key:e},[h(_,{currency:e,amount:C,color:"green","converted-amount":r(o).convertCurrency(C,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<y.value.length-1?(c(),x("span",Ne," + ")):L("",!0)],64))),128))])):L("",!0)])]),_:1})):L("",!0),!l.summary||Object.keys(l.summary).length===0?(c(),M(z,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[...t[0]||(t[0]=[T("div",{class:"q-pa-md"},[T("div",null,"All Settled!")],-1)])]),_:1})):L("",!0),u.value.length?(c(),M(z,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[T("div",Le,[(c(!0),x(E,null,Y(u.value,e=>(c(),x("div",{key:e.id},[T("span",null,P(r(o).getName(r(o).personIdx2Id(e.debtorIdx))),1),t[1]||(t[1]=T("span",null," owes ",-1)),T("span",null,P(r(o).getName(r(o).personIdx2Id(e.creditorIdx)))+" Â  ",1),h(_,{currency:e.currency,amount:e.amount,color:e.creditorIdx===d.value?"green":"red","converted-amount":r(o).convertCurrency(Math.abs(e.amount),e.currency,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","color","converted-amount","reference-currency"])]))),128))])]),_:1})):L("",!0)]))}},{passive:B}=de,Te=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:xe,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(n,{slots:o,emit:l}){const d=$(!1),u=$(!0),y=$(null),q=$(null);let f=n.initialIndex,t,e;const C=p(()=>"q-infinite-scroll__loading"+(d.value===!0?"":" invisible"));function g(){if(n.disable===!0||d.value===!0||u.value===!1)return;const s=U(t),I=J(t),N=K(t);n.reverse===!1?Math.round(I+N+n.offset)>=Math.round(s)&&Q():Math.round(I)<=n.offset&&Q()}function Q(){if(n.disable===!0||d.value===!0||u.value===!1)return;f++,d.value=!0;const s=U(t);l("load",f,I=>{u.value===!0&&(d.value=!1,X(()=>{if(n.reverse===!0){const N=U(t),G=J(t),se=N-s;W(t,G+se)}I===!0?V():y.value&&y.value.closest("body")&&e()}))})}function F(){f=0}function H(){u.value===!1&&(u.value=!0,t.addEventListener("scroll",e,B)),g()}function V(){var s;u.value===!0&&(u.value=!1,d.value=!1,t.removeEventListener("scroll",e,B),(s=e==null?void 0:e.cancel)==null||s.call(e))}function v(){if(t&&u.value===!0&&t.removeEventListener("scroll",e,B),t=Ce(y.value,n.scrollTarget),u.value===!0){if(t.addEventListener("scroll",e,B),n.reverse===!0){const s=U(t),I=K(t);W(t,s-I)}g()}}function i(s){f=s}function a(s){s=parseInt(s,10);const I=e;e=s<=0?g:ge(g,isNaN(s)===!0?100:s),t&&u.value===!0&&(I!==void 0&&t.removeEventListener("scroll",I,B),t.addEventListener("scroll",e,B))}function S(s){if(b.value===!0){if(q.value===null){s!==!0&&X(()=>{S(!0)});return}const I=`${d.value===!0?"un":""}pauseAnimations`;Array.from(q.value.getElementsByTagName("svg")).forEach(N=>{N[I]()})}}const b=p(()=>n.disable!==!0&&u.value===!0);D([d,b],()=>{S()}),D(()=>n.disable,s=>{s===!0?V():H()}),D(()=>n.reverse,()=>{d.value===!1&&u.value===!0&&g()}),D(()=>n.scrollTarget,v),D(()=>n.debounce,a);let O=!1;ce(()=>{O!==!1&&t&&W(t,O)}),ue(()=>{O=t?J(t):!1}),ie(()=>{u.value===!0&&t.removeEventListener("scroll",e,B)}),fe(()=>{a(n.debounce),v(),d.value===!1&&S()});const R=me();return Object.assign(R.proxy,{poll:()=>{e==null||e()},trigger:Q,stop:V,reset:F,resume:H,setIndex:i,updateScrollTarget:v}),()=>{const s=ve(o.default,[]);return b.value===!0&&s[n.reverse===!1?"push":"unshift"](Z("div",{ref:q,class:C.value},ye(o.loading))),Z("div",{class:"q-infinite-scroll",ref:y},s)}}}),re=20,$e={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(n,{emit:o}){const l=ae(),d=n,u=$([]),y=$(0),q=$(0),f=p(()=>{const v=(d.searchString||"").toLowerCase(),i=!isNaN(parseFloat(v));return k.getTransactionList(d.transactions).filter(S=>{const b=d.transactions[S];return i?k.searchString(b).includes(v):b.name.toLowerCase().includes(v)})}),t=v=>{const i=q.value+v;if(i<0||i>=f.value.length)return"";const a=f.value[i],S=d.transactions[a].timestamp;let b;if(i===0)b=Date.now();else{const G=f.value[i-1];b=d.transactions[G].timestamp}const O=j.getYear(b),R=j.getMonth(b),s=j.getYear(S),I=j.getMonth(S);if(O===s&&R===I)return"";let N="";return R!==I&&(N+=j.getMonth(S,!1)),O!==s&&(N&&(N+=" "),N+=s),N},e=p(()=>l.personId2Idx(d.selectedPerson)),C=o,g=v=>{C("edit",v)},Q=({reset:v},i)=>{C("remove",()=>v(),i)},F=(v,i)=>{const a=f.value.slice(y.value,y.value+re);u.value.length===0&&(q.value=y.value),u.value.push(...a),y.value+=re,i()},H=p(()=>y.value>=f.value.length);D(f,()=>{u.value=[],y.value=0,F(0,()=>{})});const V=v=>{const i=k.payerIdxs(v);return i.length===0?"":i.length===1?`${l.getName(l.personIdx2Id(i[0]))} paid`:`${l.getName(l.personIdx2Id(i[0]))} + ${i.length-1} paid`};return(v,i)=>(c(),x("div",null,[h(Te,{onLoad:F,offset:300,disable:H.value},{default:m(()=>[(c(!0),x(E,null,Y(u.value,(a,S)=>(c(),x(E,{key:a},[t(S)?(c(),M(te,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:m(()=>[w(P(t(S)),1)]),_:2},1024)):L("",!0),h(Ie,{clickable:"",class:ee(S%2===0?"bg-grey-3":"bg-white"),onClick:b=>g(a),onLeft:b=>Q(b,a),"left-color":"red","read-only":""},he({default:m(()=>[h(te,null,{default:m(()=>[h(z,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:m(()=>[h(le,{class:"column q-pa-none flex justify-center items-center"},{default:m(()=>[T("div",null,P(r(j).getMonth(n.transactions[a].timestamp)),1),T("div",null,P(r(j).getDay(n.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),h(ne,null,{default:m(()=>[h(A,{class:ee({"text-grey":r(l).pendingTransactionIds.has(a)})},{default:m(()=>[w(P(n.transactions[a].name||"New Transaction"),1)]),_:2},1032,["class"]),h(A,{caption:""},{default:m(()=>[w(P(V(n.transactions[a]))+" ",1),h(_,{currency:n.transactions[a].currency,amount:r(k).credit(n.transactions[a]),"reference-currency":r(l).referenceCurrency,"converted-amount":r(l).convertCurrency(r(k).credit(n.transactions[a]),n.transactions[a].currency,r(l).referenceCurrency),"inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])]),_:2},1024)]),_:2},1024),h(ne,{side:""},{default:m(()=>[r(k).position(n.transactions[a],e.value)>0?(c(),M(A,{key:0,caption:"",style:{color:"green"}},{default:m(()=>[w(P(r(l).getName(n.selectedPerson))+" lent ",1)]),_:1})):L("",!0),r(k).position(n.transactions[a],e.value)<0?(c(),M(A,{key:1,caption:"",style:{color:"red"}},{default:m(()=>[w(P(r(l).getName(n.selectedPerson))+" borrowed ",1)]),_:1})):L("",!0),r(k).position(n.transactions[a],e.value)===0?(c(),M(A,{key:2},{default:m(()=>[w(P(e.value!==r(k).payerIdx(n.transactions[a])?"Not Involved":"Personal"),1)]),_:2},1024)):(c(),M(A,{key:3},{default:m(()=>[h(_,{currency:n.transactions[a].currency,amount:Math.abs(r(k).position(n.transactions[a],e.value)),color:r(k).position(n.transactions[a],e.value)>=0?"green":"red","reference-currency":r(l).referenceCurrency,"converted-amount":r(l).convertCurrency(Math.abs(r(k).position(n.transactions[a],e.value)),n.transactions[a].currency,r(l).referenceCurrency)},null,8,["currency","amount","color","reference-currency","converted-amount"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[n.disableRemove?void 0:{name:"left",fn:m(()=>[h(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Ee as _,$e as a};
