import{Q as U,a as le}from"./QCard-VNZekkGP.js";import{K as re,a as L,M as b,v as c,u as M,N,O as r,x as m,H as T,I as p,P,S as E,T as Y,y as h,c as oe,f as ce,r as j,w as O,F as ue,E as ie,j as de,o as fe,g as me,_ as ve,h as Z,b as ye,$ as G,Y as J,a0 as ge,Z as k,U as X,a1 as he,a2 as B,Q as be}from"./index-DmmOCoWn.js";import{_ as V}from"./CurrencyDisplay-c1adv5r8.js";import{b as ee,c as te,d as $}from"./QItemLabel-DVEbkyKJ.js";import{Q as Ie}from"./QSlideItem-B1j_Ac3p.js";import{s as xe,d as R,a as K,e as W,g as Ce}from"./scroll-LRJG3Fw4.js";const Se={class:"q-pa-md"},ke={key:0},Pe={key:0},qe={key:1},Ne={key:0},Te={class:"q-pa-md"},Be={__name:"SummaryCard",props:{summary:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(n){const o=re(),s=n,d=L(()=>o.personId2Idx(s.selectedPerson)),u=L(()=>s.summary?Object.entries(s.summary).flatMap(([t,e])=>{const I=e.transactions;return Array.isArray(I)?I.map((g,w)=>({id:`${t}-${w}`,currency:t,amount:g.amount,creditorIdx:g.creditorIdx,debtorIdx:g.debtorIdx})):[]}):[]),y=L(()=>Object.entries(s.summary).filter(([f,t])=>t.total>0).map(([f,t])=>[f,t.total])),q=L(()=>Object.entries(s.summary).filter(([f,t])=>t.total<0).map(([f,t])=>[f,t.total]));return(f,t)=>(c(),b("div",null,[(y.value.length||q.value.length)&&r(o).currentSheetPeople.length>2?(c(),M(U,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[T("div",Se,[q.value.length?(c(),b("div",ke,[p(P(r(o).getName(s.selectedPerson))+" owes ",1),(c(!0),b(E,null,Y(q.value,([e,I],g)=>(c(),b(E,{key:e},[h(V,{currency:e,amount:-I,color:"red","converted-amount":r(o).convertCurrency(-I,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<q.value.length-1?(c(),b("span",Pe," + ")):N("",!0)],64))),128))])):N("",!0),y.value.length?(c(),b("div",qe,[p(P(r(o).getName(s.selectedPerson))+" is owed ",1),(c(!0),b(E,null,Y(y.value,([e,I],g)=>(c(),b(E,{key:e},[h(V,{currency:e,amount:I,color:"green","converted-amount":r(o).convertCurrency(I,e,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),g<y.value.length-1?(c(),b("span",Ne," + ")):N("",!0)],64))),128))])):N("",!0)])]),_:1})):N("",!0),!s.summary||Object.keys(s.summary).length===0?(c(),M(U,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[...t[0]||(t[0]=[T("div",{class:"q-pa-md"},[T("div",null,"All Settled!")],-1)])]),_:1})):N("",!0),u.value.length?(c(),M(U,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:m(()=>[T("div",Te,[(c(!0),b(E,null,Y(u.value,e=>(c(),b("div",{key:e.id},[T("span",null,P(r(o).getName(r(o).personIdx2Id(e.debtorIdx))),1),t[1]||(t[1]=T("span",null," owes ",-1)),T("span",null,P(r(o).getName(r(o).personIdx2Id(e.creditorIdx)))+" Â  ",1),h(V,{currency:e.currency,amount:e.amount,color:e.creditorIdx===d.value?"green":"red","converted-amount":r(o).convertCurrency(Math.abs(e.amount),e.currency,r(o).referenceCurrency),"reference-currency":r(o).referenceCurrency},null,8,["currency","amount","color","converted-amount","reference-currency"])]))),128))])]),_:1})):N("",!0)]))}},{passive:Q}=ce,Le=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:xe,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(n,{slots:o,emit:s}){const d=j(!1),u=j(!0),y=j(null),q=j(null);let f=n.initialIndex,t,e;const I=L(()=>"q-infinite-scroll__loading"+(d.value===!0?"":" invisible"));function g(){if(n.disable===!0||d.value===!0||u.value===!1)return;const l=R(t),S=K(t),H=G(t);n.reverse===!1?Math.round(S+H+n.offset)>=Math.round(l)&&w():Math.round(S)<=n.offset&&w()}function w(){if(n.disable===!0||d.value===!0||u.value===!1)return;f++,d.value=!0;const l=R(t);s("load",f,S=>{u.value===!0&&(d.value=!1,J(()=>{if(n.reverse===!0){const H=R(t),ae=K(t),se=H-l;W(t,ae+se)}S===!0?A():y.value&&y.value.closest("body")&&e()}))})}function _(){f=0}function F(){u.value===!1&&(u.value=!0,t.addEventListener("scroll",e,Q)),g()}function A(){var l;u.value===!0&&(u.value=!1,d.value=!1,t.removeEventListener("scroll",e,Q),(l=e==null?void 0:e.cancel)==null||l.call(e))}function v(){if(t&&u.value===!0&&t.removeEventListener("scroll",e,Q),t=Ce(y.value,n.scrollTarget),u.value===!0){if(t.addEventListener("scroll",e,Q),n.reverse===!0){const l=R(t),S=G(t);W(t,l-S)}g()}}function i(l){f=l}function a(l){l=parseInt(l,10);const S=e;e=l<=0?g:ge(g,isNaN(l)===!0?100:l),t&&u.value===!0&&(S!==void 0&&t.removeEventListener("scroll",S,Q),t.addEventListener("scroll",e,Q))}function x(l){if(C.value===!0){if(q.value===null){l!==!0&&J(()=>{x(!0)});return}const S=`${d.value===!0?"un":""}pauseAnimations`;Array.from(q.value.getElementsByTagName("svg")).forEach(H=>{H[S]()})}}const C=L(()=>n.disable!==!0&&u.value===!0);O([d,C],()=>{x()}),O(()=>n.disable,l=>{l===!0?A():F()}),O(()=>n.reverse,()=>{d.value===!1&&u.value===!0&&g()}),O(()=>n.scrollTarget,v),O(()=>n.debounce,a);let D=!1;ue(()=>{D!==!1&&t&&W(t,D)}),ie(()=>{D=t?K(t):!1}),de(()=>{u.value===!0&&t.removeEventListener("scroll",e,Q)}),fe(()=>{a(n.debounce),v(),d.value===!1&&x()});const z=me();return Object.assign(z.proxy,{poll:()=>{e==null||e()},trigger:w,stop:A,reset:_,resume:F,setIndex:i,updateScrollTarget:v}),()=>{const l=ve(o.default,[]);return C.value===!0&&l[n.reverse===!1?"push":"unshift"](Z("div",{ref:q,class:I.value},ye(o.loading))),Z("div",{class:"q-infinite-scroll",ref:y},l)}}}),ne=20,$e={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(n,{emit:o}){const s=re(),d=n,u=j([]),y=j(0),q=j(0),f=L(()=>{const v=(d.searchString||"").toLowerCase(),i=!isNaN(parseFloat(v));return k.getTransactionList(d.transactions).filter(x=>{const C=d.transactions[x];return i?k.searchString(C).includes(v):C.name.toLowerCase().includes(v)})}),t=v=>{const i=q.value+v;if(i<0||i>=f.value.length)return"";const a=f.value[i],x=d.transactions[a].timestamp;let C;if(i===0)C=Date.now();else{const S=f.value[i-1];C=d.transactions[S].timestamp}const D=B.getMonth(C),z=B.getMonth(x);if(D===z)return"";const l=B.getYear(x);return B.getMonth(x,!1)+" "+l},e=L(()=>s.personId2Idx(d.selectedPerson)),I=o,g=v=>{I("edit",v)},w=({reset:v},i)=>{I("remove",()=>v(),i)},_=(v,i)=>{const a=f.value.slice(y.value,y.value+ne);u.value.length===0&&(q.value=y.value),u.value.push(...a),y.value+=ne,i()},F=L(()=>y.value>=f.value.length);O(f,()=>{u.value=[],y.value=0,_(0,()=>{})});const A=v=>{const i=k.payerIdxs(v);return i.length===0?"":i.length===1?`${s.getName(s.personIdx2Id(i[0]))} paid`:`${s.getName(s.personIdx2Id(i[0]))} + ${i.length-1} paid`};return(v,i)=>(c(),b("div",null,[h(Le,{onLoad:_,offset:300,disable:F.value},{default:m(()=>[(c(!0),b(E,null,Y(u.value,(a,x)=>(c(),b(E,{key:a},[t(x)?(c(),M(ee,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:m(()=>[p(P(t(x)),1)]),_:2},1024)):N("",!0),h(Ie,{clickable:"",class:X(x%2===0?"bg-grey-3":"bg-white"),onClick:C=>g(a),onLeft:C=>w(C,a),"left-color":"red","read-only":""},he({default:m(()=>[h(ee,null,{default:m(()=>[h(U,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:m(()=>[h(le,{class:"column q-pa-none flex justify-center items-center"},{default:m(()=>[T("div",null,P(r(B).getMonth(n.transactions[a].timestamp)),1),T("div",null,P(r(B).getDay(n.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),h(te,null,{default:m(()=>[h($,{class:X({"text-grey":r(s).pendingTransactionIds.has(a)})},{default:m(()=>[p(P(n.transactions[a].name||"New Transaction"),1)]),_:2},1032,["class"]),h($,{caption:""},{default:m(()=>[p(P(A(n.transactions[a]))+" ",1),h(V,{currency:n.transactions[a].currency,amount:r(k).credit(n.transactions[a]),"reference-currency":r(s).referenceCurrency,"converted-amount":r(s).convertCurrency(r(k).credit(n.transactions[a]),n.transactions[a].currency,r(s).referenceCurrency),"inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])]),_:2},1024)]),_:2},1024),h(te,{side:""},{default:m(()=>[r(k).position(n.transactions[a],e.value)>0?(c(),M($,{key:0,caption:"",style:{color:"green"}},{default:m(()=>[p(P(r(s).getName(n.selectedPerson))+" lent ",1)]),_:1})):N("",!0),r(k).position(n.transactions[a],e.value)<0?(c(),M($,{key:1,caption:"",style:{color:"red"}},{default:m(()=>[p(P(r(s).getName(n.selectedPerson))+" borrowed ",1)]),_:1})):N("",!0),r(k).position(n.transactions[a],e.value)===0?(c(),M($,{key:2},{default:m(()=>[p(P(e.value!==r(k).payerIdx(n.transactions[a])?"Not Involved":"Personal"),1)]),_:2},1024)):(c(),M($,{key:3},{default:m(()=>[h(V,{currency:n.transactions[a].currency,amount:Math.abs(r(k).position(n.transactions[a],e.value)),color:r(k).position(n.transactions[a],e.value)>=0?"green":"red","reference-currency":r(s).referenceCurrency,"converted-amount":r(s).convertCurrency(Math.abs(r(k).position(n.transactions[a],e.value)),n.transactions[a].currency,r(s).referenceCurrency)},null,8,["currency","amount","color","reference-currency","converted-amount"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[n.disableRemove?void 0:{name:"left",fn:m(()=>[h(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Be as _,$e as a};
