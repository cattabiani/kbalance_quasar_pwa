import{Q as z,a as le}from"./QCard-DiGAP1jW.js";import{K as re,a as M,M as C,v as u,u as L,N,O as n,x as d,H as x,I as T,P,S as j,T as K,y as h,c as oe,f as ce,r as D,w as V,F as ue,E as ie,j as de,o as fe,g as ve,_ as me,h as G,b as ge,$ as J,Y as X,a0 as ye,Z as q,U as _,a1 as he,Q as be}from"./index-OHqjMywm.js";import{_ as $}from"./CurrencyDisplay-BO9caMBd.js";import{b as ee,c as te,d as H}from"./QItemLabel-CiWFurim.js";import{Q as Ce}from"./QSlideItem-C91gR_z2.js";import{s as Se,d as p,a as W,e as Z,g as Pe}from"./scroll-GtoaD4Ow.js";import{U as E}from"./utils-bRICbQdu.js";const ke={class:"q-pa-md"},Ie={key:0},qe={key:0},xe={key:1},Ne={key:0},Te={class:"q-pa-md"},Oe={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(t){const o=re(),v=t,l=M(()=>{const{ans:k,totals:i}=v.summaries;return{detail:k.map((r,I)=>({...r,id:I})),totals:i}}),c=M(()=>Object.entries(l.value.totals).filter(([k,i])=>i>0)),m=M(()=>Object.entries(l.value.totals).filter(([k,i])=>i<0));return(k,i)=>(u(),C("div",null,[(c.value.length||m.value.length)&&n(o).currentSheetPeople.length>2?(u(),L(z,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>[x("div",ke,[m.value.length?(u(),C("div",Ie,[T(P(n(o).getName(t.selectedPerson))+" is owed ",1),(u(!0),C(j,null,K(m.value,([e,r],I)=>(u(),C(j,{key:e},[h($,{currency:e,amount:-r,color:"green","converted-amount":n(o).convertCurrency(-r,e,n(o).referenceCurrency),"reference-currency":n(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),I<m.value.length-1?(u(),C("span",qe," + ")):N("",!0)],64))),128))])):N("",!0),c.value.length?(u(),C("div",xe,[T(P(n(o).getName(t.selectedPerson))+" owes ",1),(u(!0),C(j,null,K(c.value,([e,r],I)=>(u(),C(j,{key:e},[h($,{currency:e,amount:r,color:"red","converted-amount":n(o).convertCurrency(r,e,n(o).referenceCurrency),"reference-currency":n(o).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),I<c.value.length-1?(u(),C("span",Ne," + ")):N("",!0)],64))),128))])):N("",!0)])]),_:1})):N("",!0),!l.value||l.value.detail.length===0?(u(),L(z,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>[...i[0]||(i[0]=[x("div",{class:"q-pa-md"},[x("div",null,"All Settled!")],-1)])]),_:1})):N("",!0),l.value&&l.value.detail.length>0?(u(),L(z,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>[x("div",Te,[(u(!0),C(j,null,K(l.value.detail,e=>(u(),C("div",{key:e.id},[x("div",null,[x("span",null,P(e.amount>0?n(o).getName(t.selectedPerson):n(o).getName(n(o).personIdx2Id(e.person))),1),i[1]||(i[1]=x("span",null," owes ",-1)),x("span",null,P(e.amount<0?n(o).getName(t.selectedPerson):n(o).getName(n(o).personIdx2Id(e.person)))+" Â  ",1),h($,{currency:e.currency,amount:Math.abs(e.amount),color:e.amount>0?"red":"green","converted-amount":n(o).convertCurrency(Math.abs(e.amount),e.currency,n(o).referenceCurrency),"reference-currency":n(o).referenceCurrency},null,8,["currency","amount","color","converted-amount","reference-currency"])])]))),128))])]),_:1})):N("",!0)]))}},{passive:B}=ce,Le=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Se,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:o,emit:v}){const l=D(!1),c=D(!0),m=D(null),k=D(null);let i=t.initialIndex,e,r;const I=M(()=>"q-infinite-scroll__loading"+(l.value===!0?"":" invisible"));function w(){if(t.disable===!0||l.value===!0||c.value===!1)return;const s=p(e),f=W(e),Q=J(e);t.reverse===!1?Math.round(f+Q+t.offset)>=Math.round(s)&&F():Math.round(f)<=t.offset&&F()}function F(){if(t.disable===!0||l.value===!0||c.value===!1)return;i++,l.value=!0;const s=p(e);v("load",i,f=>{c.value===!0&&(l.value=!1,X(()=>{if(t.reverse===!0){const Q=p(e),ae=W(e),se=Q-s;Z(e,ae+se)}f===!0?y():m.value&&m.value.closest("body")&&r()}))})}function R(){i=0}function Y(){c.value===!1&&(c.value=!0,e.addEventListener("scroll",r,B)),w()}function y(){var s;c.value===!0&&(c.value=!1,l.value=!1,e.removeEventListener("scroll",r,B),(s=r==null?void 0:r.cancel)==null||s.call(r))}function g(){if(e&&c.value===!0&&e.removeEventListener("scroll",r,B),e=Pe(m.value,t.scrollTarget),c.value===!0){if(e.addEventListener("scroll",r,B),t.reverse===!0){const s=p(e),f=J(e);Z(e,s-f)}w()}}function a(s){i=s}function S(s){s=parseInt(s,10);const f=r;r=s<=0?w:ye(w,isNaN(s)===!0?100:s),e&&c.value===!0&&(f!==void 0&&e.removeEventListener("scroll",f,B),e.addEventListener("scroll",r,B))}function b(s){if(O.value===!0){if(k.value===null){s!==!0&&X(()=>{b(!0)});return}const f=`${l.value===!0?"un":""}pauseAnimations`;Array.from(k.value.getElementsByTagName("svg")).forEach(Q=>{Q[f]()})}}const O=M(()=>t.disable!==!0&&c.value===!0);V([l,O],()=>{b()}),V(()=>t.disable,s=>{s===!0?y():Y()}),V(()=>t.reverse,()=>{l.value===!1&&c.value===!0&&w()}),V(()=>t.scrollTarget,g),V(()=>t.debounce,S);let A=!1;ue(()=>{A!==!1&&e&&Z(e,A)}),ie(()=>{A=e?W(e):!1}),de(()=>{c.value===!0&&e.removeEventListener("scroll",r,B)}),fe(()=>{S(t.debounce),g(),l.value===!1&&b()});const U=ve();return Object.assign(U.proxy,{poll:()=>{r==null||r()},trigger:F,stop:y,reset:R,resume:Y,setIndex:a,updateScrollTarget:g}),()=>{const s=me(o.default,[]);return O.value===!0&&s[t.reverse===!1?"push":"unshift"](G("div",{ref:k,class:I.value},ge(o.loading))),G("div",{class:"q-infinite-scroll",ref:m},s)}}}),ne=20,Ae={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(t,{emit:o}){const v=re(),l=t,c=D([]),m=D(0),k=D(0),i=y=>{const g=k.value+y;if(g<0||g>=r.value.length)return"";const a=r.value[g],S=l.transactions[a].timestamp;let b;if(g===0)b=Date.now();else{const Q=r.value[g-1];b=l.transactions[Q].timestamp}const O=E.getYear(b),A=E.getMonth(b),U=E.getYear(S),s=E.getMonth(S);if(O===U&&A===s)return"";let f="";return A!==s&&(f+=E.getMonth(S,!1)),O!==U&&(f&&(f+=" "),f+=U),f},e=M(()=>v.personId2Idx(l.selectedPerson)),r=M(()=>{const y=(l.searchString||"").toLowerCase(),g=!isNaN(parseFloat(y));return q.getTransactionList(l.transactions).filter(S=>{const b=l.transactions[S];return g?q.searchString(b).includes(y):q.name(b).toLowerCase().includes(y)})}),I=o,w=y=>{I("edit",y)},F=({reset:y},g)=>{I("remove",()=>y(),g)},R=(y,g)=>{const a=r.value.slice(m.value,m.value+ne);c.value.length===0&&(k.value=m.value),c.value.push(...a),m.value+=ne,g()},Y=M(()=>m.value>=r.value.length);return V(r,()=>{c.value=[],m.value=0,R(0,()=>{})}),(y,g)=>(u(),C("div",null,[h(Le,{onLoad:R,offset:300,disable:Y.value},{default:d(()=>[(u(!0),C(j,null,K(c.value,(a,S)=>(u(),C(j,{key:a},[i(S)?(u(),L(ee,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:d(()=>[T(P(i(S)),1)]),_:2},1024)):N("",!0),h(Ce,{clickable:"",class:_(S%2===0?"bg-grey-3":"bg-white"),onClick:b=>w(a),onLeft:b=>F(b,a),"left-color":"red","read-only":""},he({default:d(()=>[h(ee,null,{default:d(()=>[h(z,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:d(()=>[h(le,{class:"column q-pa-none flex justify-center items-center"},{default:d(()=>[x("div",null,P(n(E).getMonth(t.transactions[a].timestamp)),1),x("div",null,P(n(E).getDay(t.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),h(te,null,{default:d(()=>[h(H,{class:_({"text-grey":n(v).pendingTransactionIds.has(a)})},{default:d(()=>[T(P(n(q).name(t.transactions[a])),1)]),_:2},1032,["class"]),h(H,{caption:""},{default:d(()=>[T(P(n(v).getName(n(v).personIdx2Id(t.transactions[a].payer)))+" paid ",1),h($,{currency:t.transactions[a].currency,amount:t.transactions[a].amount,"reference-currency":n(v).referenceCurrency,"converted-amount":n(v).convertCurrency(t.transactions[a].amount,t.transactions[a].currency,n(v).referenceCurrency),"inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])]),_:2},1024)]),_:2},1024),h(te,{side:""},{default:d(()=>[n(q).position(t.transactions[a],e.value)>0?(u(),L(H,{key:0,caption:"",style:{color:"green"}},{default:d(()=>[T(P(n(v).getName(t.selectedPerson))+" lent ",1)]),_:1})):N("",!0),n(q).position(t.transactions[a],e.value)<0?(u(),L(H,{key:1,caption:"",style:{color:"red"}},{default:d(()=>[T(P(n(v).getName(t.selectedPerson))+" borrowed ",1)]),_:1})):N("",!0),n(q).position(t.transactions[a],e.value)===0?(u(),L(H,{key:2},{default:d(()=>[T(P(e.value!==t.transactions[a].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(u(),L(H,{key:3},{default:d(()=>[h($,{currency:t.transactions[a].currency,amount:Math.abs(n(q).position(t.transactions[a],e.value)),color:n(q).position(t.transactions[a],e.value)>=0?"green":"red","reference-currency":n(v).referenceCurrency,"converted-amount":n(v).convertCurrency(Math.abs(n(q).position(t.transactions[a],e.value)),t.transactions[a].currency,n(v).referenceCurrency)},null,8,["currency","amount","color","reference-currency","converted-amount"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[t.disableRemove?void 0:{name:"left",fn:d(()=>[h(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Oe as _,Ae as a};
