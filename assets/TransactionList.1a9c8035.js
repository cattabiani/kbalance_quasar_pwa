import{a as z,Q as le}from"./QCard.108a60f0.js";import{O as re,a as M,u,P as h,U as n,v as T,x as d,L as q,M as N,W as C,S as j,X as W,y as g,V as x,c as oe,r as D,w as A,J as ce,I as ue,f as ie,o as de,$ as fe,h as G,b as ve,j as me,z as K,aE as Z,aa as ye,g as ge,aD as L,Y as _,aF as he,Q as be}from"./index.59b76f8e.js";import{_ as $}from"./CurrencyDisplay.b838cd9d.js";import{c as ee,b as te,d as p}from"./QItemLabel.20f21824.js";import{Q as Ce}from"./QSlideItem.4a2abbc8.js";import{s as Se,d as Y,a as J,e as X,g as Pe}from"./scroll.f1c5cfbf.js";import{U as E}from"./utils.9ecf9ee0.js";const ke={class:"q-pa-md"},Ie={key:0},qe={key:0},xe={key:1},Le={key:0},Ne={class:"q-pa-md"},Oe={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(t){const l=re(),v=t,s=M(()=>{const{ans:S,totals:i}=v.summaries;return{detail:S.map((r,k)=>({...r,id:k})),totals:i}}),o=M(()=>Object.entries(s.value.totals).filter(([S,i])=>i>0)),m=M(()=>Object.entries(s.value.totals).filter(([S,i])=>i<0));return(S,i)=>(u(),h("div",null,[(o.value.length||m.value.length)&&n(l).currentSheetPeople.length>2?(u(),T(z,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>[q("div",ke,[m.value.length?(u(),h("div",Ie,[N(C(n(l).getName(t.selectedPerson))+" is owed ",1),(u(!0),h(j,null,W(m.value,([e,r],k)=>(u(),h(j,{key:e},[g($,{currency:e,amount:-r,color:"green","converted-amount":n(l).convertCurrency(-r,e,n(l).referenceCurrency),"reference-currency":n(l).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),k<m.value.length-1?(u(),h("span",qe," + ")):x("",!0)],64))),128))])):x("",!0),o.value.length?(u(),h("div",xe,[N(C(n(l).getName(t.selectedPerson))+" owes ",1),(u(!0),h(j,null,W(o.value,([e,r],k)=>(u(),h(j,{key:e},[g($,{currency:e,amount:r,color:"red","converted-amount":n(l).convertCurrency(r,e,n(l).referenceCurrency),"reference-currency":n(l).referenceCurrency},null,8,["currency","amount","converted-amount","reference-currency"]),k<o.value.length-1?(u(),h("span",Le," + ")):x("",!0)],64))),128))])):x("",!0)])]),_:1})):x("",!0),!s.value||s.value.detail.length===0?(u(),T(z,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>i[0]||(i[0]=[q("div",{class:"q-pa-md"},[q("div",null,"All Settled!")],-1)])),_:1})):x("",!0),s.value&&s.value.detail.length>0?(u(),T(z,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:d(()=>[q("div",Ne,[(u(!0),h(j,null,W(s.value.detail,e=>(u(),h("div",{key:e.id},[q("div",null,[q("span",null,C(e.amount>0?n(l).getName(t.selectedPerson):n(l).getName(n(l).personIdx2Id(e.person))),1),i[1]||(i[1]=q("span",null," owes ",-1)),q("span",null,C(e.amount<0?n(l).getName(t.selectedPerson):n(l).getName(n(l).personIdx2Id(e.person)))+" \xA0 ",1),g($,{currency:e.currency,amount:Math.abs(e.amount),color:e.amount>0?"red":"green","converted-amount":n(l).convertCurrency(Math.abs(e.amount),e.currency,n(l).referenceCurrency),"reference-currency":n(l).referenceCurrency},null,8,["currency","amount","color","converted-amount","reference-currency"])])]))),128))])]),_:1})):x("",!0)]))}},{passive:B}=me;var Te=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Se,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:l,emit:v}){const s=D(!1),o=D(!0),m=D(null),S=D(null);let i=t.initialIndex,e,r;const k=M(()=>"q-infinite-scroll__loading"+(s.value===!0?"":" invisible"));function w(){if(t.disable===!0||s.value===!0||o.value===!1)return;const c=Y(e),f=J(e),Q=Z(e);t.reverse===!1?Math.round(f+Q+t.offset)>=Math.round(c)&&H():Math.round(f)<=t.offset&&H()}function H(){if(t.disable===!0||s.value===!0||o.value===!1)return;i++,s.value=!0;const c=Y(e);v("load",i,f=>{o.value===!0&&(s.value=!1,K(()=>{if(t.reverse===!0){const Q=Y(e),ae=J(e),se=Q-c;X(e,ae+se)}f===!0?b():m.value&&m.value.closest("body")&&r()}))})}function F(){i=0}function R(){o.value===!1&&(o.value=!0,e.addEventListener("scroll",r,B)),w()}function b(){o.value===!0&&(o.value=!1,s.value=!1,e.removeEventListener("scroll",r,B),r!==void 0&&r.cancel!==void 0&&r.cancel())}function y(){if(e&&o.value===!0&&e.removeEventListener("scroll",r,B),e=Pe(m.value,t.scrollTarget),o.value===!0){if(e.addEventListener("scroll",r,B),t.reverse===!0){const c=Y(e),f=Z(e);X(e,c-f)}w()}}function a(c){i=c}function I(c){c=parseInt(c,10);const f=r;r=c<=0?w:ye(w,isNaN(c)===!0?100:c),e&&o.value===!0&&(f!==void 0&&e.removeEventListener("scroll",f,B),e.addEventListener("scroll",r,B))}function P(c){if(O.value===!0){if(S.value===null){c!==!0&&K(()=>{P(!0)});return}const f=`${s.value===!0?"un":""}pauseAnimations`;Array.from(S.value.getElementsByTagName("svg")).forEach(Q=>{Q[f]()})}}const O=M(()=>t.disable!==!0&&o.value===!0);A([s,O],()=>{P()}),A(()=>t.disable,c=>{c===!0?b():R()}),A(()=>t.reverse,()=>{s.value===!1&&o.value===!0&&w()}),A(()=>t.scrollTarget,y),A(()=>t.debounce,I);let V=!1;ce(()=>{V!==!1&&e&&X(e,V)}),ue(()=>{V=e?J(e):!1}),ie(()=>{o.value===!0&&e.removeEventListener("scroll",r,B)}),de(()=>{I(t.debounce),y(),s.value===!1&&P()});const U=ge();return Object.assign(U.proxy,{poll:()=>{r!==void 0&&r()},trigger:H,stop:b,reset:F,resume:R,setIndex:a,updateScrollTarget:y}),()=>{const c=fe(l.default,[]);return O.value===!0&&c[t.reverse===!1?"push":"unshift"](G("div",{ref:S,class:k.value},ve(l.loading))),G("div",{class:"q-infinite-scroll",ref:m},c)}}});const ne=20,Ve={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(t,{emit:l}){const v=re(),s=t,o=D([]),m=D(0),S=D(0),i=b=>{const y=S.value+b;if(y<0||y>=r.value.length)return"";const a=r.value[y],I=s.transactions[a].timestamp;let P;if(y===0)P=Date.now();else{const Q=r.value[y-1];P=s.transactions[Q].timestamp}const O=E.getYear(P),V=E.getMonth(P),U=E.getYear(I),c=E.getMonth(I);if(O===U&&V===c)return"";let f="";return V!==c&&(f+=E.getMonth(I,!1)),O!==U&&(f&&(f+=" "),f+=U),f},e=M(()=>v.personId2Idx(s.selectedPerson)),r=M(()=>{const b=(s.searchString||"").toLowerCase();return L.getTransactionList(s.transactions).filter(y=>L.name(s.transactions[y]).toLowerCase().includes(b))}),k=l,w=b=>{k("edit",b)},H=({reset:b},y)=>{k("remove",()=>b(),y)},F=(b,y)=>{const a=r.value.slice(m.value,m.value+ne);o.value.length===0&&(S.value=m.value),o.value.push(...a),m.value+=ne,y()},R=M(()=>m.value>=r.value.length);return A(r,()=>{o.value=[],m.value=0,F(0,()=>{})}),(b,y)=>(u(),h("div",null,[g(Te,{onLoad:F,offset:300,disable:R.value},{default:d(()=>[(u(!0),h(j,null,W(o.value,(a,I)=>(u(),h(j,{key:a},[i(I)?(u(),T(ee,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:d(()=>[N(C(i(I)),1)]),_:2},1024)):x("",!0),g(Ce,{clickable:"",class:_(I%2===0?"bg-grey-3":"bg-white"),onClick:P=>w(a),onLeft:P=>H(P,a),"left-color":"red","read-only":""},he({default:d(()=>[g(ee,null,{default:d(()=>[g(z,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:d(()=>[g(le,{class:"column q-pa-none flex justify-center items-center"},{default:d(()=>[q("div",null,C(n(E).getMonth(t.transactions[a].timestamp)),1),q("div",null,C(n(E).getDay(t.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),g(te,null,{default:d(()=>[g(p,{class:_({"text-grey":n(v).pendingTransactionIds.has(a)})},{default:d(()=>[N(C(n(L).name(t.transactions[a])),1)]),_:2},1032,["class"]),g(p,{caption:""},{default:d(()=>[N(C(n(v).getName(n(v).personId2Idx(t.transactions[a].payer)))+" paid ",1),g($,{currency:t.transactions[a].currency,amount:t.transactions[a].amount,"reference-currency":n(v).referenceCurrency,"converted-amount":n(v).convertCurrency(t.transactions[a].amount,t.transactions[a].currency,n(v).referenceCurrency),"inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])]),_:2},1024)]),_:2},1024),g(te,{side:""},{default:d(()=>[n(L).position(t.transactions[a],e.value)>0?(u(),T(p,{key:0,caption:"",style:{color:"green"}},{default:d(()=>[N(C(n(v).getName(t.selectedPerson))+" lent ",1)]),_:1})):x("",!0),n(L).position(t.transactions[a],e.value)<0?(u(),T(p,{key:1,caption:"",style:{color:"red"}},{default:d(()=>[N(C(n(v).getName(t.selectedPerson))+" borrowed ",1)]),_:1})):x("",!0),n(L).position(t.transactions[a],e.value)===0?(u(),T(p,{key:2},{default:d(()=>[N(C(e.value!==t.transactions[a].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(u(),T(p,{key:3},{default:d(()=>[g($,{currency:t.transactions[a].currency,amount:Math.abs(n(L).position(t.transactions[a],e.value)),color:n(L).position(t.transactions[a],e.value)>=0?"green":"red","reference-currency":n(v).referenceCurrency,"converted-amount":n(v).convertCurrency(Math.abs(n(L).position(t.transactions[a],e.value)),t.transactions[a].currency,n(v).referenceCurrency)},null,8,["currency","amount","color","reference-currency","converted-amount"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[t.disableRemove?void 0:{name:"left",fn:d(()=>[g(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Oe as _,Ve as a};
