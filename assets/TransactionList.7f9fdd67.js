import{a as $,Q as re}from"./QCard.3f3a1dae.js";import{O as te,a as N,u as m,P as C,v as p,x as u,L as I,W as d,U as s,V as L,S as W,X as ae,al as se,c as oe,r as j,w as V,J as ie,I as ue,f as ce,o as de,$ as fe,h as G,b as me,j as ve,z as J,aF as X,aa as ge,g as ye,aD as k,y as x,M,Y as K,aG as he,Q as be}from"./index.81992853.js";import{U as b}from"./utils.ca14db4f.js";import{b as Z,a as _}from"./QMenu.30afa9fe.js";import{a as O}from"./PersonItem.24d38592.js";import{Q as Se}from"./QSlideItem.d14ef100.js";import{s as Ie,d as R,a as z,e as Y,g as Pe}from"./scroll.b02d0dda.js";const qe={class:"q-pa-md"},xe={key:0,style:{color:"green"}},ke={key:1,style:{color:"red"}},Ce={class:"q-pa-md"},Be={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(t){const y=te(),P=t,a=N(()=>{const{ans:g,totals:i}=P.summaries;return{detail:g.map((n,B)=>({...n,id:B})),totals:i}}),o=N(()=>Object.entries(a.value.totals).filter(([g,i])=>i>0).map(([g,i])=>b.displayCurrency(g,i)).join(" + ")),v=N(()=>Object.entries(a.value.totals).filter(([g,i])=>i<0).map(([g,i])=>b.displayCurrency(g,-i)).join(" + "));return(g,i)=>(m(),C("div",null,[v.value||o.value?(m(),p($,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[I("div",qe,[v.value?(m(),C("div",xe,d(s(y).getName(t.selectedPerson))+" is owed "+d(v.value),1)):L("",!0),o.value?(m(),C("div",ke,d(s(y).getName(t.selectedPerson))+" owes "+d(o.value),1)):L("",!0)])]),_:1})):L("",!0),!a.value||a.value.detail.length===0?(m(),p($,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>i[0]||(i[0]=[I("div",{class:"q-pa-md"},[I("div",null,"All Settled!")],-1)])),_:1})):L("",!0),a.value&&a.value.detail.length>0?(m(),p($,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[I("div",Ce,[(m(!0),C(W,null,ae(a.value.detail,e=>(m(),C("div",{key:e.id},[I("div",null,[I("span",null,d(e.amount>0?s(y).getName(t.selectedPerson):s(y).getName(s(y).personIdx2Id(e.person))),1),i[1]||(i[1]=I("span",null," owes ",-1)),I("span",null,d(e.amount<0?s(y).getName(t.selectedPerson):s(y).getName(s(y).personIdx2Id(e.person)))+" \xA0 ",1),I("span",{style:se({color:e.amount>0?"red":"green"})},d(s(b).displayCurrency(e.currency,Math.abs(e.amount))),5)])]))),128))])]),_:1})):L("",!0)]))}},{passive:Q}=ve;var pe=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Ie,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:y,emit:P}){const a=j(!1),o=j(!0),v=j(null),g=j(null);let i=t.initialIndex,e,n;const B=N(()=>"q-infinite-scroll__loading"+(a.value===!0?"":" invisible"));function T(){if(t.disable===!0||a.value===!0||o.value===!1)return;const r=R(e),c=z(e),w=X(e);t.reverse===!1?Math.round(c+w+t.offset)>=Math.round(r)&&A():Math.round(c)<=t.offset&&A()}function A(){if(t.disable===!0||a.value===!0||o.value===!1)return;i++,a.value=!0;const r=R(e);P("load",i,c=>{o.value===!0&&(a.value=!1,J(()=>{if(t.reverse===!0){const w=R(e),ne=z(e),le=w-r;Y(e,ne+le)}c===!0?h():v.value&&v.value.closest("body")&&n()}))})}function U(){i=0}function F(){o.value===!1&&(o.value=!0,e.addEventListener("scroll",n,Q)),T()}function h(){o.value===!0&&(o.value=!1,a.value=!1,e.removeEventListener("scroll",n,Q),n!==void 0&&n.cancel!==void 0&&n.cancel())}function f(){if(e&&o.value===!0&&e.removeEventListener("scroll",n,Q),e=Pe(v.value,t.scrollTarget),o.value===!0){if(e.addEventListener("scroll",n,Q),t.reverse===!0){const r=R(e),c=X(e);Y(e,r-c)}T()}}function l(r){i=r}function q(r){r=parseInt(r,10);const c=n;n=r<=0?T:ge(T,isNaN(r)===!0?100:r),e&&o.value===!0&&(c!==void 0&&e.removeEventListener("scroll",c,Q),e.addEventListener("scroll",n,Q))}function S(r){if(D.value===!0){if(g.value===null){r!==!0&&J(()=>{S(!0)});return}const c=`${a.value===!0?"un":""}pauseAnimations`;Array.from(g.value.getElementsByTagName("svg")).forEach(w=>{w[c]()})}}const D=N(()=>t.disable!==!0&&o.value===!0);V([a,D],()=>{S()}),V(()=>t.disable,r=>{r===!0?h():F()}),V(()=>t.reverse,()=>{a.value===!1&&o.value===!0&&T()}),V(()=>t.scrollTarget,f),V(()=>t.debounce,q);let E=!1;ie(()=>{E!==!1&&e&&Y(e,E)}),ue(()=>{E=e?z(e):!1}),ce(()=>{o.value===!0&&e.removeEventListener("scroll",n,Q)}),de(()=>{q(t.debounce),f(),a.value===!1&&S()});const H=ye();return Object.assign(H.proxy,{poll:()=>{n!==void 0&&n()},trigger:A,stop:h,reset:U,resume:F,setIndex:l,updateScrollTarget:f}),()=>{const r=fe(y.default,[]);return D.value===!0&&r[t.reverse===!1?"push":"unshift"](G("div",{ref:g,class:B.value},me(y.loading))),G("div",{class:"q-infinite-scroll",ref:v},r)}}});const ee=20,De={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(t,{emit:y}){const P=te(),a=t,o=j([]),v=j(0),g=j(0),i=h=>{const f=g.value+h;if(f<0||f>=n.value.length)return"";const l=n.value[f],q=a.transactions[l].timestamp;let S;if(f===0)S=Date.now();else{const w=n.value[f-1];S=a.transactions[w].timestamp}const D=b.getYear(S),E=b.getMonth(S),H=b.getYear(q),r=b.getMonth(q);if(D===H&&E===r)return"";let c="";return E!==r&&(c+=b.getMonth(q,!1)),D!==H&&(c&&(c+=" "),c+=H),c},e=N(()=>P.personId2Idx(a.selectedPerson)),n=N(()=>{const h=(a.searchString||"").toLowerCase();return k.getTransactionList(a.transactions).filter(f=>k.name(a.transactions[f]).toLowerCase().includes(h))}),B=y,T=h=>{B("edit",h)},A=({reset:h},f)=>{B("remove",()=>h(),f)},U=(h,f)=>{const l=n.value.slice(v.value,v.value+ee);o.value.length===0&&(g.value=v.value),o.value.push(...l),v.value+=ee,f()},F=N(()=>v.value>=n.value.length);return V(n,()=>{o.value=[],v.value=0,U(0,()=>{})}),(h,f)=>(m(),C("div",null,[x(pe,{onLoad:U,offset:300,disable:F.value},{default:u(()=>[(m(!0),C(W,null,ae(o.value,(l,q)=>(m(),C(W,{key:l},[i(q)?(m(),p(Z,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:u(()=>[M(d(i(q)),1)]),_:2},1024)):L("",!0),x(Se,{clickable:"",class:K(q%2===0?"bg-grey-3":"bg-white"),onClick:S=>T(l),onLeft:S=>A(S,l),"left-color":"red","read-only":""},he({default:u(()=>[x(Z,null,{default:u(()=>[x($,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:u(()=>[x(re,{class:"column q-pa-none flex justify-center items-center"},{default:u(()=>[I("div",null,d(s(b).getMonth(t.transactions[l].timestamp)),1),I("div",null,d(s(b).getDay(t.transactions[l].timestamp)),1)]),_:2},1024)]),_:2},1024),x(_,null,{default:u(()=>[x(O,{class:K({"text-grey":s(P).pendingTransactionIds.has(l)})},{default:u(()=>[M(d(s(k).name(t.transactions[l])),1)]),_:2},1032,["class"]),x(O,{caption:""},{default:u(()=>[M(d(s(P).getName(s(P).personId2Idx(t.transactions[l].payer)))+" paid "+d(s(b).displayCurrency(t.transactions[l].currency,t.transactions[l].amount)),1)]),_:2},1024)]),_:2},1024),x(_,{side:""},{default:u(()=>[s(k).position(t.transactions[l],e.value)>0?(m(),p(O,{key:0,caption:"",style:{color:"green"}},{default:u(()=>[M(d(s(P).getName(t.selectedPerson))+" lent ",1)]),_:1})):L("",!0),s(k).position(t.transactions[l],e.value)<0?(m(),p(O,{key:1,caption:"",style:{color:"red"}},{default:u(()=>[M(d(s(P).getName(t.selectedPerson))+" borrowed ",1)]),_:1})):L("",!0),s(k).position(t.transactions[l],e.value)===0?(m(),p(O,{key:2},{default:u(()=>[M(d(e.value!==t.transactions[l].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(m(),p(O,{key:3,style:se({color:s(k).position(t.transactions[l],e.value)>=0?"green":"red"})},{default:u(()=>[M(d(s(b).displayCurrency(t.transactions[l].currency,Math.abs(s(k).position(t.transactions[l],e.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},[t.disableRemove?void 0:{name:"left",fn:u(()=>[x(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Be as _,De as a};
