import{a as $,Q as re}from"./QCard.ec05a8a9.js";import{O as te,a as C,u as f,P as k,v as N,x as u,L as I,W as d,U as a,V as p,S as W,X as ae,al as se,c as oe,r as w,w as V,J as ie,I as ue,f as ce,o as de,$ as fe,h as G,b as ve,j as me,z as J,aF as X,aa as ge,g as ye,aD as M,y as x,M as Q,Y as K,aG as he,Q as be}from"./index.3fd8f0e6.js";import{U as h}from"./utils.ca14db4f.js";import{b as Z,a as _}from"./QMenu.63d5779a.js";import{a as O}from"./PersonItem.140e2933.js";import{Q as Se}from"./QSlideItem.62714604.js";import{s as Ie,d as R,a as z,e as Y,g as Pe}from"./scroll.898b39f1.js";const qe={class:"q-pa-md"},xe={key:0,style:{color:"green"}},ke={key:1,style:{color:"red"}},Ne={class:"q-pa-md"},Be={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(t){const y=te(),P=t,s=C(()=>{const{ans:m,totals:i}=P.summaries;return{detail:m.map((n,B)=>({...n,id:B})),totals:i}}),o=C(()=>Object.entries(s.value.totals).filter(([m,i])=>i>0).map(([m,i])=>h.displayCurrency(m,i)).join(" + ")),v=C(()=>Object.entries(s.value.totals).filter(([m,i])=>i<0).map(([m,i])=>h.displayCurrency(m,-i)).join(" + "));return(m,i)=>(f(),k("div",null,[v.value||o.value?(f(),N($,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[I("div",qe,[v.value?(f(),k("div",xe,d(a(y).getName(t.selectedPerson))+" is owed "+d(v.value),1)):p("",!0),o.value?(f(),k("div",ke,d(a(y).getName(t.selectedPerson))+" owes "+d(o.value),1)):p("",!0)])]),_:1})):p("",!0),!s.value||s.value.detail.length===0?(f(),N($,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>i[0]||(i[0]=[I("div",{class:"q-pa-md"},[I("div",null,"All Settled!")],-1)])),_:1})):p("",!0),s.value&&s.value.detail.length>0?(f(),N($,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[I("div",Ne,[(f(!0),k(W,null,ae(s.value.detail,e=>(f(),k("div",{key:e.id},[I("div",null,[I("span",null,d(e.amount>0?a(y).getName(t.selectedPerson):a(y).getName(a(y).personIdx2Id(e.person))),1),i[1]||(i[1]=I("span",null," owes ",-1)),I("span",null,d(e.amount<0?a(y).getName(t.selectedPerson):a(y).getName(a(y).personIdx2Id(e.person)))+" \xA0 ",1),I("span",{style:se({color:e.amount>0?"red":"green"})},d(a(h).displayCurrency(e.currency,Math.abs(e.amount))),5)])]))),128))])]),_:1})):p("",!0)]))}},{passive:j}=me;var pe=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Ie,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:y,emit:P}){const s=w(!1),o=w(!0),v=w(null),m=w(null);let i=t.initialIndex,e,n;const B=C(()=>"q-infinite-scroll__loading"+(s.value===!0?"":" invisible"));function L(){if(t.disable===!0||s.value===!0||o.value===!1)return;const r=R(e),c=z(e),T=X(e);t.reverse===!1?Math.round(c+T+t.offset)>=Math.round(r)&&A():Math.round(c)<=t.offset&&A()}function A(){if(t.disable===!0||s.value===!0||o.value===!1)return;i++,s.value=!0;const r=R(e);P("load",i,c=>{o.value===!0&&(s.value=!1,J(()=>{if(t.reverse===!0){const T=R(e),ne=z(e),le=T-r;Y(e,ne+le)}c===!0?b():v.value&&v.value.closest("body")&&n()}))})}function U(){i=0}function F(){o.value===!1&&(o.value=!0,e.addEventListener("scroll",n,j)),L()}function b(){o.value===!0&&(o.value=!1,s.value=!1,e.removeEventListener("scroll",n,j),n!==void 0&&n.cancel!==void 0&&n.cancel())}function g(){if(e&&o.value===!0&&e.removeEventListener("scroll",n,j),e=Pe(v.value,t.scrollTarget),o.value===!0){if(e.addEventListener("scroll",n,j),t.reverse===!0){const r=R(e),c=X(e);Y(e,r-c)}L()}}function l(r){i=r}function q(r){r=parseInt(r,10);const c=n;n=r<=0?L:ge(L,isNaN(r)===!0?100:r),e&&o.value===!0&&(c!==void 0&&e.removeEventListener("scroll",c,j),e.addEventListener("scroll",n,j))}function S(r){if(D.value===!0){if(m.value===null){r!==!0&&J(()=>{S(!0)});return}const c=`${s.value===!0?"un":""}pauseAnimations`;Array.from(m.value.getElementsByTagName("svg")).forEach(T=>{T[c]()})}}const D=C(()=>t.disable!==!0&&o.value===!0);V([s,D],()=>{S()}),V(()=>t.disable,r=>{r===!0?b():F()}),V(()=>t.reverse,()=>{s.value===!1&&o.value===!0&&L()}),V(()=>t.scrollTarget,g),V(()=>t.debounce,q);let E=!1;ie(()=>{E!==!1&&e&&Y(e,E)}),ue(()=>{E=e?z(e):!1}),ce(()=>{o.value===!0&&e.removeEventListener("scroll",n,j)}),de(()=>{q(t.debounce),g(),s.value===!1&&S()});const H=ye();return Object.assign(H.proxy,{poll:()=>{n!==void 0&&n()},trigger:A,stop:b,reset:U,resume:F,setIndex:l,updateScrollTarget:g}),()=>{const r=fe(y.default,[]);return D.value===!0&&r[t.reverse===!1?"push":"unshift"](G("div",{ref:m,class:B.value},ve(y.loading))),G("div",{class:"q-infinite-scroll",ref:v},r)}}});const ee=20,De={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1}},emits:["edit","remove"],setup(t,{emit:y}){const P=te(),s=t,o=w([]),v=w(0),m=w(0),i=b=>{const g=m.value+b;if(g<0||g>=n.value.length)return"";const l=n.value[g],q=s.transactions[l].timestamp;let S;if(g===0)S=Date.now();else{const T=n.value[g-1];S=s.transactions[T].timestamp}const D=h.getYear(S),E=h.getMonth(S),H=h.getYear(q),r=h.getMonth(q);if(D===H&&E===r)return"";let c="";return E!==r&&(c+=h.getMonth(q,!1)),D!==H&&(c&&(c+=" "),c+=H),c},e=C(()=>P.personId2Idx(s.selectedPerson)),n=C(()=>M.getTransactionList(s.transactions)),B=y,L=b=>{B("edit",b)},A=({reset:b},g)=>{B("remove",()=>b(),g)},U=(b,g)=>{const l=n.value.slice(v.value,v.value+ee);o.value.length===0&&(m.value=v.value),o.value.push(...l),v.value+=ee,g()},F=C(()=>v.value>=n.value.length);return V(n,()=>{o.value=[],v.value=0,U(0,()=>{})}),(b,g)=>(f(),k("div",null,[x(pe,{onLoad:U,offset:300,disable:F.value},{default:u(()=>[(f(!0),k(W,null,ae(o.value,(l,q)=>(f(),k(W,{key:l},[i(q)?(f(),N(Z,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:u(()=>[Q(d(i(q)),1)]),_:2},1024)):p("",!0),x(Se,{clickable:"",class:K(q%2===0?"bg-grey-3":"bg-white"),onClick:S=>L(l),onLeft:S=>A(S,l),"left-color":"red","read-only":""},he({default:u(()=>[x(Z,null,{default:u(()=>[x($,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:u(()=>[x(re,{class:"column q-pa-none flex justify-center items-center"},{default:u(()=>[I("div",null,d(a(h).getMonth(t.transactions[l].timestamp)),1),I("div",null,d(a(h).getDay(t.transactions[l].timestamp)),1)]),_:2},1024)]),_:2},1024),x(_,null,{default:u(()=>[x(O,{class:K({"text-grey":a(P).pendingTransactionIds.has(l)})},{default:u(()=>[Q(d(a(M).name(t.transactions[l])),1)]),_:2},1032,["class"]),x(O,{caption:""},{default:u(()=>[Q(d(a(P).getName(a(P).personId2Idx(t.transactions[l].payer)))+" paid "+d(a(h).displayCurrency(t.transactions[l].currency,t.transactions[l].amount)),1)]),_:2},1024)]),_:2},1024),x(_,{side:""},{default:u(()=>[a(M).position(t.transactions[l],e.value)>0?(f(),N(O,{key:0,caption:"",style:{color:"green"}},{default:u(()=>[Q(d(a(P).getName(t.selectedPerson))+" lent ",1)]),_:1})):p("",!0),a(M).position(t.transactions[l],e.value)<0?(f(),N(O,{key:1,caption:"",style:{color:"red"}},{default:u(()=>[Q(d(a(P).getName(t.selectedPerson))+" borrowed ",1)]),_:1})):p("",!0),a(M).position(t.transactions[l],e.value)===0?(f(),N(O,{key:2},{default:u(()=>[Q(d(e.value!==t.transactions[l].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(f(),N(O,{key:3,style:se({color:a(M).position(t.transactions[l],e.value)>=0?"green":"red"})},{default:u(()=>[Q(d(a(h).displayCurrency(t.transactions[l].currency,Math.abs(a(M).position(t.transactions[l],e.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},[t.disableRemove?void 0:{name:"left",fn:u(()=>[x(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Be as _,De as a};
