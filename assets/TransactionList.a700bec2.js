import{a as Y,Q as re}from"./QCard.286ea9ca.js";import{O as ne,a as p,u as o,P as y,U as u,v as C,x as c,L as x,M as T,W as b,S as B,X as z,y as v,V as L,c as oe,r as j,w as A,J as ue,I as ie,f as ce,o as de,$ as fe,h as X,b as me,j as ve,z as G,aE as K,aa as ge,g as ye,aD as N,Y as Z,aF as he,Q as be}from"./index.6c9dbb9d.js";import{_}from"./CurrencyDisplay.42b4d706.js";import{b as ee,a as te}from"./QMenu.5bc3788b.js";import{a as V}from"./PersonItem.2b58404e.js";import{Q as Se}from"./QSlideItem.06c41a57.js";import{s as Pe,d as R,a as W,e as J,g as ke}from"./scroll.e304a2b9.js";import{U as Q}from"./utils.8924f51f.js";const Ie={class:"q-pa-md"},qe={key:0},xe={key:0},Le={key:1},Ne={key:0},Te={class:"q-pa-md"},Oe={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(t){const g=ne(),k=t,n=p(()=>{const{ans:S,totals:i}=k.summaries;return{detail:S.map((a,I)=>({...a,id:I})),totals:i}}),l=p(()=>Object.entries(n.value.totals).filter(([S,i])=>i>0)),f=p(()=>Object.entries(n.value.totals).filter(([S,i])=>i<0));return(S,i)=>(o(),y("div",null,[(l.value.length||f.value.length)&&u(g).currentSheetPeople.length>2?(o(),C(Y,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:c(()=>[x("div",Ie,[f.value.length?(o(),y("div",qe,[T(b(u(g).getName(t.selectedPerson))+" is owed ",1),(o(!0),y(B,null,z(f.value,([e,a],I)=>(o(),y(B,{key:e},[v(_,{currency:e,amount:-a,color:"green"},null,8,["currency","amount"]),I<f.value.length-1?(o(),y("span",xe," + ")):L("",!0)],64))),128))])):L("",!0),l.value.length?(o(),y("div",Le,[T(b(u(g).getName(t.selectedPerson))+" owes ",1),(o(!0),y(B,null,z(l.value,([e,a],I)=>(o(),y(B,{key:e},[v(_,{currency:e,amount:a,color:"red"},null,8,["currency","amount"]),I<l.value.length-1?(o(),y("span",Ne," + ")):L("",!0)],64))),128))])):L("",!0)])]),_:1})):L("",!0),!n.value||n.value.detail.length===0?(o(),C(Y,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:c(()=>i[0]||(i[0]=[x("div",{class:"q-pa-md"},[x("div",null,"All Settled!")],-1)])),_:1})):L("",!0),n.value&&n.value.detail.length>0?(o(),C(Y,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:c(()=>[x("div",Te,[(o(!0),y(B,null,z(n.value.detail,e=>(o(),y("div",{key:e.id},[x("div",null,[x("span",null,b(e.amount>0?u(g).getName(t.selectedPerson):u(g).getName(u(g).personIdx2Id(e.person))),1),i[1]||(i[1]=x("span",null," owes ",-1)),x("span",null,b(e.amount<0?u(g).getName(t.selectedPerson):u(g).getName(u(g).personIdx2Id(e.person)))+" \xA0 ",1),v(_,{currency:e.currency,amount:Math.abs(e.amount),color:e.amount>0?"red":"green"},null,8,["currency","amount","color"])])]))),128))])]),_:1})):L("",!0)]))}},{passive:E}=ve;var Ce=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Pe,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:g,emit:k}){const n=j(!1),l=j(!0),f=j(null),S=j(null);let i=t.initialIndex,e,a;const I=p(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function w(){if(t.disable===!0||n.value===!0||l.value===!1)return;const r=R(e),d=W(e),M=K(e);t.reverse===!1?Math.round(d+M+t.offset)>=Math.round(r)&&H():Math.round(d)<=t.offset&&H()}function H(){if(t.disable===!0||n.value===!0||l.value===!1)return;i++,n.value=!0;const r=R(e);k("load",i,d=>{l.value===!0&&(n.value=!1,G(()=>{if(t.reverse===!0){const M=R(e),le=W(e),se=M-r;J(e,le+se)}d===!0?h():f.value&&f.value.closest("body")&&a()}))})}function $(){i=0}function F(){l.value===!1&&(l.value=!0,e.addEventListener("scroll",a,E)),w()}function h(){l.value===!0&&(l.value=!1,n.value=!1,e.removeEventListener("scroll",a,E),a!==void 0&&a.cancel!==void 0&&a.cancel())}function m(){if(e&&l.value===!0&&e.removeEventListener("scroll",a,E),e=ke(f.value,t.scrollTarget),l.value===!0){if(e.addEventListener("scroll",a,E),t.reverse===!0){const r=R(e),d=K(e);J(e,r-d)}w()}}function s(r){i=r}function q(r){r=parseInt(r,10);const d=a;a=r<=0?w:ge(w,isNaN(r)===!0?100:r),e&&l.value===!0&&(d!==void 0&&e.removeEventListener("scroll",d,E),e.addEventListener("scroll",a,E))}function P(r){if(D.value===!0){if(S.value===null){r!==!0&&G(()=>{P(!0)});return}const d=`${n.value===!0?"un":""}pauseAnimations`;Array.from(S.value.getElementsByTagName("svg")).forEach(M=>{M[d]()})}}const D=p(()=>t.disable!==!0&&l.value===!0);A([n,D],()=>{P()}),A(()=>t.disable,r=>{r===!0?h():F()}),A(()=>t.reverse,()=>{n.value===!1&&l.value===!0&&w()}),A(()=>t.scrollTarget,m),A(()=>t.debounce,q);let O=!1;ue(()=>{O!==!1&&e&&J(e,O)}),ie(()=>{O=e?W(e):!1}),ce(()=>{l.value===!0&&e.removeEventListener("scroll",a,E)}),de(()=>{q(t.debounce),m(),n.value===!1&&P()});const U=ye();return Object.assign(U.proxy,{poll:()=>{a!==void 0&&a()},trigger:H,stop:h,reset:$,resume:F,setIndex:s,updateScrollTarget:m}),()=>{const r=fe(g.default,[]);return D.value===!0&&r[t.reverse===!1?"push":"unshift"](X("div",{ref:S,class:I.value},me(g.loading))),X("div",{class:"q-infinite-scroll",ref:f},r)}}});const ae=20,Ve={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1},searchString:{type:String,default:null}},emits:["edit","remove"],setup(t,{emit:g}){const k=ne(),n=t,l=j([]),f=j(0),S=j(0),i=h=>{const m=S.value+h;if(m<0||m>=a.value.length)return"";const s=a.value[m],q=n.transactions[s].timestamp;let P;if(m===0)P=Date.now();else{const M=a.value[m-1];P=n.transactions[M].timestamp}const D=Q.getYear(P),O=Q.getMonth(P),U=Q.getYear(q),r=Q.getMonth(q);if(D===U&&O===r)return"";let d="";return O!==r&&(d+=Q.getMonth(q,!1)),D!==U&&(d&&(d+=" "),d+=U),d},e=p(()=>k.personId2Idx(n.selectedPerson)),a=p(()=>{const h=(n.searchString||"").toLowerCase();return N.getTransactionList(n.transactions).filter(m=>N.name(n.transactions[m]).toLowerCase().includes(h))}),I=g,w=h=>{I("edit",h)},H=({reset:h},m)=>{I("remove",()=>h(),m)},$=(h,m)=>{const s=a.value.slice(f.value,f.value+ae);l.value.length===0&&(S.value=f.value),l.value.push(...s),f.value+=ae,m()},F=p(()=>f.value>=a.value.length);return A(a,()=>{l.value=[],f.value=0,$(0,()=>{})}),(h,m)=>(o(),y("div",null,[v(Ce,{onLoad:$,offset:300,disable:F.value},{default:c(()=>[(o(!0),y(B,null,z(l.value,(s,q)=>(o(),y(B,{key:s},[i(q)?(o(),C(ee,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:c(()=>[T(b(i(q)),1)]),_:2},1024)):L("",!0),v(Se,{clickable:"",class:Z(q%2===0?"bg-grey-3":"bg-white"),onClick:P=>w(s),onLeft:P=>H(P,s),"left-color":"red","read-only":""},he({default:c(()=>[v(ee,null,{default:c(()=>[v(Y,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:c(()=>[v(re,{class:"column q-pa-none flex justify-center items-center"},{default:c(()=>[x("div",null,b(u(Q).getMonth(t.transactions[s].timestamp)),1),x("div",null,b(u(Q).getDay(t.transactions[s].timestamp)),1)]),_:2},1024)]),_:2},1024),v(te,null,{default:c(()=>[v(V,{class:Z({"text-grey":u(k).pendingTransactionIds.has(s)})},{default:c(()=>[T(b(u(N).name(t.transactions[s])),1)]),_:2},1032,["class"]),v(V,{caption:""},{default:c(()=>[T(b(u(k).getName(u(k).personId2Idx(t.transactions[s].payer)))+" paid ",1),v(_,{currency:t.transactions[s].currency,amount:t.transactions[s].amount},null,8,["currency","amount"])]),_:2},1024)]),_:2},1024),v(te,{side:""},{default:c(()=>[u(N).position(t.transactions[s],e.value)>0?(o(),C(V,{key:0,caption:"",style:{color:"green"}},{default:c(()=>[T(b(u(k).getName(t.selectedPerson))+" lent ",1)]),_:1})):L("",!0),u(N).position(t.transactions[s],e.value)<0?(o(),C(V,{key:1,caption:"",style:{color:"red"}},{default:c(()=>[T(b(u(k).getName(t.selectedPerson))+" borrowed ",1)]),_:1})):L("",!0),u(N).position(t.transactions[s],e.value)===0?(o(),C(V,{key:2},{default:c(()=>[T(b(e.value!==t.transactions[s].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(o(),C(V,{key:3},{default:c(()=>[v(_,{currency:t.transactions[s].currency,amount:Math.abs(u(N).position(t.transactions[s],e.value)),color:u(N).position(t.transactions[s],e.value)>=0?"green":"red"},null,8,["currency","amount","color"])]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},[t.disableRemove?void 0:{name:"left",fn:c(()=>[v(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Oe as _,Ve as a};
