import{a as H,Q as re}from"./QCard.1b962dd7.js";import{O as ee,a as T,u as m,P as N,v as C,x as u,L as P,W as c,U as n,V as L,S as z,X as te,al as ae,c as oe,r as w,w as D,J as ie,I as ue,f as ce,o as de,$ as ve,h as W,b as fe,j as me,z as G,aF as J,aa as ge,g as ye,aD as M,y as k,M as Q,Y as X,aG as he,Q as be}from"./index.a930c1a4.js";import{U as f}from"./utils.ca14db4f.js";import{b as K,a as Z}from"./QMenu.25bcbaf0.js";import{a as E}from"./PersonItem.49508055.js";import{Q as Se}from"./QSlideItem.d5c0d4b0.js";import{s as Ie,d as $,a as F,e as R,g as xe}from"./scroll.43ca7a4e.js";const Pe={class:"q-pa-md"},qe={key:0,style:{color:"green"}},ke={key:1,style:{color:"red"}},pe={class:"q-pa-md"},Be={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(e){const h=ee(),q=e,s=T(()=>{const{ans:d,totals:o}=q.summaries;return{detail:d.map((l,b)=>({...l,id:b})),totals:o}}),r=T(()=>Object.entries(s.value.totals).filter(([d,o])=>o>0).map(([d,o])=>f.displayCurrency(d,o)).join(" + ")),g=T(()=>Object.entries(s.value.totals).filter(([d,o])=>o<0).map(([d,o])=>f.displayCurrency(d,-o)).join(" + "));return(d,o)=>(m(),N("div",null,[g.value||r.value?(m(),C(H,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[P("div",Pe,[g.value?(m(),N("div",qe,c(n(h).getName(e.selectedPerson))+" is owed "+c(g.value),1)):L("",!0),r.value?(m(),N("div",ke,c(n(h).getName(e.selectedPerson))+" owes "+c(r.value),1)):L("",!0)])]),_:1})):L("",!0),!s.value||s.value.detail.length===0?(m(),C(H,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>o[0]||(o[0]=[P("div",{class:"q-pa-md"},[P("div",null,"All Settled!")],-1)])),_:1})):L("",!0),s.value&&s.value.detail.length>0?(m(),C(H,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[P("div",pe,[(m(!0),N(z,null,te(s.value.detail,t=>(m(),N("div",{key:t.id},[P("div",null,[P("span",null,c(t.amount>0?n(h).getName(e.selectedPerson):n(h).getName(n(h).personIdx2Id(t.person))),1),o[1]||(o[1]=P("span",null," owes ",-1)),P("span",null,c(t.amount<0?n(h).getName(e.selectedPerson):n(h).getName(n(h).personIdx2Id(t.person)))+" \xA0 ",1),P("span",{style:ae({color:t.amount>0?"red":"green"})},c(n(f).displayCurrency(t.currency,Math.abs(t.amount))),5)])]))),128))])]),_:1})):L("",!0)]))}},{passive:j}=me;var Ne=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Ie,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(e,{slots:h,emit:q}){const s=w(!1),r=w(!0),g=w(null),d=w(null);let o=e.initialIndex,t,l;const b=T(()=>"q-infinite-scroll__loading"+(s.value===!0?"":" invisible"));function p(){if(e.disable===!0||s.value===!0||r.value===!1)return;const i=$(t),x=F(t),Y=J(t);e.reverse===!1?Math.round(x+Y+e.offset)>=Math.round(i)&&O():Math.round(x)<=e.offset&&O()}function O(){if(e.disable===!0||s.value===!0||r.value===!1)return;o++,s.value=!0;const i=$(t);q("load",o,x=>{r.value===!0&&(s.value=!1,G(()=>{if(e.reverse===!0){const Y=$(t),ne=F(t),le=Y-i;R(t,ne+le)}x===!0?A():g.value&&g.value.closest("body")&&l()}))})}function U(){o=0}function V(){r.value===!1&&(r.value=!0,t.addEventListener("scroll",l,j)),p()}function A(){r.value===!0&&(r.value=!1,s.value=!1,t.removeEventListener("scroll",l,j),l!==void 0&&l.cancel!==void 0&&l.cancel())}function S(){if(t&&r.value===!0&&t.removeEventListener("scroll",l,j),t=xe(g.value,e.scrollTarget),r.value===!0){if(t.addEventListener("scroll",l,j),e.reverse===!0){const i=$(t),x=J(t);R(t,i-x)}p()}}function v(i){o=i}function a(i){i=parseInt(i,10);const x=l;l=i<=0?p:ge(p,isNaN(i)===!0?100:i),t&&r.value===!0&&(x!==void 0&&t.removeEventListener("scroll",x,j),t.addEventListener("scroll",l,j))}function I(i){if(y.value===!0){if(d.value===null){i!==!0&&G(()=>{I(!0)});return}const x=`${s.value===!0?"un":""}pauseAnimations`;Array.from(d.value.getElementsByTagName("svg")).forEach(Y=>{Y[x]()})}}const y=T(()=>e.disable!==!0&&r.value===!0);D([s,y],()=>{I()}),D(()=>e.disable,i=>{i===!0?A():V()}),D(()=>e.reverse,()=>{s.value===!1&&r.value===!0&&p()}),D(()=>e.scrollTarget,S),D(()=>e.debounce,a);let B=!1;ie(()=>{B!==!1&&t&&R(t,B)}),ue(()=>{B=t?F(t):!1}),ce(()=>{r.value===!0&&t.removeEventListener("scroll",l,j)}),de(()=>{a(e.debounce),S(),s.value===!1&&I()});const se=ye();return Object.assign(se.proxy,{poll:()=>{l!==void 0&&l()},trigger:O,stop:A,reset:U,resume:V,setIndex:v,updateScrollTarget:S}),()=>{const i=ve(h.default,[]);return y.value===!0&&i[e.reverse===!1?"push":"unshift"](W("div",{ref:d,class:b.value},fe(h.loading))),W("div",{class:"q-infinite-scroll",ref:g},i)}}});const _=20,Ee={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1}},emits:["edit","remove"],setup(e,{emit:h}){const q=ee(),s=e,r=w([]),g=w(0),d=w(0),o=S=>{const v=d.value+S;if(v<=0||v>=b.value.length)return!1;const a=b.value[v-1],I=b.value[v],y=s.transactions[a].timestamp,B=s.transactions[I].timestamp;return f.getYear(y)!==f.getYear(B)||f.getMonth(y)!==f.getMonth(B)},t=S=>{const v=d.value+S;if(v<=0||v>=b.value.length)return null;const a=b.value[v],I=b.value[v-1],y=s.transactions[a].timestamp;return f.getYear(s.transactions[I].timestamp)!==f.getYear(y)?`${f.getMonth(y,!1)} ${f.getYear(y)}`:f.getMonth(y,!1)},l=T(()=>q.personId2Idx(s.selectedPerson)),b=T(()=>M.getTransactionList(s.transactions)),p=h,O=S=>{p("edit",S)},U=({reset:S},v)=>{p("remove",()=>S(),v)},V=(S,v)=>{const a=b.value.slice(g.value,g.value+_);r.value.length===0&&(d.value=g.value),r.value.push(...a),g.value+=_,v()},A=T(()=>g.value>=b.value.length);return D(b,()=>{r.value=[],g.value=0,V(0,()=>{})}),(S,v)=>(m(),N("div",null,[k(Ne,{onLoad:V,offset:300,disable:A.value},{default:u(()=>[(m(!0),N(z,null,te(r.value,(a,I)=>(m(),N(z,{key:a},[o(I)?(m(),C(K,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:u(()=>[Q(c(t(I)),1)]),_:2},1024)):L("",!0),k(Se,{clickable:"",class:X(I%2===0?"bg-grey-3":"bg-white"),onClick:y=>O(a),onLeft:y=>U(y,a),"left-color":"red","read-only":""},he({default:u(()=>[k(K,null,{default:u(()=>[k(H,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:u(()=>[k(re,{class:"column q-pa-none flex justify-center items-center"},{default:u(()=>[P("div",null,c(n(f).getMonth(e.transactions[a].timestamp)),1),P("div",null,c(n(f).getDay(e.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),k(Z,null,{default:u(()=>[k(E,{class:X({"text-grey":n(q).pendingTransactionIds.has(a)})},{default:u(()=>[Q(c(n(M).name(e.transactions[a])),1)]),_:2},1032,["class"]),k(E,{caption:""},{default:u(()=>[Q(c(n(q).getName(n(q).personId2Idx(e.transactions[a].payer)))+" paid "+c(n(f).displayCurrency(e.transactions[a].currency,e.transactions[a].amount)),1)]),_:2},1024)]),_:2},1024),k(Z,{side:""},{default:u(()=>[n(M).position(e.transactions[a],l.value)>0?(m(),C(E,{key:0,caption:"",style:{color:"green"}},{default:u(()=>[Q(c(n(q).getName(e.selectedPerson))+" lent ",1)]),_:1})):L("",!0),n(M).position(e.transactions[a],l.value)<0?(m(),C(E,{key:1,caption:"",style:{color:"red"}},{default:u(()=>[Q(c(n(q).getName(e.selectedPerson))+" borrowed ",1)]),_:1})):L("",!0),n(M).position(e.transactions[a],l.value)===0?(m(),C(E,{key:2},{default:u(()=>[Q(c(l.value!==e.transactions[a].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(m(),C(E,{key:3,style:ae({color:n(M).position(e.transactions[a],l.value)>=0?"green":"red"})},{default:u(()=>[Q(c(n(f).displayCurrency(e.transactions[a].currency,Math.abs(n(M).position(e.transactions[a],l.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},[e.disableRemove?void 0:{name:"left",fn:u(()=>[k(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{Be as _,Ee as a};
