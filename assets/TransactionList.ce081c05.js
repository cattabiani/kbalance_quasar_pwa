import{a as $,Q as re}from"./QCard.f1721a37.js";import{O as ee,a as L,a7 as f,u as m,P as N,v as C,x as u,L as P,W as c,U as s,V as D,S as F,X as te,am as ae,c as oe,r as E,w as B,J as ie,I as ue,f as ce,o as de,$ as ve,h as W,b as fe,j as me,z as G,aG as J,ab as ge,g as ye,aE as T,y as k,M,Y as X,aH as he,Q as be}from"./index.75363be8.js";import{b as K,a as Z}from"./QMenu.fdbab486.js";import{a as w}from"./PersonItem.7631c322.js";import{Q as Se}from"./QSlideItem.b79d4382.js";import{s as Ie,d as Y,a as U,e as z,g as xe}from"./scroll.09374dc3.js";const Pe={class:"q-pa-md"},qe={key:0,style:{color:"green"}},ke={key:1,style:{color:"red"}},pe={class:"q-pa-md"},je={__name:"SummaryCard",props:{summaries:{type:Object,required:!0},selectedPerson:{type:[String],required:!0}},setup(e){const h=ee(),q=e,n=L(()=>{const{ans:d,totals:o}=q.summaries;return{detail:d.map((l,b)=>({...l,id:b})),totals:o}}),r=L(()=>Object.entries(n.value.totals).filter(([d,o])=>o>0).map(([d,o])=>f.displayCurrency(d,o)).join(" + ")),g=L(()=>Object.entries(n.value.totals).filter(([d,o])=>o<0).map(([d,o])=>f.displayCurrency(d,-o)).join(" + "));return(d,o)=>(m(),N("div",null,[g.value||r.value?(m(),C($,{key:0,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[P("div",Pe,[g.value?(m(),N("div",qe,c(s(h).getName(e.selectedPerson))+" is owed "+c(g.value),1)):D("",!0),r.value?(m(),N("div",ke,c(s(h).getName(e.selectedPerson))+" owes "+c(r.value),1)):D("",!0)])]),_:1})):(m(),C($,{key:1,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>o[0]||(o[0]=[P("div",{class:"q-pa-md"},[P("div",null,"All Settled!")],-1)])),_:1})),n.value&&n.value.detail.length>0?(m(),C($,{key:2,class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[P("div",pe,[(m(!0),N(F,null,te(n.value.detail,t=>(m(),N("div",{key:t.id},[P("div",null,[P("span",null,c(t.amount>0?s(h).getName(e.selectedPerson):s(h).getName(s(h).personIdx2Id(t.person))),1),o[1]||(o[1]=P("span",null," owes ",-1)),P("span",null,c(t.amount<0?s(h).getName(e.selectedPerson):s(h).getName(s(h).personIdx2Id(t.person)))+" \xA0 ",1),P("span",{style:ae({color:t.amount>0?"red":"green"})},c(s(f).displayCurrency(t.currency,Math.abs(t.amount))),5)])]))),128))])]),_:1})):D("",!0)]))}},{passive:Q}=me;var Ne=oe({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:Ie,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(e,{slots:h,emit:q}){const n=E(!1),r=E(!0),g=E(null),d=E(null);let o=e.initialIndex,t,l;const b=L(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function p(){if(e.disable===!0||n.value===!0||r.value===!1)return;const i=Y(t),x=U(t),H=J(t);e.reverse===!1?Math.round(x+H+e.offset)>=Math.round(i)&&O():Math.round(x)<=e.offset&&O()}function O(){if(e.disable===!0||n.value===!0||r.value===!1)return;o++,n.value=!0;const i=Y(t);q("load",o,x=>{r.value===!0&&(n.value=!1,G(()=>{if(e.reverse===!0){const H=Y(t),ne=U(t),le=H-i;z(t,ne+le)}x===!0?A():g.value&&g.value.closest("body")&&l()}))})}function R(){o=0}function V(){r.value===!1&&(r.value=!0,t.addEventListener("scroll",l,Q)),p()}function A(){r.value===!0&&(r.value=!1,n.value=!1,t.removeEventListener("scroll",l,Q),l!==void 0&&l.cancel!==void 0&&l.cancel())}function S(){if(t&&r.value===!0&&t.removeEventListener("scroll",l,Q),t=xe(g.value,e.scrollTarget),r.value===!0){if(t.addEventListener("scroll",l,Q),e.reverse===!0){const i=Y(t),x=J(t);z(t,i-x)}p()}}function v(i){o=i}function a(i){i=parseInt(i,10);const x=l;l=i<=0?p:ge(p,isNaN(i)===!0?100:i),t&&r.value===!0&&(x!==void 0&&t.removeEventListener("scroll",x,Q),t.addEventListener("scroll",l,Q))}function I(i){if(y.value===!0){if(d.value===null){i!==!0&&G(()=>{I(!0)});return}const x=`${n.value===!0?"un":""}pauseAnimations`;Array.from(d.value.getElementsByTagName("svg")).forEach(H=>{H[x]()})}}const y=L(()=>e.disable!==!0&&r.value===!0);B([n,y],()=>{I()}),B(()=>e.disable,i=>{i===!0?A():V()}),B(()=>e.reverse,()=>{n.value===!1&&r.value===!0&&p()}),B(()=>e.scrollTarget,S),B(()=>e.debounce,a);let j=!1;ie(()=>{j!==!1&&t&&z(t,j)}),ue(()=>{j=t?U(t):!1}),ce(()=>{r.value===!0&&t.removeEventListener("scroll",l,Q)}),de(()=>{a(e.debounce),S(),n.value===!1&&I()});const se=ye();return Object.assign(se.proxy,{poll:()=>{l!==void 0&&l()},trigger:O,stop:A,reset:R,resume:V,setIndex:v,updateScrollTarget:S}),()=>{const i=ve(h.default,[]);return y.value===!0&&i[e.reverse===!1?"push":"unshift"](W("div",{ref:d,class:b.value},fe(h.loading))),W("div",{class:"q-infinite-scroll",ref:g},i)}}});const _=20,we={__name:"TransactionList",props:{transactions:{type:Object,required:!0},selectedPerson:{type:String,required:!0},disableRemove:{type:Boolean,default:!1}},emits:["edit","remove"],setup(e,{emit:h}){const q=ee(),n=e,r=E([]),g=E(0),d=E(0),o=S=>{const v=d.value+S;if(v<=0||v>=b.value.length)return!1;const a=b.value[v-1],I=b.value[v],y=n.transactions[a].timestamp,j=n.transactions[I].timestamp;return f.getYear(y)!==f.getYear(j)||f.getMonth(y)!==f.getMonth(j)},t=S=>{const v=d.value+S;if(v<=0||v>=b.value.length)return null;const a=b.value[v],I=b.value[v-1],y=n.transactions[a].timestamp;return f.getYear(n.transactions[I].timestamp)!==f.getYear(y)?`${f.getMonth(y,!1)} ${f.getYear(y)}`:f.getMonth(y,!1)},l=L(()=>q.personId2Idx(n.selectedPerson)),b=L(()=>T.getTransactionList(n.transactions)),p=h,O=S=>{p("edit",S)},R=({reset:S},v)=>{p("remove",()=>S(),v)},V=(S,v)=>{const a=b.value.slice(g.value,g.value+_);r.value.length===0&&(d.value=g.value),r.value.push(...a),g.value+=_,v()},A=L(()=>g.value>=b.value.length);return B(b,()=>{r.value=[],g.value=0,V(0,()=>{})}),(S,v)=>(m(),N("div",null,[k(Ne,{onLoad:V,offset:300,disable:A.value},{default:u(()=>[(m(!0),N(F,null,te(r.value,(a,I)=>(m(),N(F,{key:a},[o(I)?(m(),C(K,{key:0,dense:"",dark:"",class:"bg-secondary text-bold text-white justify-center"},{default:u(()=>[M(c(t(I)),1)]),_:2},1024)):D("",!0),k(Se,{clickable:"",class:X(I%2===0?"bg-grey-3":"bg-white"),onClick:y=>O(a),onLeft:y=>R(y,a),"left-color":"red","read-only":""},he({default:u(()=>[k(K,null,{default:u(()=>[k($,{flat:"",bordered:"",class:"q-ml-sm q-mr-sm q-pl-sm q-pr-sm"},{default:u(()=>[k(re,{class:"column q-pa-none flex justify-center items-center"},{default:u(()=>[P("div",null,c(s(f).getMonth(e.transactions[a].timestamp)),1),P("div",null,c(s(f).getDay(e.transactions[a].timestamp)),1)]),_:2},1024)]),_:2},1024),k(Z,null,{default:u(()=>[k(w,{class:X({"text-grey":s(q).pendingTransactionIds.has(a)})},{default:u(()=>[M(c(s(T).name(e.transactions[a])),1)]),_:2},1032,["class"]),k(w,{caption:""},{default:u(()=>[M(c(s(q).getName(s(q).personId2Idx(e.transactions[a].payer)))+" paid "+c(s(f).displayCurrency(e.transactions[a].currency,e.transactions[a].amount)),1)]),_:2},1024)]),_:2},1024),k(Z,{side:""},{default:u(()=>[s(T).position(e.transactions[a],l.value)>0?(m(),C(w,{key:0,caption:"",style:{color:"green"}},{default:u(()=>[M(c(s(q).getName(e.selectedPerson))+" lent ",1)]),_:1})):D("",!0),s(T).position(e.transactions[a],l.value)<0?(m(),C(w,{key:1,caption:"",style:{color:"red"}},{default:u(()=>[M(c(s(q).getName(e.selectedPerson))+" borrowed ",1)]),_:1})):D("",!0),s(T).position(e.transactions[a],l.value)===0?(m(),C(w,{key:2},{default:u(()=>[M(c(l.value!==e.transactions[a].payer?"Not Involved":"Personal"),1)]),_:2},1024)):(m(),C(w,{key:3,style:ae({color:s(T).position(e.transactions[a],l.value)>=0?"green":"red"})},{default:u(()=>[M(c(s(f).displayCurrency(e.transactions[a].currency,Math.abs(s(T).position(e.transactions[a],l.value)))),1)]),_:2},1032,["style"]))]),_:2},1024)]),_:2},1024)]),_:2},[e.disableRemove?void 0:{name:"left",fn:u(()=>[k(be,{name:"delete"})]),key:"0"}]),1032,["class","onClick","onLeft"])],64))),128))]),_:1},8,["disable"])]))}};export{je as _,we as a};
