import{c as ve,a3 as ye,g as me,a4 as pe,r as P,a as D,ap as re,h as R,Q as be,s as xe,b as Se,D as ae,w as ie,aq as Fe,K as ne,M as A,v as V,y as u,u as $,N as W,O as o,ar as Ve,H as B,P as K,S as Y,I as le,L as De,Z as _,o as Ce,x as S,J as T,A as z,as as Z,T as Ie,U as ke,X as _e}from"./index-CYG2IzWo.js";import{Q as we}from"./QSpace-DOIFWXm_.js";import{Q as $e,a as Ne}from"./QHeader-CZvIJgU3.js";import{f as Pe,j as qe,b as de,Q as oe,a as G}from"./QCard-DI5g04FU.js";import{a as se,b as U,c as q}from"./QItemLabel-DJ4175_z.js";import{Q as Ee,_ as ue}from"./PeopleDropdown-b6ueENDk.js";import{u as Re,a as Me,b as Oe,Q as Te}from"./QPage-y6rv__Ta.js";import{o as Ae,u as Le,Q as Qe}from"./QCheckbox-Dp32kY9C.js";import{C as X}from"./index-BRoRvwsn.js";import{_ as Ge}from"./PersonItem-DUs9hOAU.js";import{_ as te}from"./CurrencyDisplay-CzpuhY6c.js";import{_ as Be}from"./CurrencyDropdown-rasKFJqo.js";import"./QResizeObserver-DH6Lyl8P.js";import"./selection-EuKqAGgH.js";import"./focusout-CObUXZst.js";import"./scroll-sHdrKqgP.js";const ze=()=>R("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[R("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),R("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]),Ue=ve({name:"QRadio",props:{...Re,...ye,...Pe,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(n,{slots:t,emit:e}){const{proxy:r}=me(),i=Me(n,r.$q),g=pe(n,Ae),d=P(null),{refocusTargetEl:f,refocusTarget:l}=Le(n,d),c=D(()=>re(n.modelValue)===re(n.val)),s=D(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(n.disable===!0?" disabled":"")+(i.value===!0?" q-radio--dark":"")+(n.dense===!0?" q-radio--dense":"")+(n.leftLabel===!0?" reverse":"")),a=D(()=>{const b=n.color!==void 0&&(n.keepColor===!0||c.value===!0)?` text-${n.color}`:"";return`q-radio__inner relative-position q-radio__inner--${c.value===!0?"truthy":"falsy"}${b}`}),y=D(()=>(c.value===!0?n.checkedIcon:n.uncheckedIcon)||null),F=D(()=>n.disable===!0?-1:n.tabindex||0),p=D(()=>{const b={type:"radio"};return n.name!==void 0&&Object.assign(b,{".checked":c.value===!0,"^checked":c.value===!0?"checked":void 0,name:n.name,value:n.val}),b}),w=qe(p);function N(b){b!==void 0&&(ae(b),l(b)),n.disable!==!0&&c.value!==!0&&e("update:modelValue",n.val,b)}function k(b){(b.keyCode===13||b.keyCode===32)&&ae(b)}function v(b){(b.keyCode===13||b.keyCode===32)&&N(b)}Object.assign(r,{set:N});const M=ze();return()=>{const b=y.value!==null?[R("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[R(be,{class:"q-radio__icon",name:y.value})])]:[M];n.disable!==!0&&w(b,"unshift"," q-radio__native q-ma-none q-pa-none");const I=[R("div",{class:a.value,style:g.value,"aria-hidden":"true"},b)];f.value!==null&&I.push(f.value);const Q=n.label!==void 0?xe(t.default,[n.label]):Se(t.default);return Q!==void 0&&I.push(R("div",{class:"q-radio__label q-anchor--skip"},Q)),R("div",{ref:d,class:s.value,tabindex:F.value,role:"radio","aria-label":n.label,"aria-checked":c.value===!0?"true":"false","aria-disabled":n.disable===!0?"true":void 0,onClick:N,onKeydown:k,onKeyup:v},I)}}});var L;(function(n){n.symbol="symbol",n.narrowSymbol="narrowSymbol",n.code="code",n.name="name",n.hidden="hidden"})(L||(L={}));var E;(function(n){n.precision="precision",n.thousands="thousands",n.tenThousands="tenThousands",n.millions="millions",n.billions="billions"})(E||(E={}));const H=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),he=n=>n.replace(/^0+(0$|[^0])/,"$1"),J=(n,t)=>(n.match(new RegExp(H(t),"g"))||[]).length,je=(n,t)=>n.substring(0,n.indexOf(t)),fe=[",",".","٫","。"],ce="(0|[1-9]\\d*)";class We{constructor(t){var e,r,i,g,d,f;const{currency:l,currencyDisplay:c,locale:s,precision:a,accountingSign:y,useGrouping:F}=t;this.locale=s,this.options={currency:l,useGrouping:F,style:"currency",currencySign:y?"accounting":void 0,currencyDisplay:c!==L.hidden?c:void 0};const p=new Intl.NumberFormat(s,this.options),w=p.formatToParts(123456);this.currency=(e=w.find(({type:v})=>v==="currency"))===null||e===void 0?void 0:e.value,this.digits=[0,1,2,3,4,5,6,7,8,9].map(v=>v.toLocaleString(s)),this.decimalSymbol=(r=w.find(({type:v})=>v==="decimal"))===null||r===void 0?void 0:r.value,this.groupingSymbol=(i=w.find(({type:v})=>v==="group"))===null||i===void 0?void 0:i.value,this.minusSign=(g=p.formatToParts(-1).find(({type:v})=>v==="minusSign"))===null||g===void 0?void 0:g.value,this.decimalSymbol===void 0?this.minimumFractionDigits=this.maximumFractionDigits=0:typeof a=="number"?this.minimumFractionDigits=this.maximumFractionDigits=a:(this.minimumFractionDigits=(d=a==null?void 0:a.min)!==null&&d!==void 0?d:p.resolvedOptions().minimumFractionDigits,this.maximumFractionDigits=(f=a==null?void 0:a.max)!==null&&f!==void 0?f:p.resolvedOptions().maximumFractionDigits);const N=v=>je(v,this.digits[1]),k=v=>v.substring(v.lastIndexOf(this.decimalSymbol?this.digits[0]:this.digits[1])+1);this.prefix=N(p.format(1)),this.suffix=k(p.format(1)),this.negativePrefix=N(p.format(-1)),this.negativeSuffix=k(p.format(-1))}parse(t){if(t){const e=this.isNegative(t);t=this.normalizeDigits(t),t=this.stripCurrency(t,e),t=this.stripSignLiterals(t);const r=this.decimalSymbol?`(?:${H(this.decimalSymbol)}(\\d*))?`:"",i=this.stripGroupingSeparator(t).match(new RegExp(`^${ce}${r}$`));if(i&&this.isValidIntegerFormat(this.decimalSymbol?t.split(this.decimalSymbol)[0]:t,Number(i[1])))return+`${e?"-":""}${this.onlyDigits(i[1])}.${this.onlyDigits(i[2]||"")}`}return null}isValidIntegerFormat(t,e){const r={...this.options,minimumFractionDigits:0};return[this.stripCurrency(this.normalizeDigits(e.toLocaleString(this.locale,{...r,useGrouping:!0})),!1),this.stripCurrency(this.normalizeDigits(e.toLocaleString(this.locale,{...r,useGrouping:!1})),!1)].includes(t)}format(t,e={minimumFractionDigits:this.minimumFractionDigits,maximumFractionDigits:this.maximumFractionDigits}){return t!=null?t.toLocaleString(this.locale,{...this.options,...e}):""}toFraction(t){return`${this.digits[0]}${this.decimalSymbol}${this.onlyLocaleDigits(t.substring(1)).substring(0,this.maximumFractionDigits)}`}isFractionIncomplete(t){return!!this.normalizeDigits(this.stripGroupingSeparator(t)).match(new RegExp(`^${ce}${H(this.decimalSymbol)}$`))}isNegative(t){return t.startsWith(this.negativePrefix)||this.minusSign===void 0&&(t.startsWith("(")||t.startsWith("-"))||this.minusSign!==void 0&&t.replace("-",this.minusSign).startsWith(this.minusSign)}insertCurrency(t,e){return`${e?this.negativePrefix:this.prefix}${t}${e?this.negativeSuffix:this.suffix}`}stripGroupingSeparator(t){return this.groupingSymbol!==void 0?t.replace(new RegExp(H(this.groupingSymbol),"g"),""):t}stripSignLiterals(t){return this.minusSign!==void 0?t.replace("-",this.minusSign).replace(this.minusSign,""):t.replace(/[-()]/g,"")}stripCurrency(t,e){return t.replace(e?this.negativePrefix:this.prefix,"").replace(e?this.negativeSuffix:this.suffix,"")}normalizeDecimalSeparator(t,e){return fe.forEach(r=>{t=t.substring(0,e)+t.substring(e).replace(r,this.decimalSymbol)}),t}normalizeDigits(t){return this.digits[0]!=="0"&&this.digits.forEach((e,r)=>{t=t.replace(new RegExp(e,"g"),String(r))}),t}onlyDigits(t){return this.normalizeDigits(t).replace(/\D+/g,"")}onlyLocaleDigits(t){return t.replace(new RegExp(`[^${this.digits.join("")}]*`,"g"),"")}}class ge{constructor(t){this.currencyFormat=t}}class Xe extends ge{conformToMask(t,e=""){const r=this.currencyFormat.isNegative(t),i=p=>p===""&&r&&!(this.currencyFormat.minusSign===void 0?e===this.currencyFormat.negativePrefix+this.currencyFormat.negativeSuffix:e===this.currencyFormat.negativePrefix),g=p=>{if(i(p))return"";if(this.currencyFormat.maximumFractionDigits>0){if(this.currencyFormat.isFractionIncomplete(p))return p;if(p.startsWith(this.currencyFormat.decimalSymbol))return this.currencyFormat.toFraction(p)}return null};let d=t;d=this.currencyFormat.stripCurrency(d,r),d=this.currencyFormat.stripSignLiterals(d);const f=g(d);if(f!=null)return this.currencyFormat.insertCurrency(f,r);const[l,...c]=d.split(this.currencyFormat.decimalSymbol),s=he(this.currencyFormat.onlyDigits(l)),a=this.currencyFormat.onlyDigits(c.join("")).substring(0,this.currencyFormat.maximumFractionDigits),y=c.length>0&&a.length===0,F=s===""&&r&&(this.currencyFormat.minusSign===void 0?e===t.slice(0,-2)+this.currencyFormat.negativeSuffix:e===t.slice(0,-1));return y||F||i(s)?e:s.match(/\d+/)?{numberValue:+`${r?"-":""}${s}.${a}`,fractionDigits:a}:""}}class He extends ge{conformToMask(t,e=""){if(t===""||this.currencyFormat.parse(e)===0&&this.currencyFormat.stripCurrency(e,!0).slice(0,-1)===this.currencyFormat.stripCurrency(t,!0))return"";const r=this.currencyFormat.isNegative(t),i=this.currencyFormat.stripSignLiterals(t)===""?-0:+`${r?"-":""}${he(this.currencyFormat.onlyDigits(t))}`/Math.pow(10,this.currencyFormat.maximumFractionDigits);return{numberValue:i,fractionDigits:i.toFixed(this.currencyFormat.maximumFractionDigits).slice(-this.currencyFormat.maximumFractionDigits)}}}const Ye={locale:void 0,currency:void 0,currencyDisplay:void 0,hideGroupingSeparatorOnFocus:!0,hideCurrencySymbolOnFocus:!0,hideNegligibleDecimalDigitsOnFocus:!0,precision:void 0,autoDecimalDigits:!1,valueRange:void 0,useGrouping:void 0,valueScaling:void 0};class Ke{constructor(t){this.el=t.el,this.onInput=t.onInput,this.onChange=t.onChange,this.addEventListener(),this.init(t.options)}setOptions(t){this.init(t),this.format(this.currencyFormat.format(this.validateValueRange(this.numberValue))),this.onChange(this.getValue())}getValue(){return{number:this.valueScaling&&this.numberValue!=null?this.toInteger(this.numberValue,this.valueScaling):this.numberValue,formatted:this.formattedValue}}setValue(t){const e=this.valueScaling!==void 0&&t!=null?this.toFloat(t,this.valueScaling):t;e!==this.numberValue&&(this.format(this.currencyFormat.format(this.validateValueRange(e))),this.onChange(this.getValue()))}init(t){this.options={...Ye,...t},this.options.autoDecimalDigits&&(this.options.hideNegligibleDecimalDigitsOnFocus=!1),this.el.getAttribute("inputmode")||this.el.setAttribute("inputmode",this.options.autoDecimalDigits?"numeric":"decimal"),this.currencyFormat=new We(this.options),this.numberMask=this.options.autoDecimalDigits?new He(this.currencyFormat):new Xe(this.currencyFormat);const e={[E.precision]:this.currencyFormat.maximumFractionDigits,[E.thousands]:3,[E.tenThousands]:4,[E.millions]:6,[E.billions]:9};this.valueScaling=this.options.valueScaling?e[this.options.valueScaling]:void 0,this.valueScalingFractionDigits=this.valueScaling!==void 0&&this.options.valueScaling!==E.precision?this.valueScaling+this.currencyFormat.maximumFractionDigits:this.currencyFormat.maximumFractionDigits,this.minValue=this.getMinValue(),this.maxValue=this.getMaxValue()}getMinValue(){var t,e;let r=this.toFloat(-Number.MAX_SAFE_INTEGER);return((t=this.options.valueRange)===null||t===void 0?void 0:t.min)!==void 0&&(r=Math.max((e=this.options.valueRange)===null||e===void 0?void 0:e.min,this.toFloat(-Number.MAX_SAFE_INTEGER))),r}getMaxValue(){var t,e;let r=this.toFloat(Number.MAX_SAFE_INTEGER);return((t=this.options.valueRange)===null||t===void 0?void 0:t.max)!==void 0&&(r=Math.min((e=this.options.valueRange)===null||e===void 0?void 0:e.max,this.toFloat(Number.MAX_SAFE_INTEGER))),r}toFloat(t,e){return t/Math.pow(10,e!=null?e:this.valueScalingFractionDigits)}toInteger(t,e){return Number(t.toFixed(e!=null?e:this.valueScalingFractionDigits).split(".").join(""))}validateValueRange(t){return t!=null?Math.min(Math.max(t,this.minValue),this.maxValue):t}format(t,e=!1){if(t!=null){this.decimalSymbolInsertedAt!==void 0&&(t=this.currencyFormat.normalizeDecimalSeparator(t,this.decimalSymbolInsertedAt),this.decimalSymbolInsertedAt=void 0);const r=this.numberMask.conformToMask(t,this.formattedValue);let i;if(typeof r=="object"){const{numberValue:g,fractionDigits:d}=r;let{maximumFractionDigits:f,minimumFractionDigits:l}=this.currencyFormat;this.focus?l=e?d.replace(/0+$/,"").length:Math.min(f,d.length):Number.isInteger(g)&&!this.options.autoDecimalDigits&&(this.options.precision===void 0||l===0)&&(l=f=0),i=this.toInteger(Math.abs(g))>Number.MAX_SAFE_INTEGER?this.formattedValue:this.currencyFormat.format(g,{useGrouping:this.options.useGrouping!==!1&&!(this.focus&&this.options.hideGroupingSeparatorOnFocus),minimumFractionDigits:l,maximumFractionDigits:f})}else i=r;this.maxValue<=0&&!this.currencyFormat.isNegative(i)&&this.currencyFormat.parse(i)!==0&&(i=i.replace(this.currencyFormat.prefix,this.currencyFormat.negativePrefix)),this.minValue>=0&&(i=i.replace(this.currencyFormat.negativePrefix,this.currencyFormat.prefix)),(this.options.currencyDisplay===L.hidden||this.focus&&this.options.hideCurrencySymbolOnFocus)&&(i=i.replace(this.currencyFormat.negativePrefix,this.currencyFormat.minusSign!==void 0?this.currencyFormat.minusSign:"(").replace(this.currencyFormat.negativeSuffix,this.currencyFormat.minusSign!==void 0?"":")").replace(this.currencyFormat.prefix,"").replace(this.currencyFormat.suffix,"")),this.el.value=i,this.numberValue=this.currencyFormat.parse(i)}else this.el.value="",this.numberValue=null;this.formattedValue=this.el.value,this.onInput(this.getValue())}addEventListener(){this.el.addEventListener("input",t=>{const{value:e,selectionStart:r}=this.el,i=t;if(r&&i.data&&fe.includes(i.data)&&(this.decimalSymbolInsertedAt=r-1),this.format(e),this.focus&&r!=null){const g=()=>{const{prefix:d,suffix:f,decimalSymbol:l,maximumFractionDigits:c,groupingSymbol:s}=this.currencyFormat;let a=e.length-r;const y=this.formattedValue.length;if(this.currencyFormat.minusSign===void 0&&(e.startsWith("(")||e.startsWith("-"))&&!e.endsWith(")"))return y-this.currencyFormat.negativeSuffix.length>1?this.formattedValue.substring(r).length:1;if(this.formattedValue.substring(r,1)===s&&J(this.formattedValue,s)===J(e,s)+1)return y-a-1;if(y<a)return r;if(l!==void 0&&e.indexOf(l)!==-1){const F=e.indexOf(l)+1;if(Math.abs(y-e.length)>1&&r<=F)return this.formattedValue.indexOf(l)+1;!this.options.autoDecimalDigits&&r>F&&this.currencyFormat.onlyDigits(e.substring(F)).length-1===c&&(a-=1)}return this.options.hideCurrencySymbolOnFocus||this.options.currencyDisplay===L.hidden?y-a:Math.max(y-Math.max(a,f.length),d.length)};this.setCaretPosition(g())}}),this.el.addEventListener("focus",()=>{this.focus=!0,this.numberValueOnFocus=this.numberValue,setTimeout(()=>{const{value:t,selectionStart:e,selectionEnd:r}=this.el;if(this.format(t,this.options.hideNegligibleDecimalDigitsOnFocus),e!=null&&r!=null&&Math.abs(e-r)>0)this.setCaretPosition(0,this.el.value.length);else if(e!=null){const i=this.getCaretPositionOnFocus(t,e);this.setCaretPosition(i)}})}),this.el.addEventListener("blur",()=>{this.focus=!1,this.format(this.currencyFormat.format(this.validateValueRange(this.numberValue))),this.numberValueOnFocus!==this.numberValue&&this.onChange(this.getValue())})}getCaretPositionOnFocus(t,e){if(this.numberValue==null)return e;const{prefix:r,negativePrefix:i,suffix:g,negativeSuffix:d,groupingSymbol:f,currency:l}=this.currencyFormat,c=this.numberValue<0,s=c?i:r,a=s.length;if(this.options.hideCurrencySymbolOnFocus||this.options.currencyDisplay===L.hidden){if(c){if(e<=1)return 1;if(t.endsWith(")")&&e>t.indexOf(")"))return this.formattedValue.length-1}}else{const F=c?d.length:g.length;if(e>=t.length-F)return this.formattedValue.length-F;if(e<a)return a}let y=e;return this.options.hideCurrencySymbolOnFocus&&this.options.currencyDisplay!==L.hidden&&e>=a&&l!==void 0&&s.includes(l)&&(y-=a,c&&(y+=1)),this.options.hideGroupingSeparatorOnFocus&&f!==void 0&&(y-=J(t.substring(0,e),f)),y}setCaretPosition(t,e=t){this.el.setSelectionRange(t,e)}}const Ze=n=>n!=null&&n.matches("input")?n:n==null?void 0:n.querySelector("input");function Je(n,t){var e,r,i,g;let d;const f=P(null),l=P(null),c=P(null),s=me(),a=(s==null?void 0:s.emit)||((r=(e=s==null?void 0:s.proxy)===null||e===void 0?void 0:e.$emit)===null||r===void 0?void 0:r.bind(s==null?void 0:s.proxy)),y=(s==null?void 0:s.props)||((i=s==null?void 0:s.proxy)===null||i===void 0?void 0:i.$props),F=Fe.startsWith("3"),p=F&&((g=s==null?void 0:s.attrs.modelModifiers)===null||g===void 0?void 0:g.lazy),w=D(()=>y==null?void 0:y[F?"modelValue":"value"]),N=F?"update:modelValue":"input",k=p?"update:modelValue":"change";return ie(f,v=>{var M;if(v){const b=Ze((M=v==null?void 0:v.$el)!==null&&M!==void 0?M:v);b?(d=new Ke({el:b,options:n,onInput:I=>{!p&&t!==!1&&w.value!==I.number&&(a==null||a(N,I.number)),c.value=I.number,l.value=I.formatted},onChange:I=>{a==null||a(k,I.number)}}),d.setValue(w.value)):console.error('No input element found. Please make sure that the "inputRef" template ref is properly assigned.')}else d=null}),{inputRef:f,numberValue:c,formattedValue:l,setValue:v=>d==null?void 0:d.setValue(v),setOptions:v=>d==null?void 0:d.setOptions(v)}}const ee={__name:"CurrencyInput",props:{modelValue:Number,currency:String,label:String,alignRight:{type:Boolean,default:!1},bgColor:{type:String,default:""},readonly:{type:Boolean,default:!1}},emits:["change","update:modelValue"],setup(n,{emit:t}){const e=ne(),r=n,{inputRef:i,formattedValue:g,setValue:d}=Je({currency:"XXX",currencyDisplay:"hidden",valueScaling:"precision",valueRange:{min:0,max:void 0},autoSign:!0,locale:"it-CH"});return ie(()=>r.modelValue,f=>{d(f)}),(f,l)=>(V(),A("div",null,[u(de,{ref_key:"inputRef",ref:i,modelValue:o(g),"onUpdate:modelValue":l[0]||(l[0]=c=>Ve(g)?g.value=c:null),outlined:"",label:r.label,onFocus:l[1]||(l[1]=c=>o(i).select()),"input-class":r.alignRight?"text-right":"text-left",readonly:r.readonly,"bg-color":r.bgColor},null,8,["modelValue","label","input-class","readonly","bg-color"]),o(e).referenceCurrency&&r.currency!==o(e).referenceCurrency&&r.modelValue!==0?(V(),$(te,{key:0,currency:o(e).referenceCurrency,amount:o(e).convertCurrency(r.modelValue,r.currency,o(e).referenceCurrency),class:"text-caption text-left q-mt-xs"},null,8,["currency","amount"])):W("",!0)]))}},et={class:"q-gutter-none text-center"},tt={key:0,class:"text-caption"},j={__name:"TwoPeopleSplitRow",props:{split:{type:Boolean,default:!1},payer:{type:Number,required:!0},youIdx:{type:Number,required:!0},otherName:{type:String,required:!0},currency:{type:String,required:!0},amount:{type:Number,required:!0}},setup(n){const t=ne(),e=n,r=D(()=>e.payer===e.youIdx),i=D(()=>e.split?(e.amount+e.amount%2)/2:e.amount),g=D(()=>e.split?r.value?"You paid, split equally":`${e.otherName} paid, split equally`:r.value?"You are owed the full amount":`${e.otherName} is owed the full amount`);return D(()=>r.value?"text-green":"text-red"),(d,f)=>(V(),A("div",et,[B("div",null,K(g.value),1),n.amount>0?(V(),A("div",tt,[r.value?(V(),A(Y,{key:0},[le(K(n.otherName)+" owes you ",1),u(te,{currency:n.currency,amount:i.value,"reference-currency":o(t).referenceCurrency,"converted-amount":o(t).convertCurrency(i.value,n.currency,o(t).referenceCurrency),color:"green","inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])],64)):(V(),A(Y,{key:1},[le(" You owe "+K(n.otherName)+" ",1),u(te,{currency:n.currency,amount:i.value,"reference-currency":o(t).referenceCurrency,"converted-amount":o(t).convertCurrency(i.value,n.currency,o(t).referenceCurrency),color:"red","inline-conversion":""},null,8,["currency","amount","reference-currency","converted-amount"])],64))])):W("",!0)]))}},it={class:"row text-bold items-center no-wrap"},bt={__name:"TransactionPage",setup(n){const t=Oe(),e=ne(),r=De(),i=P(e.getEditableTransaction()),g=P(!1),d=P(null),f=new Set,l=P(_.debtors(i.value));Ce(()=>{var h;(h=d.value)==null||h.focus()});const c=e.currentSheetPeople.findIndex(h=>h===e.user.id),s=D({get:()=>_.credit(i.value),set:h=>{h!==_.credit(i.value)&&(y.value=!1,f.clear(),_.setCredit(i.value,h,a.value>=0?a.value:c,l.value))}}),a=D({get:()=>_.payerIdx(i.value,c),set:h=>{h!==_.payerIdx(i.value,c)&&_.setCredit(i.value,s.value,h,l.value,f)}}),y=P(a.value<0),F=D({get:()=>e.personIdx2Id(a.value)||"",set:h=>{h!==e.personIdx2Id(a.value)&&(f.clear(),a.value=e.personId2Idx(h))}});ie(l,h=>{f.clear(),_.split(i.value,h)},{deep:!0});const p=D({get:()=>{const h=l.value.findIndex(m=>m);return l.value.filter(m=>m).length===1?h:-1},set:h=>{if(h<0||h>=l.value.length)return;let m=l.value.findIndex(x=>x);l.value.filter(x=>x).length!==1&&(m=-1),h!==m&&(l.value=l.value.map((x,C)=>C===h))}}),w=D({get:()=>e.personIdx2Id(p.value)||"",set:h=>{h!==e.personIdx2Id(p.value)&&(p.value=e.personId2Idx(h))}}),N=()=>{p.value!==-1&&a.value!==-1&&a.value!==p.value&&([a.value,p.value]=[p.value,a.value])},k=e.currentSheetPeople.find(h=>h!==e.user.id),v=e.currentSheetPeople.findIndex(h=>h!==e.user.id),M=D(()=>_.state(i.value)),b=h=>{switch(h){case 0:l.value=[!0,!0],a.value=c;break;case 1:l.value=c===0?[!1,!0]:[!0,!1],a.value=c;break;case 2:l.value=[!0,!0],a.value=v;break;case 3:l.value=c===1?[!1,!0]:[!0,!1],a.value=v;break;default:return}},I=()=>{e.transactionId=null,r.go(-1)},Q=async()=>{try{_.check(i.value),await e.addTransaction(i.value),e.transactionId=null,I()}catch(h){t.notify({message:h.message||h,color:"negative"});return}};return(h,m)=>(V(),A(Y,null,[u(Ne,{elevated:"",class:"bg-primary text-white"},{default:S(()=>[u($e,null,{default:S(()=>[u(T,{flat:"",icon:"arrow_back",onClick:I,"aria-label":"Go Back",class:"bg-white text-primary"}),u(we),o(e).currentSheetPeople.map(x=>!o(e).currentSheet.people[x].active).filter(x=>x).length?(V(),$(T,{key:0,flat:"",icon:g.value?"visibility_off":"visibility",label:g.value?"Hide":"Show",onClick:m[0]||(m[0]=x=>g.value=!g.value),class:"q-ml-md bg-white text-primary","aria-label":"Toggle active state"},null,8,["icon","label"])):W("",!0),u(T,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),u(Te,null,{default:S(()=>[u(oe,{class:"q-my-md q-mr-md q-ml-md"},{default:S(()=>[u(G,null,{default:S(()=>[u(de,{ref_key:"nameInput",ref:d,modelValue:i.value.name,"onUpdate:modelValue":m[1]||(m[1]=x=>i.value.name=x),label:"Title",outlined:"",onFocus:m[2]||(m[2]=x=>d.value.select())},null,8,["modelValue"])]),_:1}),u(G,{class:"row",style:{"align-items":"center"}},{default:S(()=>[u(Be,{modelValue:i.value.currency,"onUpdate:modelValue":m[3]||(m[3]=x=>i.value.currency=x),usedCurrencies:o(e).currencies,class:"q-mr-md text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"]),u(ee,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=x=>s.value=x),currency:i.value.currency,style:{flex:"1"},label:"Amount"},null,8,["modelValue","currency"])]),_:1})]),_:1}),u(oe,{class:"q-my-md q-mr-md q-ml-md"},{default:S(()=>[i.value.debts.length===2?(V(),$(G,{key:0,class:"column items-center"},{default:S(()=>[u(Ee,{class:"full-width"},{label:S(()=>[u(j,{split:M.value===1,payer:a.value,"you-idx":o(c),"other-name":o(e).getName(o(k)),currency:i.value.currency,amount:s.value,"reference-currency":o(e).referenceCurrency},null,8,["split","payer","you-idx","other-name","currency","amount","reference-currency"])]),default:S(()=>[u(se,null,{default:S(()=>[z((V(),$(U,{clickable:"",class:"bg-white",onClick:m[5]||(m[5]=x=>b(0))},{default:S(()=>[u(q,null,{default:S(()=>[u(j,{split:"",payer:o(c),"you-idx":o(c),"other-name":o(e).getName(o(k)),currency:i.value.currency,amount:s.value},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[X]]),z((V(),$(U,{clickable:"",class:"bg-grey-3",onClick:m[6]||(m[6]=x=>b(1))},{default:S(()=>[u(q,null,{default:S(()=>[u(j,{payer:o(c),"you-idx":o(c),"other-name":o(e).getName(o(k)),currency:i.value.currency,amount:s.value},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[X]]),z((V(),$(U,{clickable:"",class:"bg-white",onClick:m[7]||(m[7]=x=>b(2))},{default:S(()=>[u(q,null,{default:S(()=>[u(j,{split:"",payer:o(v),"you-idx":o(c),"other-name":o(e).getName(o(k)),currency:i.value.currency,amount:s.value},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[X]]),z((V(),$(U,{clickable:"",class:"bg-grey-3",onClick:m[8]||(m[8]=x=>b(3))},{default:S(()=>[u(q,null,{default:S(()=>[u(j,{payer:o(v),"you-idx":o(c),"other-name":o(e).getName(o(k)),currency:i.value.currency,amount:s.value},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[X]])]),_:1})]),_:1})]),_:1})):W("",!0),l.value.length>2?(V(),$(G,{key:1,class:"row justify-center items-center no-wrap"},{default:S(()=>[u(ue,{class:"col-auto q-mr-sm",modelValue:F.value,"onUpdate:modelValue":m[9]||(m[9]=x=>F.value=x),people:o(e).currentSheet.people,"sorted-people":o(e).currentSheetPeople,"fixed-label":"Payer",dense:""},null,8,["modelValue","people","sorted-people"]),u(T,{class:"col-auto q-mr-sm",icon:"swap_horiz",onClick:N}),u(ue,{class:"col-auto",modelValue:w.value,"onUpdate:modelValue":m[10]||(m[10]=x=>w.value=x),people:o(e).currentSheet.people,"sorted-people":o(e).currentSheetPeople,"fixed-label":"Debtor",dense:""},null,8,["modelValue","people","sorted-people"])]),_:1})):W("",!0),u(G,{class:"row justify-center items-center"},{default:S(()=>[u(T,{flat:"",icon:"done",label:"Cancel",onClick:Q,class:"q-mr-md bg-red text-white","aria-label":"Save"}),u(T,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),u(G,null,{default:S(()=>[B("div",it,[B("div",{class:"row items-center q-ml-sm q-mr-md",style:Z(`flex: 0 0 ${y.value?18:5}%`)},[u(T,{dense:"",onClick:m[11]||(m[11]=x=>y.value=!y.value),label:"Payer",class:"text-bold","aria-label":"Toggle payer mode"})],4),m[13]||(m[13]=B("div",{style:{flex:"1 0 30%","text-align":"left"}},"Person",-1)),m[14]||(m[14]=B("div",{style:{flex:"0 0 10%","text-align":"center"}},"Owes",-1)),m[15]||(m[15]=B("div",{style:{flex:"0 0 32%","text-align":"right"}},"Amount",-1))])]),_:1}),u(se,{class:"q-my-md q-mr-md q-ml-md"},{default:S(()=>[(V(!0),A(Y,null,Ie(o(e).currentSheetPeople,(x,C)=>z((V(),$(U,{key:C,class:ke([C%2===0?"bg-grey-1":"bg-white","row no-wrap items-center"])},{default:S(()=>[u(q,{side:"",style:Z(`flex: 0 0 ${y.value?25:5}%; text-align: left`),class:"q-pa-none"},{default:S(()=>[y.value?(V(),$(ee,{key:1,"model-value":i.value.credits[C],currency:i.value.currency,dense:"","onUpdate:modelValue":O=>{o(f).clear(),o(_).setCustomCredit(i.value,O,C,l.value)}},null,8,["model-value","currency","onUpdate:modelValue"])):(V(),$(Ue,{key:0,modelValue:a.value,"onUpdate:modelValue":m[12]||(m[12]=O=>a.value=O),val:C,dense:""},null,8,["modelValue","val"]))]),_:2},1032,["style"]),u(q,{style:Z(`
    flex: 1 0 ${y.value?25:50}%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-align: right;
  `)},{default:S(()=>[u(Ge,{id:x},null,8,["id"])]),_:2},1032,["style"]),u(q,{side:"",style:{flex:"0 0 5%","text-align":"center","margin-right":"6px"}},{default:S(()=>[u(Qe,{modelValue:l.value[C],"onUpdate:modelValue":O=>l.value[C]=O,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(q,{side:"",style:{flex:"0 0 35%"}},{default:S(()=>[u(ee,{"model-value":i.value.debts[C],currency:i.value.currency,dense:"",readonly:!l.value[C],"onUpdate:modelValue":O=>o(_).setCustomDebt(i.value,O,C,l.value,o(f),o(c)),"bg-color":o(f).has(C)?"green-1":""},null,8,["model-value","currency","readonly","onUpdate:modelValue","bg-color"])]),_:2},1024)]),_:2},1032,["class"])),[[_e,o(e).currentSheet.people[x].active||g.value||a.value===C||i.value.debts[C]!==0||l.value[C]]])),128))]),_:1})]),_:1})],64))}};export{bt as default};
