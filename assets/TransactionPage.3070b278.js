import{r as P,a as c,h as f,c as le,aJ as ne,aK as re,Q as oe,s as ue,b as se,g as ie,E as X,aL as N,u as k,P as R,L as O,W as Y,S as K,M as J,y as r,V as H,O as xe,o as he,x as s,T as ke,N as A,U as i,v as D,C as L,X as qe,aD as j,Y as we,am as Ve}from"./index.6c9dbb9d.js";import{Q as Ie}from"./QSpace.ec22de2b.js";import{Q as Ce,a as _e}from"./QHeader.aa67bcc9.js";import{f as ce,g as de,a as W,Q as E,b as Se}from"./QCard.286ea9ca.js";import{b as F,a as $}from"./QMenu.5bc3788b.js";import{Q as Z,_ as $e}from"./PersonItem.2b58404e.js";import{Q as Ne,_ as ee}from"./PeopleDropdown.5a2587c3.js";import{u as me,a as ve,Q as Qe,b as Be}from"./QPage.356567f5.js";import{C as M}from"./index.1accded2.js";import{_ as te}from"./CurrencyInput.5644c84d.js";import{_ as De}from"./CurrencyDropdown.8b9e65e9.js";import{_ as ae}from"./CurrencyDisplay.42b4d706.js";import"./QResizeObserver.eaf11141.js";import"./selection.4f31b2ee.js";import"./focusout.99986f41.js";import"./scroll.e304a2b9.js";function fe(a,d){const e=P(null),x=c(()=>a.disable===!0?null:f("span",{ref:e,class:"no-outline",tabindex:-1}));function t(m){const y=d.value;m!==void 0&&m.type.indexOf("key")===0?y!==null&&document.activeElement!==y&&y.contains(document.activeElement)===!0&&y.focus():e.value!==null&&(m===void 0||y!==null&&y.contains(m.target)===!0)&&e.value.focus()}return{refocusTargetEl:x,refocusTarget:t}}var be={xs:30,sm:35,md:40,lg:50,xl:60};const Pe=()=>f("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[f("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),f("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var Te=le({name:"QRadio",props:{...me,...ne,...ce,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(a,{slots:d,emit:e}){const{proxy:x}=ie(),t=ve(a,x.$q),m=re(a,be),y=P(null),{refocusTargetEl:I,refocusTarget:C}=fe(a,y),p=c(()=>N(a.modelValue)===N(a.val)),U=c(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(a.disable===!0?" disabled":"")+(t.value===!0?" q-radio--dark":"")+(a.dense===!0?" q-radio--dense":"")+(a.leftLabel===!0?" reverse":"")),_=c(()=>{const l=a.color!==void 0&&(a.keepColor===!0||p.value===!0)?` text-${a.color}`:"";return`q-radio__inner relative-position q-radio__inner--${p.value===!0?"truthy":"falsy"}${l}`}),g=c(()=>(p.value===!0?a.checkedIcon:a.uncheckedIcon)||null),b=c(()=>a.disable===!0?-1:a.tabindex||0),h=c(()=>{const l={type:"radio"};return a.name!==void 0&&Object.assign(l,{".checked":p.value===!0,"^checked":p.value===!0?"checked":void 0,name:a.name,value:a.val}),l}),q=de(h);function S(l){l!==void 0&&(X(l),C(l)),a.disable!==!0&&p.value!==!0&&e("update:modelValue",a.val,l)}function w(l){(l.keyCode===13||l.keyCode===32)&&X(l)}function T(l){(l.keyCode===13||l.keyCode===32)&&S(l)}Object.assign(x,{set:S});const Q=Pe();return()=>{const l=g.value!==null?[f("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[f(oe,{class:"q-radio__icon",name:g.value})])]:[Q];a.disable!==!0&&q(l,"unshift"," q-radio__native q-ma-none q-pa-none");const n=[f("div",{class:_.value,style:m.value,"aria-hidden":"true"},l)];I.value!==null&&n.push(I.value);const o=a.label!==void 0?ue(d.default,[a.label]):se(d.default);return o!==void 0&&n.push(f("div",{class:"q-radio__label q-anchor--skip"},o)),f("div",{ref:y,class:U.value,tabindex:b.value,role:"radio","aria-label":a.label,"aria-checked":p.value===!0?"true":"false","aria-disabled":a.disable===!0?"true":void 0,onClick:S,onKeydown:w,onKeyup:T},n)}}});const Ae={...me,...ne,...ce,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:a=>a==="tf"||a==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},Ee=["update:modelValue"];function Oe(a,d){const{props:e,slots:x,emit:t,proxy:m}=ie(),{$q:y}=m,I=ve(e,y),C=P(null),{refocusTargetEl:p,refocusTarget:U}=fe(e,C),_=re(e,be),g=c(()=>e.val!==void 0&&Array.isArray(e.modelValue)),b=c(()=>{const u=N(e.val);return g.value===!0?e.modelValue.findIndex(B=>N(B)===u):-1}),h=c(()=>g.value===!0?b.value!==-1:N(e.modelValue)===N(e.trueValue)),q=c(()=>g.value===!0?b.value===-1:N(e.modelValue)===N(e.falseValue)),S=c(()=>h.value===!1&&q.value===!1),w=c(()=>e.disable===!0?-1:e.tabindex||0),T=c(()=>`q-${a} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+(I.value===!0?` q-${a}--dark`:"")+(e.dense===!0?` q-${a}--dense`:"")+(e.leftLabel===!0?" reverse":"")),Q=c(()=>{const u=h.value===!0?"truthy":q.value===!0?"falsy":"indet",B=e.color!==void 0&&(e.keepColor===!0||(a==="toggle"?h.value===!0:q.value!==!0))?` text-${e.color}`:"";return`q-${a}__inner relative-position non-selectable q-${a}__inner--${u}${B}`}),l=c(()=>{const u={type:"checkbox"};return e.name!==void 0&&Object.assign(u,{".checked":h.value,"^checked":h.value===!0?"checked":void 0,name:e.name,value:g.value===!0?e.val:e.trueValue}),u}),n=de(l),o=c(()=>{const u={tabindex:w.value,role:a==="toggle"?"switch":"checkbox","aria-label":e.label,"aria-checked":S.value===!0?"mixed":h.value===!0?"true":"false"};return e.disable===!0&&(u["aria-disabled"]="true"),u});function v(u){u!==void 0&&(X(u),U(u)),e.disable!==!0&&t("update:modelValue",V(),u)}function V(){if(g.value===!0){if(h.value===!0){const u=e.modelValue.slice();return u.splice(b.value,1),u}return e.modelValue.concat([e.val])}if(h.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(q.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function ye(u){(u.keyCode===13||u.keyCode===32)&&X(u)}function pe(u){(u.keyCode===13||u.keyCode===32)&&v(u)}const ge=d(h,S);return Object.assign(m,{toggle:v}),()=>{const u=ge();e.disable!==!0&&n(u,"unshift",` q-${a}__native absolute q-ma-none q-pa-none`);const B=[f("div",{class:Q.value,style:_.value,"aria-hidden":"true"},u)];p.value!==null&&B.push(p.value);const G=e.label!==void 0?ue(x.default,[e.label]):se(x.default);return G!==void 0&&B.push(f("div",{class:`q-${a}__label q-anchor--skip`},G)),f("div",{ref:C,class:T.value,...o.value,onClick:v,onKeydown:ye,onKeyup:pe},B)}}const Re=()=>f("div",{key:"svg",class:"q-checkbox__bg absolute"},[f("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[f("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),f("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]);var Ue=le({name:"QCheckbox",props:Ae,emits:Ee,setup(a){const d=Re();function e(x,t){const m=c(()=>(x.value===!0?a.checkedIcon:t.value===!0?a.indeterminateIcon:a.uncheckedIcon)||null);return()=>m.value!==null?[f("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[f(oe,{class:"q-checkbox__icon",name:m.value})])]:[d]}return Oe("checkbox",e)}});const Le={class:"q-gutter-none text-center"},je={key:0,class:"text-caption"},z={__name:"TwoPeopleSplitRow",props:{split:{type:Boolean,default:!1},payer:{type:Number,required:!0},youIdx:{type:Number,required:!0},otherName:{type:String,required:!0},currency:{type:String,required:!0},amount:{type:Number,required:!0},referenceCurrency:{type:String,default:null},conversionRatio:{type:Number,default:1}},setup(a){const d=a,e=c(()=>d.payer===d.youIdx),x=c(()=>d.split?(d.amount+d.amount%2)/2:d.amount),t=c(()=>d.split?e.value?"You paid, split equally":`${d.otherName} paid, split equally`:e.value?"You are owed the full amount":`${d.otherName} is owed the full amount`);return c(()=>e.value?"text-green":"text-red"),(m,y)=>(k(),R("div",Le,[O("div",null,Y(t.value),1),a.amount>0?(k(),R("div",je,[e.value?(k(),R(K,{key:0},[J(Y(a.otherName)+" owes you ",1),r(ae,{currency:a.currency,amount:x.value,"reference-currency":a.referenceCurrency,"conversion-ratio":a.conversionRatio,color:"green","inline-conversion":""},null,8,["currency","amount","reference-currency","conversion-ratio"])],64)):(k(),R(K,{key:1},[J(" You owe "+Y(a.otherName)+" ",1),r(ae,{currency:a.currency,amount:x.value,"reference-currency":a.referenceCurrency,"conversion-ratio":a.conversionRatio,color:"red","inline-conversion":""},null,8,["currency","amount","reference-currency","conversion-ratio"])],64))])):H("",!0)]))}},rt={__name:"TransactionPage",setup(a){const d=Be(),e=xe(),x=ke(),t=P(e.getEditableTransaction()),m=P(!1),y=P(null),I=P(!1);he(()=>{var l;(l=y.value)==null||l.focus()});const C=c({get:()=>e.personIdx2Id(t.value.payer)||"",set:l=>{t.value.payer=e.personId2Idx(l)}}),p=c({get:()=>{const l=t.value.debts.map((n,o)=>n.isDebtor?o:-1).filter(n=>n!==-1);return l.length===1?e.personIdx2Id(l[0]):null},set:l=>{const n=e.personId2Idx(l);t.value.debts.forEach((o,v)=>{o.isDebtor=v===n}),w(!1)}}),U=()=>{if(p.value!==null){if(C.value===p.value)return;const l=e.personId2Idx(C.value),n=e.personId2Idx(p.value);t.value.payer=n,t.value.debts.forEach((o,v)=>{o.isDebtor=v===l}),w(!1)}},_=e.currentSheetPeople.find(l=>l!==e.user.id),g=e.currentSheetPeople.findIndex(l=>l!==e.user.id),b=e.currentSheetPeople.findIndex(l=>l===e.user.id),h=c(()=>j.state(t.value)),q=l=>{switch(l){case 0:t.value.payer=b,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 1:t.value.payer=b,t.value.debts[b].isDebtor=!1,t.value.debts[g].isDebtor=!0;break;case 2:t.value.payer=g,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 3:t.value.payer=g,t.value.debts[b].isDebtor=!0,t.value.debts[g].isDebtor=!1;break;default:return}w(!0)},S=l=>{I.value||(I.value=!0,j.clearOwedAmounts(t.value,l)),j.fillLastOwedAmount(t.value)&&d.notify("The amount has been increased to match the sum of the shares.")},w=l=>{(l||!I.value)&&(I.value=!1,j.split(t.value))},T=()=>{e.transactionId=null,x.go(-1)},Q=async()=>{try{j.check(t.value),await e.addTransaction(t.value),e.transactionId=null,T()}catch(l){d.notify({message:l.message||l,color:"negative"});return}};return(l,n)=>(k(),R(K,null,[r(Ce,{elevated:"",class:"bg-primary text-white"},{default:s(()=>[r(_e,null,{default:s(()=>[r(A,{flat:"",icon:"arrow_back",onClick:T,"aria-label":"Go Back",class:"bg-white text-primary"}),r(Ie),r(A,{flat:"",icon:m.value?"visibility_off":"visibility",label:m.value?"Hide":"Show",onClick:n[0]||(n[0]=o=>m.value=!m.value),class:"q-ml-md bg-white text-primary","aria-label":"Toggle active state"},null,8,["icon","label"]),r(A,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),r(Qe,null,{default:s(()=>[r(W,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[r(E,null,{default:s(()=>[r(Se,{ref_key:"nameInput",ref:y,modelValue:t.value.name,"onUpdate:modelValue":n[1]||(n[1]=o=>t.value.name=o),label:"Transaction Name",outlined:"",onFocus:n[2]||(n[2]=o=>y.value.select())},null,8,["modelValue"])]),_:1}),r(E,{class:"row",style:{"align-items":"center"}},{default:s(()=>[r(De,{modelValue:t.value.currency,"onUpdate:modelValue":n[3]||(n[3]=o=>t.value.currency=o),usedCurrencies:i(e).currencies,class:"q-mr-md text-subtitle1 full-height"},null,8,["modelValue","usedCurrencies"]),r(te,{modelValue:t.value.amount,"onUpdate:modelValue":[n[4]||(n[4]=o=>t.value.amount=o),n[5]||(n[5]=o=>w(!0))],currency:"XXX",style:{flex:"1"},label:"Amount"},null,8,["modelValue"])]),_:1})]),_:1}),r(W,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[t.value.debts.length===2?(k(),D(E,{key:0,class:"column items-center"},{default:s(()=>[r(Ne,{class:"full-width"},{label:s(()=>[r(z,{split:h.value===1,payer:t.value.payer,"you-idx":i(b),"other-name":i(e).getName(i(_)),currency:t.value.currency,amount:t.value.amount},null,8,["split","payer","you-idx","other-name","currency","amount"])]),default:s(()=>[r(Z,null,{default:s(()=>[L((k(),D(F,{clickable:"",class:"bg-white",onClick:n[6]||(n[6]=o=>q(0))},{default:s(()=>[r($,null,{default:s(()=>[r(z,{split:"",payer:i(b),"you-idx":i(b),"other-name":i(e).getName(i(_)),currency:t.value.currency,amount:t.value.amount},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[M]]),L((k(),D(F,{clickable:"",class:"bg-grey-3",onClick:n[7]||(n[7]=o=>q(1))},{default:s(()=>[r($,null,{default:s(()=>[r(z,{payer:i(b),"you-idx":i(b),"other-name":i(e).getName(i(_)),currency:t.value.currency,amount:t.value.amount},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[M]]),L((k(),D(F,{clickable:"",class:"bg-white",onClick:n[8]||(n[8]=o=>q(2))},{default:s(()=>[r($,null,{default:s(()=>[r(z,{split:"",payer:i(g),"you-idx":i(b),"other-name":i(e).getName(i(_)),currency:t.value.currency,amount:t.value.amount},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[M]]),L((k(),D(F,{clickable:"",class:"bg-grey-3",onClick:n[9]||(n[9]=o=>q(3))},{default:s(()=>[r($,null,{default:s(()=>[r(z,{payer:i(g),"you-idx":i(b),"other-name":i(e).getName(i(_)),currency:t.value.currency,amount:t.value.amount},null,8,["payer","you-idx","other-name","currency","amount"])]),_:1})]),_:1})),[[M]])]),_:1})]),_:1})]),_:1})):H("",!0),t.value.debts.length>2?(k(),D(E,{key:1,class:"row justify-center items-center no-wrap"},{default:s(()=>[r(ee,{class:"col-auto q-mr-sm",modelValue:C.value,"onUpdate:modelValue":n[10]||(n[10]=o=>C.value=o),people:i(e).currentSheet.people,"sorted-people":i(e).currentSheetPeople,"fixed-label":"Payer",dense:""},null,8,["modelValue","people","sorted-people"]),r(A,{class:"col-auto q-mr-sm",icon:"swap_horiz",onClick:U}),r(ee,{class:"col-auto",modelValue:p.value,"onUpdate:modelValue":n[11]||(n[11]=o=>p.value=o),people:i(e).currentSheet.people,"sorted-people":i(e).currentSheetPeople,"fixed-label":"Debtor",dense:""},null,8,["modelValue","people","sorted-people"])]),_:1})):H("",!0),r(E,{class:"row justify-center items-center"},{default:s(()=>[r(A,{flat:"",icon:"done",label:"Cancel",onClick:Q,class:"q-mr-md bg-red text-white","aria-label":"Save"}),r(A,{flat:"",icon:"done",label:"Confirm",onClick:Q,class:"bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),r(E,null,{default:s(()=>n[15]||(n[15]=[O("div",{class:"row text-bold items-center no-wrap"},[O("div",{style:{flex:"0 0 5%","text-align":"left"},class:"q-ml-sm q-mr-md"}," Payer "),O("div",{style:{flex:"1 0 30%","text-align":"left"}},"Person"),O("div",{style:{flex:"0 0 10%","text-align":"center"}},"Owes"),O("div",{style:{flex:"0 0 32%","text-align":"right"}},"Amount")],-1)])),_:1}),r(Z,{class:"q-my-md q-mr-md q-ml-md"},{default:s(()=>[(k(!0),R(K,null,qe(i(e).currentSheetPeople,(o,v)=>L((k(),D(F,{key:v,class:we([v%2===0?"bg-grey-1":"bg-white","row no-wrap items-center"])},{default:s(()=>[r($,{side:"",style:{flex:"0 0 5%","text-align":"left"}},{default:s(()=>[r(Te,{modelValue:t.value.payer,"onUpdate:modelValue":[n[12]||(n[12]=V=>t.value.payer=V),n[13]||(n[13]=V=>w(!1))],val:v,dense:""},null,8,["modelValue","val"])]),_:2},1024),r($,{style:{flex:"1 0 50%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","text-align":"right"}},{default:s(()=>[r($e,{id:o},null,8,["id"])]),_:2},1024),r($,{side:"",style:{flex:"0 0 5%","text-align":"center","margin-right":"6px"}},{default:s(()=>[r(Ue,{modelValue:t.value.debts[v].isDebtor,"onUpdate:modelValue":[V=>t.value.debts[v].isDebtor=V,n[14]||(n[14]=V=>w(!0))],dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r($,{side:"",style:{flex:"0 0 35%"}},{default:s(()=>[r(te,{modelValue:t.value.debts[v].owedAmount,"onUpdate:modelValue":V=>t.value.debts[v].owedAmount=V,currency:"XXX",dense:"",style:{width:"auto","min-width":"4ch"},onBlur:V=>S(v)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1032,["class"])),[[Ve,i(e).currentSheet.people[o].active||m.value||t.value.payer===v||t.value.debts[v].owedAmount!==0||t.value.debts[v].isDebtor]])),128))]),_:1})]),_:1})],64))}};export{rt as default};
