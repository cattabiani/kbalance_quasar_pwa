import{r as U,a as c,h as m,c as oe,aJ as ne,aK as se,Q as ue,s as re,b as ie,g as ce,E as Y,aL as T,O as ye,o as ke,u as h,P as N,y as n,x as r,S as J,T as xe,N as L,U as p,v as E,L as y,W as S,Y as Z,V as O,C as z,X as he,aD as X,am as _e}from"./index.a930c1a4.js";import{Q as qe}from"./QSpace.9091618a.js";import{Q as Ve,a as Ie}from"./QHeader.420e802e.js";import{f as de,g as ve,a as G,Q as j,b as Ce}from"./QCard.1b962dd7.js";import{b as M,a as K}from"./QMenu.25bcbaf0.js";import{Q as ee,_ as we}from"./PersonItem.49508055.js";import{Q as Se,_ as te}from"./PeopleDropdown.d4bda477.js";import{u as me,a as fe,Q as $e,b as Qe}from"./QPage.69334f9a.js";import{_ as De,C as H}from"./CurrencyDropdown.578e0f19.js";import{_ as ae}from"./CurrencyInput.226ebf4e.js";import{U as le}from"./utils.ca14db4f.js";import"./QResizeObserver.1c92ded4.js";import"./selection.9faa8b76.js";import"./focusout.dedc06ce.js";import"./scroll.43ca7a4e.js";function be(l,V){const e=U(null),I=c(()=>l.disable===!0?null:m("span",{ref:e,class:"no-outline",tabindex:-1}));function t(d){const k=V.value;d!==void 0&&d.type.indexOf("key")===0?k!==null&&document.activeElement!==k&&k.contains(document.activeElement)===!0&&k.focus():e.value!==null&&(d===void 0||k!==null&&k.contains(d.target)===!0)&&e.value.focus()}return{refocusTargetEl:I,refocusTarget:t}}var ge={xs:30,sm:35,md:40,lg:50,xl:60};const Be=()=>m("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[m("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),m("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var Pe=oe({name:"QRadio",props:{...me,...ne,...de,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(l,{slots:V,emit:e}){const{proxy:I}=ce(),t=fe(l,I.$q),d=se(l,ge),k=U(null),{refocusTargetEl:$,refocusTarget:Q}=be(l,k),g=c(()=>T(l.modelValue)===T(l.val)),F=c(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(l.disable===!0?" disabled":"")+(t.value===!0?" q-radio--dark":"")+(l.dense===!0?" q-radio--dense":"")+(l.leftLabel===!0?" reverse":"")),B=c(()=>{const i=l.color!==void 0&&(l.keepColor===!0||g.value===!0)?` text-${l.color}`:"";return`q-radio__inner relative-position q-radio__inner--${g.value===!0?"truthy":"falsy"}${i}`}),f=c(()=>(g.value===!0?l.checkedIcon:l.uncheckedIcon)||null),v=c(()=>l.disable===!0?-1:l.tabindex||0),x=c(()=>{const i={type:"radio"};return l.name!==void 0&&Object.assign(i,{".checked":g.value===!0,"^checked":g.value===!0?"checked":void 0,name:l.name,value:l.val}),i}),_=ve(x);function q(i){i!==void 0&&(Y(i),Q(i)),l.disable!==!0&&g.value!==!0&&e("update:modelValue",l.val,i)}function P(i){(i.keyCode===13||i.keyCode===32)&&Y(i)}function R(i){(i.keyCode===13||i.keyCode===32)&&q(i)}Object.assign(I,{set:q});const C=Be();return()=>{const i=f.value!==null?[m("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[m(ue,{class:"q-radio__icon",name:f.value})])]:[C];l.disable!==!0&&_(i,"unshift"," q-radio__native q-ma-none q-pa-none");const D=[m("div",{class:B.value,style:d.value,"aria-hidden":"true"},i)];$.value!==null&&D.push($.value);const o=l.label!==void 0?re(V.default,[l.label]):ie(V.default);return o!==void 0&&D.push(m("div",{class:"q-radio__label q-anchor--skip"},o)),m("div",{ref:k,class:F.value,tabindex:v.value,role:"radio","aria-label":l.label,"aria-checked":g.value===!0?"true":"false","aria-disabled":l.disable===!0?"true":void 0,onClick:q,onKeydown:P,onKeyup:R},D)}}});const Te={...me,...ne,...de,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:l=>l==="tf"||l==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},Ae=["update:modelValue"];function Ne(l,V){const{props:e,slots:I,emit:t,proxy:d}=ce(),{$q:k}=d,$=fe(e,k),Q=U(null),{refocusTargetEl:g,refocusTarget:F}=be(e,Q),B=se(e,ge),f=c(()=>e.val!==void 0&&Array.isArray(e.modelValue)),v=c(()=>{const u=T(e.val);return f.value===!0?e.modelValue.findIndex(A=>T(A)===u):-1}),x=c(()=>f.value===!0?v.value!==-1:T(e.modelValue)===T(e.trueValue)),_=c(()=>f.value===!0?v.value===-1:T(e.modelValue)===T(e.falseValue)),q=c(()=>x.value===!1&&_.value===!1),P=c(()=>e.disable===!0?-1:e.tabindex||0),R=c(()=>`q-${l} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+($.value===!0?` q-${l}--dark`:"")+(e.dense===!0?` q-${l}--dense`:"")+(e.leftLabel===!0?" reverse":"")),C=c(()=>{const u=x.value===!0?"truthy":_.value===!0?"falsy":"indet",A=e.color!==void 0&&(e.keepColor===!0||(l==="toggle"?x.value===!0:_.value!==!0))?` text-${e.color}`:"";return`q-${l}__inner relative-position non-selectable q-${l}__inner--${u}${A}`}),i=c(()=>{const u={type:"checkbox"};return e.name!==void 0&&Object.assign(u,{".checked":x.value,"^checked":x.value===!0?"checked":void 0,name:e.name,value:f.value===!0?e.val:e.trueValue}),u}),D=ve(i),o=c(()=>{const u={tabindex:P.value,role:l==="toggle"?"switch":"checkbox","aria-label":e.label,"aria-checked":q.value===!0?"mixed":x.value===!0?"true":"false"};return e.disable===!0&&(u["aria-disabled"]="true"),u});function a(u){u!==void 0&&(Y(u),F(u)),e.disable!==!0&&t("update:modelValue",s(),u)}function s(){if(f.value===!0){if(x.value===!0){const u=e.modelValue.slice();return u.splice(v.value,1),u}return e.modelValue.concat([e.val])}if(x.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(_.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function b(u){(u.keyCode===13||u.keyCode===32)&&Y(u)}function w(u){(u.keyCode===13||u.keyCode===32)&&a(u)}const pe=V(x,q);return Object.assign(d,{toggle:a}),()=>{const u=pe();e.disable!==!0&&D(u,"unshift",` q-${l}__native absolute q-ma-none q-pa-none`);const A=[m("div",{class:C.value,style:B.value,"aria-hidden":"true"},u)];g.value!==null&&A.push(g.value);const W=e.label!==void 0?re(I.default,[e.label]):ie(I.default);return W!==void 0&&A.push(m("div",{class:`q-${l}__label q-anchor--skip`},W)),m("div",{ref:Q,class:R.value,...o.value,onClick:a,onKeydown:b,onKeyup:w},A)}}const Ee=()=>m("div",{key:"svg",class:"q-checkbox__bg absolute"},[m("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[m("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),m("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]);var Oe=oe({name:"QCheckbox",props:Te,emits:Ae,setup(l){const V=Ee();function e(I,t){const d=c(()=>(I.value===!0?l.checkedIcon:t.value===!0?l.indeterminateIcon:l.uncheckedIcon)||null);return()=>d.value!==null?[m("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[m(ue,{class:"q-checkbox__icon",name:d.value})])]:[V]}return Ne("checkbox",e)}});const Ue={class:"q-gutter-none"},Le={class:"text-center"},je={class:"q-gutter-none"},Fe={class:"text-center"},Re={key:0,class:"text-center text-caption text-green"},ze={class:"q-gutter-none"},Xe={class:"text-center"},Me={key:0,class:"text-center text-caption text-green"},Ke={class:"q-gutter-none"},He={class:"text-center"},Ye={key:0,class:"text-center text-caption text-red"},Ge={class:"q-gutter-none"},We={class:"text-center"},Je={key:0,class:"text-center text-caption text-red"},Ze={class:"q-mr-sx",style:{display:"flex"}},bt={__name:"TransactionPage",setup(l){const V=Qe(),e=ye(),I=xe(),t=U(e.getEditableTransaction()),d=U(!1),k=U(null),$=U(!1);ke(()=>{var o;(o=k.value)==null||o.focus()});const Q=c({get:()=>e.personIdx2Id(t.value.payer)||"",set:o=>{t.value.payer=e.personId2Idx(o)}}),g=c({get:()=>{const o=t.value.debts.map((a,s)=>a.isDebtor?s:-1).filter(a=>a!==-1);return o.length===1?e.personIdx2Id(o[0]):null},set:o=>{const a=e.personId2Idx(o);t.value.debts.forEach((s,b)=>{s.isDebtor=b===a}),C(!1)}}),F=()=>{if(g.value!==null){if(Q.value===g.value)return;const o=e.personId2Idx(Q.value),a=e.personId2Idx(g.value);t.value.payer=a,t.value.debts.forEach((s,b)=>{s.isDebtor=b===o}),C(!1)}},B=e.currentSheetPeople.find(o=>o!==e.user.id),f=e.currentSheetPeople.findIndex(o=>o!==e.user.id),v=e.currentSheetPeople.findIndex(o=>o===e.user.id),x=c(()=>X.state(t.value)),_=(o,a)=>{switch(o){case 0:return(a===v?"You are":`${e.getName(B)} is`)+" owed the full amount";case 1:return(a===v?"You":e.getName(B))+" paid, split equally";default:return"Custom"}},q=(o,a)=>{const s=o===0?t.value.amount:(t.value.amount+t.value.amount%2)/2;return a===v?`${e.getName(B)} owes you ${le.displayCurrency(t.value.currency,s)}`:`You owe ${e.getName(B)} ${le.displayCurrency(t.value.currency,s)}`},P=o=>{switch(o){case 0:t.value.payer=v,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 1:t.value.payer=v,t.value.debts[v].isDebtor=!1,t.value.debts[f].isDebtor=!0;break;case 2:t.value.payer=f,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 3:t.value.payer=f,t.value.debts[v].isDebtor=!0,t.value.debts[f].isDebtor=!1;break;default:return}C(!0)},R=o=>{$.value||($.value=!0,X.clearOwedAmounts(t.value,o)),X.fillLastOwedAmount(t.value)&&V.notify("The amount has been increased to match the sum of the shares.")},C=o=>{(o||!$.value)&&($.value=!1,X.split(t.value))},i=()=>{e.transactionId=null,I.go(-1)},D=async()=>{try{X.check(t.value),await e.addTransaction(t.value),e.transactionId=null,i()}catch(o){V.notify({message:o.message||o,color:"negative"});return}};return(o,a)=>(h(),N(J,null,[n(Ve,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[n(Ie,null,{default:r(()=>[n(L,{flat:"",icon:"arrow_back",onClick:i,"aria-label":"Go Back",class:"bg-white text-primary"}),n(qe),n(L,{flat:"",icon:d.value?"visibility_off":"visibility",label:d.value?"Hide":"Show",onClick:a[0]||(a[0]=s=>d.value=!d.value),class:"q-ml-md bg-white text-primary","aria-label":"Toggle active state"},null,8,["icon","label"]),n(L,{flat:"",icon:"done",label:"Confirm",onClick:D,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),n($e,null,{default:r(()=>[n(G,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[n(j,null,{default:r(()=>[n(Ce,{ref_key:"nameInput",ref:k,modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.name=s),label:"Transaction Name",outlined:"",onFocus:a[2]||(a[2]=s=>k.value.select())},null,8,["modelValue"])]),_:1}),n(j,{class:"row",style:{"align-items":"center"}},{default:r(()=>[n(De,{modelValue:t.value.currency,"onUpdate:modelValue":a[3]||(a[3]=s=>t.value.currency=s),usedCurrencies:p(e).currencies,class:"q-mr-md text-subtitle1",style:{height:"56px"}},null,8,["modelValue","usedCurrencies"]),n(ae,{modelValue:t.value.amount,"onUpdate:modelValue":[a[4]||(a[4]=s=>t.value.amount=s),a[5]||(a[5]=s=>C(!0))],currency:"XXX",style:{flex:"1"},label:"Amount"},null,8,["modelValue"])]),_:1})]),_:1}),n(G,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[t.value.debts.length===2?(h(),E(j,{key:0,class:"column items-center"},{default:r(()=>[n(Se,{class:"full-width"},{label:r(()=>[y("div",Ue,[y("div",Le,S(_(x.value,t.value.payer)),1),x.value!==-1&&t.value.amount!==0?(h(),N("div",{key:0,class:Z(["text-center text-caption",t.value.payer===p(v)?"text-green":"text-red"])},S(q(x.value,t.value.payer)),3)):O("",!0)])]),default:r(()=>[n(ee,null,{default:r(()=>[z((h(),E(M,{clickable:"",class:"bg-white",onClick:a[6]||(a[6]=s=>P(0))},{default:r(()=>[n(K,null,{default:r(()=>[y("div",je,[y("div",Fe,S(_(1,p(v))),1),t.value.amount?(h(),N("div",Re,S(q(1,p(v))),1)):O("",!0)])]),_:1})]),_:1})),[[H]]),z((h(),E(M,{clickable:"",class:"bg-grey-3",onClick:a[7]||(a[7]=s=>P(1))},{default:r(()=>[n(K,null,{default:r(()=>[y("div",ze,[y("div",Xe,S(_(0,p(v))),1),t.value.amount?(h(),N("div",Me,S(q(0,p(v))),1)):O("",!0)])]),_:1})]),_:1})),[[H]]),z((h(),E(M,{clickable:"",class:"bg-white",onClick:a[8]||(a[8]=s=>P(2))},{default:r(()=>[n(K,null,{default:r(()=>[y("div",Ke,[y("div",He,S(_(1,p(f))),1),t.value.amount?(h(),N("div",Ye,S(q(1,p(f))),1)):O("",!0)])]),_:1})]),_:1})),[[H]]),z((h(),E(M,{clickable:"",class:"bg-grey-3",onClick:a[9]||(a[9]=s=>P(3))},{default:r(()=>[n(K,null,{default:r(()=>[y("div",Ge,[y("div",We,S(_(0,p(f))),1),t.value.amount?(h(),N("div",Je,S(q(0,p(f))),1)):O("",!0)])]),_:1})]),_:1})),[[H]])]),_:1})]),_:1})]),_:1})):O("",!0),t.value.debts.length>2?(h(),E(j,{key:1,class:"row justify-center items-center"},{default:r(()=>[n(te,{class:"col-auto q-mr-sm",modelValue:Q.value,"onUpdate:modelValue":a[10]||(a[10]=s=>Q.value=s),people:p(e).currentSheet.people,"sorted-people":p(e).currentSheetPeople,"fixed-label":"Payer",dense:""},null,8,["modelValue","people","sorted-people"]),n(L,{class:"col-auto q-mr-sm",icon:"swap_horiz",onClick:F}),n(te,{class:"col-auto",modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=s=>g.value=s),people:p(e).currentSheet.people,"sorted-people":p(e).currentSheetPeople,"fixed-label":"Debtor",dense:""},null,8,["modelValue","people","sorted-people"])]),_:1})):O("",!0),n(j,{class:"row justify-center items-center"},{default:r(()=>[n(L,{flat:"",icon:"done",label:"Cancel",onClick:D,class:"q-mr-md bg-red text-white","aria-label":"Save"}),n(L,{flat:"",icon:"done",label:"Confirm",onClick:D,class:"bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),n(G,{class:"q-my-md q-mr-md q-ml-md q-mb-md"},{default:r(()=>[n(j,null,{default:r(()=>a[15]||(a[15]=[y("div",{class:"row text-bold"},[y("div",{class:"col-auto q-mr-md q-ml-sm"},"Payer"),y("div",{class:"col"},"Person"),y("div",{class:"col-auto q-mr-md"},"Owes"),y("div",{class:"col-auto q-mr-lg"},"Amount")],-1)])),_:1}),n(ee,{class:"q-my-md q-mr-md q-ml-md"},{default:r(()=>[(h(!0),N(J,null,he(p(e).currentSheetPeople,(s,b)=>z((h(),E(M,{key:b,class:Z(b%2===0?"bg-grey-1":"bg-white")},{default:r(()=>[y("div",Ze,[n(Pe,{modelValue:t.value.payer,"onUpdate:modelValue":[a[12]||(a[12]=w=>t.value.payer=w),a[13]||(a[13]=w=>C(!1))],val:b},null,8,["modelValue","val"])]),n(K,null,{default:r(()=>[n(we,{id:s,"max-length":13},null,8,["id"])]),_:2},1024),n(Oe,{modelValue:t.value.debts[b].isDebtor,"onUpdate:modelValue":[w=>t.value.debts[b].isDebtor=w,a[14]||(a[14]=w=>C(!0))],class:"q-mr-sx"},null,8,["modelValue","onUpdate:modelValue"]),n(ae,{modelValue:t.value.debts[b].owedAmount,"onUpdate:modelValue":w=>t.value.debts[b].owedAmount=w,currency:"XXX",style:{maxWidth:"100px"},onBlur:w=>R(b)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["class"])),[[_e,p(e).currentSheet.people[s].active||d.value||t.value.payer===b||t.value.debts[b].owedAmount!==0||t.value.debts[b].isDebtor]])),128))]),_:1})]),_:1})]),_:1})],64))}};export{bt as default};
