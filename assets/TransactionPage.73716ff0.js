import{r as L,a as d,h as m,c as oe,aJ as ne,aK as se,Q as re,s as ue,b as ie,g as de,E as Y,aL as A,O as xe,o as ye,u as h,P as E,y as n,x as u,S as J,T as ke,N as j,U as p,v as O,L as k,W as S,Y as W,V as U,C as X,X as he,aD as M,am as _e}from"./index.3c642f3f.js";import{Q as we}from"./QSpace.958e3a61.js";import{Q as qe,a as Ve}from"./QHeader.17e0d103.js";import{f as ce,g as ve,a as Z,Q as F,b as Ie}from"./QCard.cd84ec1d.js";import{b as K,a as T}from"./QMenu.bf4b20b6.js";import{Q as ee,_ as Ce}from"./PersonItem.0c4c0051.js";import{Q as Se,_ as te}from"./PeopleDropdown.f46bccfe.js";import{u as me,a as fe,Q as $e,b as Qe}from"./QPage.bcf7fa6d.js";import{_ as De,C as H}from"./CurrencyDropdown.a7d9da2a.js";import{_ as ae}from"./CurrencyInput.2049edda.js";import{U as le}from"./utils.ca14db4f.js";import"./QResizeObserver.392c2661.js";import"./selection.8bc5fb3f.js";import"./focusout.9c5b2b0a.js";import"./scroll.be1c4903.js";function be(l,q){const e=L(null),V=d(()=>l.disable===!0?null:m("span",{ref:e,class:"no-outline",tabindex:-1}));function t(c){const x=q.value;c!==void 0&&c.type.indexOf("key")===0?x!==null&&document.activeElement!==x&&x.contains(document.activeElement)===!0&&x.focus():e.value!==null&&(c===void 0||x!==null&&x.contains(c.target)===!0)&&e.value.focus()}return{refocusTargetEl:V,refocusTarget:t}}var ge={xs:30,sm:35,md:40,lg:50,xl:60};const Be=()=>m("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[m("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),m("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var Pe=oe({name:"QRadio",props:{...me,...ne,...ce,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(l,{slots:q,emit:e}){const{proxy:V}=de(),t=fe(l,V.$q),c=se(l,ge),x=L(null),{refocusTargetEl:$,refocusTarget:Q}=be(l,x),g=d(()=>A(l.modelValue)===A(l.val)),R=d(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(l.disable===!0?" disabled":"")+(t.value===!0?" q-radio--dark":"")+(l.dense===!0?" q-radio--dense":"")+(l.leftLabel===!0?" reverse":"")),B=d(()=>{const i=l.color!==void 0&&(l.keepColor===!0||g.value===!0)?` text-${l.color}`:"";return`q-radio__inner relative-position q-radio__inner--${g.value===!0?"truthy":"falsy"}${i}`}),f=d(()=>(g.value===!0?l.checkedIcon:l.uncheckedIcon)||null),v=d(()=>l.disable===!0?-1:l.tabindex||0),y=d(()=>{const i={type:"radio"};return l.name!==void 0&&Object.assign(i,{".checked":g.value===!0,"^checked":g.value===!0?"checked":void 0,name:l.name,value:l.val}),i}),_=ve(y);function w(i){i!==void 0&&(Y(i),Q(i)),l.disable!==!0&&g.value!==!0&&e("update:modelValue",l.val,i)}function P(i){(i.keyCode===13||i.keyCode===32)&&Y(i)}function z(i){(i.keyCode===13||i.keyCode===32)&&w(i)}Object.assign(V,{set:w});const I=Be();return()=>{const i=f.value!==null?[m("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[m(re,{class:"q-radio__icon",name:f.value})])]:[I];l.disable!==!0&&_(i,"unshift"," q-radio__native q-ma-none q-pa-none");const D=[m("div",{class:B.value,style:c.value,"aria-hidden":"true"},i)];$.value!==null&&D.push($.value);const o=l.label!==void 0?ue(q.default,[l.label]):ie(q.default);return o!==void 0&&D.push(m("div",{class:"q-radio__label q-anchor--skip"},o)),m("div",{ref:x,class:R.value,tabindex:v.value,role:"radio","aria-label":l.label,"aria-checked":g.value===!0?"true":"false","aria-disabled":l.disable===!0?"true":void 0,onClick:w,onKeydown:P,onKeyup:z},D)}}});const Te={...me,...ne,...ce,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:l=>l==="tf"||l==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},Ae=["update:modelValue"];function Ne(l,q){const{props:e,slots:V,emit:t,proxy:c}=de(),{$q:x}=c,$=fe(e,x),Q=L(null),{refocusTargetEl:g,refocusTarget:R}=be(e,Q),B=se(e,ge),f=d(()=>e.val!==void 0&&Array.isArray(e.modelValue)),v=d(()=>{const r=A(e.val);return f.value===!0?e.modelValue.findIndex(N=>A(N)===r):-1}),y=d(()=>f.value===!0?v.value!==-1:A(e.modelValue)===A(e.trueValue)),_=d(()=>f.value===!0?v.value===-1:A(e.modelValue)===A(e.falseValue)),w=d(()=>y.value===!1&&_.value===!1),P=d(()=>e.disable===!0?-1:e.tabindex||0),z=d(()=>`q-${l} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+($.value===!0?` q-${l}--dark`:"")+(e.dense===!0?` q-${l}--dense`:"")+(e.leftLabel===!0?" reverse":"")),I=d(()=>{const r=y.value===!0?"truthy":_.value===!0?"falsy":"indet",N=e.color!==void 0&&(e.keepColor===!0||(l==="toggle"?y.value===!0:_.value!==!0))?` text-${e.color}`:"";return`q-${l}__inner relative-position non-selectable q-${l}__inner--${r}${N}`}),i=d(()=>{const r={type:"checkbox"};return e.name!==void 0&&Object.assign(r,{".checked":y.value,"^checked":y.value===!0?"checked":void 0,name:e.name,value:f.value===!0?e.val:e.trueValue}),r}),D=ve(i),o=d(()=>{const r={tabindex:P.value,role:l==="toggle"?"switch":"checkbox","aria-label":e.label,"aria-checked":w.value===!0?"mixed":y.value===!0?"true":"false"};return e.disable===!0&&(r["aria-disabled"]="true"),r});function a(r){r!==void 0&&(Y(r),R(r)),e.disable!==!0&&t("update:modelValue",s(),r)}function s(){if(f.value===!0){if(y.value===!0){const r=e.modelValue.slice();return r.splice(v.value,1),r}return e.modelValue.concat([e.val])}if(y.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(_.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function b(r){(r.keyCode===13||r.keyCode===32)&&Y(r)}function C(r){(r.keyCode===13||r.keyCode===32)&&a(r)}const pe=q(y,w);return Object.assign(c,{toggle:a}),()=>{const r=pe();e.disable!==!0&&D(r,"unshift",` q-${l}__native absolute q-ma-none q-pa-none`);const N=[m("div",{class:I.value,style:B.value,"aria-hidden":"true"},r)];g.value!==null&&N.push(g.value);const G=e.label!==void 0?ue(V.default,[e.label]):ie(V.default);return G!==void 0&&N.push(m("div",{class:`q-${l}__label q-anchor--skip`},G)),m("div",{ref:Q,class:z.value,...o.value,onClick:a,onKeydown:b,onKeyup:C},N)}}const Ee=()=>m("div",{key:"svg",class:"q-checkbox__bg absolute"},[m("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[m("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),m("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]);var Oe=oe({name:"QCheckbox",props:Te,emits:Ae,setup(l){const q=Ee();function e(V,t){const c=d(()=>(V.value===!0?l.checkedIcon:t.value===!0?l.indeterminateIcon:l.uncheckedIcon)||null);return()=>c.value!==null?[m("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[m(re,{class:"q-checkbox__icon",name:c.value})])]:[q]}return Ne("checkbox",e)}});const Ue={class:"q-gutter-none"},Le={class:"text-center"},je={class:"q-gutter-none"},Fe={class:"text-center"},Re={key:0,class:"text-center text-caption text-green"},ze={class:"q-gutter-none"},Xe={class:"text-center"},Me={key:0,class:"text-center text-caption text-green"},Ke={class:"q-gutter-none"},He={class:"text-center"},Ye={key:0,class:"text-center text-caption text-red"},Ge={class:"q-gutter-none"},Je={class:"text-center"},We={key:0,class:"text-center text-caption text-red"},ft={__name:"TransactionPage",setup(l){const q=Qe(),e=xe(),V=ke(),t=L(e.getEditableTransaction()),c=L(!1),x=L(null),$=L(!1);ye(()=>{var o;(o=x.value)==null||o.focus()});const Q=d({get:()=>e.personIdx2Id(t.value.payer)||"",set:o=>{t.value.payer=e.personId2Idx(o)}}),g=d({get:()=>{const o=t.value.debts.map((a,s)=>a.isDebtor?s:-1).filter(a=>a!==-1);return o.length===1?e.personIdx2Id(o[0]):null},set:o=>{const a=e.personId2Idx(o);t.value.debts.forEach((s,b)=>{s.isDebtor=b===a}),I(!1)}}),R=()=>{if(g.value!==null){if(Q.value===g.value)return;const o=e.personId2Idx(Q.value),a=e.personId2Idx(g.value);t.value.payer=a,t.value.debts.forEach((s,b)=>{s.isDebtor=b===o}),I(!1)}},B=e.currentSheetPeople.find(o=>o!==e.user.id),f=e.currentSheetPeople.findIndex(o=>o!==e.user.id),v=e.currentSheetPeople.findIndex(o=>o===e.user.id),y=d(()=>M.state(t.value)),_=(o,a)=>{switch(o){case 0:return(a===v?"You are":`${e.getName(B)} is`)+" owed the full amount";case 1:return(a===v?"You":e.getName(B))+" paid, split equally";default:return"Custom"}},w=(o,a)=>{const s=o===0?t.value.amount:(t.value.amount+t.value.amount%2)/2;return a===v?`${e.getName(B)} owes you ${le.displayCurrency(t.value.currency,s)}`:`You owe ${e.getName(B)} ${le.displayCurrency(t.value.currency,s)}`},P=o=>{switch(o){case 0:t.value.payer=v,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 1:t.value.payer=v,t.value.debts[v].isDebtor=!1,t.value.debts[f].isDebtor=!0;break;case 2:t.value.payer=f,t.value.debts[0].isDebtor=!0,t.value.debts[1].isDebtor=!0;break;case 3:t.value.payer=f,t.value.debts[v].isDebtor=!0,t.value.debts[f].isDebtor=!1;break;default:return}I(!0)},z=o=>{$.value||($.value=!0,M.clearOwedAmounts(t.value,o)),M.fillLastOwedAmount(t.value)&&q.notify("The amount has been increased to match the sum of the shares.")},I=o=>{(o||!$.value)&&($.value=!1,M.split(t.value))},i=()=>{e.transactionId=null,V.go(-1)},D=async()=>{try{M.check(t.value),await e.addTransaction(t.value),e.transactionId=null,i()}catch(o){q.notify({message:o.message||o,color:"negative"});return}};return(o,a)=>(h(),E(J,null,[n(qe,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[n(Ve,null,{default:u(()=>[n(j,{flat:"",icon:"arrow_back",onClick:i,"aria-label":"Go Back",class:"bg-white text-primary"}),n(we),n(j,{flat:"",icon:c.value?"visibility_off":"visibility",label:c.value?"Hide":"Show",onClick:a[0]||(a[0]=s=>c.value=!c.value),class:"q-ml-md bg-white text-primary","aria-label":"Toggle active state"},null,8,["icon","label"]),n(j,{flat:"",icon:"done",label:"Confirm",onClick:D,class:"q-ml-md bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),n($e,null,{default:u(()=>[n(Z,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[n(F,null,{default:u(()=>[n(Ie,{ref_key:"nameInput",ref:x,modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.name=s),label:"Transaction Name",outlined:"",onFocus:a[2]||(a[2]=s=>x.value.select())},null,8,["modelValue"])]),_:1}),n(F,{class:"row",style:{"align-items":"center"}},{default:u(()=>[n(De,{modelValue:t.value.currency,"onUpdate:modelValue":a[3]||(a[3]=s=>t.value.currency=s),usedCurrencies:p(e).currencies,class:"q-mr-md text-subtitle1",style:{height:"56px"}},null,8,["modelValue","usedCurrencies"]),n(ae,{modelValue:t.value.amount,"onUpdate:modelValue":[a[4]||(a[4]=s=>t.value.amount=s),a[5]||(a[5]=s=>I(!0))],currency:"XXX",style:{flex:"1"},label:"Amount"},null,8,["modelValue"])]),_:1})]),_:1}),n(Z,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[t.value.debts.length===2?(h(),O(F,{key:0,class:"column items-center"},{default:u(()=>[n(Se,{class:"full-width"},{label:u(()=>[k("div",Ue,[k("div",Le,S(_(y.value,t.value.payer)),1),y.value!==-1&&t.value.amount!==0?(h(),E("div",{key:0,class:W(["text-center text-caption",t.value.payer===p(v)?"text-green":"text-red"])},S(w(y.value,t.value.payer)),3)):U("",!0)])]),default:u(()=>[n(ee,null,{default:u(()=>[X((h(),O(K,{clickable:"",class:"bg-white",onClick:a[6]||(a[6]=s=>P(0))},{default:u(()=>[n(T,null,{default:u(()=>[k("div",je,[k("div",Fe,S(_(1,p(v))),1),t.value.amount?(h(),E("div",Re,S(w(1,p(v))),1)):U("",!0)])]),_:1})]),_:1})),[[H]]),X((h(),O(K,{clickable:"",class:"bg-grey-3",onClick:a[7]||(a[7]=s=>P(1))},{default:u(()=>[n(T,null,{default:u(()=>[k("div",ze,[k("div",Xe,S(_(0,p(v))),1),t.value.amount?(h(),E("div",Me,S(w(0,p(v))),1)):U("",!0)])]),_:1})]),_:1})),[[H]]),X((h(),O(K,{clickable:"",class:"bg-white",onClick:a[8]||(a[8]=s=>P(2))},{default:u(()=>[n(T,null,{default:u(()=>[k("div",Ke,[k("div",He,S(_(1,p(f))),1),t.value.amount?(h(),E("div",Ye,S(w(1,p(f))),1)):U("",!0)])]),_:1})]),_:1})),[[H]]),X((h(),O(K,{clickable:"",class:"bg-grey-3",onClick:a[9]||(a[9]=s=>P(3))},{default:u(()=>[n(T,null,{default:u(()=>[k("div",Ge,[k("div",Je,S(_(0,p(f))),1),t.value.amount?(h(),E("div",We,S(w(0,p(f))),1)):U("",!0)])]),_:1})]),_:1})),[[H]])]),_:1})]),_:1})]),_:1})):U("",!0),t.value.debts.length>2?(h(),O(F,{key:1,class:"row justify-center items-center"},{default:u(()=>[n(te,{class:"col-auto q-mr-sm",modelValue:Q.value,"onUpdate:modelValue":a[10]||(a[10]=s=>Q.value=s),people:p(e).currentSheet.people,"sorted-people":p(e).currentSheetPeople,"fixed-label":"Payer",dense:""},null,8,["modelValue","people","sorted-people"]),n(j,{class:"col-auto q-mr-sm",icon:"swap_horiz",onClick:R}),n(te,{class:"col-auto",modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=s=>g.value=s),people:p(e).currentSheet.people,"sorted-people":p(e).currentSheetPeople,"fixed-label":"Debtor",dense:""},null,8,["modelValue","people","sorted-people"])]),_:1})):U("",!0),n(F,{class:"row justify-center items-center"},{default:u(()=>[n(j,{flat:"",icon:"done",label:"Cancel",onClick:D,class:"q-mr-md bg-red text-white","aria-label":"Save"}),n(j,{flat:"",icon:"done",label:"Confirm",onClick:D,class:"bg-secondary text-white","aria-label":"Save"})]),_:1})]),_:1}),n(F,null,{default:u(()=>a[15]||(a[15]=[k("div",{class:"row text-bold no-wrap items-center"},[k("div",{style:{flex:"0 0 5%","text-align":"left"},class:"q-ml-sm q-mr-md"}," Payer "),k("div",{style:{flex:"1 1 auto","text-align":"left",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}}," Person "),k("div",{style:{flex:"0 0 5%","text-align":"center","margin-right":"6px"}}," Owes "),k("div",{style:{flex:"0 1 35%","text-align":"right"}},"Amount")],-1)])),_:1}),n(ee,{class:"q-my-md q-mr-md q-ml-md"},{default:u(()=>[(h(!0),E(J,null,he(p(e).currentSheetPeople,(s,b)=>X((h(),O(K,{key:b,class:W([b%2===0?"bg-grey-1":"bg-white","row no-wrap items-center"])},{default:u(()=>[n(T,{side:"",style:{flex:"0 0 5%","text-align":"left"}},{default:u(()=>[n(Pe,{modelValue:t.value.payer,"onUpdate:modelValue":[a[12]||(a[12]=C=>t.value.payer=C),a[13]||(a[13]=C=>I(!1))],val:b,dense:""},null,8,["modelValue","val"])]),_:2},1024),n(T,{style:{flex:"1 1 auto",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","text-align":"right"}},{default:u(()=>[n(Ce,{id:s},null,8,["id"])]),_:2},1024),n(T,{side:"",style:{flex:"0 0 5%","text-align":"center","margin-right":"6px"}},{default:u(()=>[n(Oe,{modelValue:t.value.debts[b].isDebtor,"onUpdate:modelValue":[C=>t.value.debts[b].isDebtor=C,a[14]||(a[14]=C=>I(!0))],dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(T,{side:"",style:{flex:"0 1 35%"}},{default:u(()=>[n(ae,{modelValue:t.value.debts[b].owedAmount,"onUpdate:modelValue":C=>t.value.debts[b].owedAmount=C,currency:"XXX",dense:"",style:{width:"auto","min-width":"4ch"},onBlur:C=>z(b)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1032,["class"])),[[_e,p(e).currentSheet.people[s].active||c.value||t.value.payer===b||t.value.debts[b].owedAmount!==0||t.value.debts[b].isDebtor]])),128))]),_:1})]),_:1})],64))}};export{ft as default};
